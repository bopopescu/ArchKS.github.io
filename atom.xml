<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zen&#39;s blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://archks.gitee.io/web/"/>
  <updated>2020-07-12T09:22:20.791Z</updated>
  <id>http://archks.gitee.io/web/</id>
  
  <author>
    <name>ZEN</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Minikube初体验</title>
    <link href="http://archks.gitee.io/web/2020/07/12/Minikube%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
    <id>http://archks.gitee.io/web/2020/07/12/Minikube%E5%88%9D%E4%BD%93%E9%AA%8C/</id>
    <published>2020-07-12T08:41:51.000Z</published>
    <updated>2020-07-12T09:22:20.791Z</updated>
    
    <content type="html"><![CDATA[<p>先吐槽一下K8S的官网，一个搞技术的，非得被逼成这样，这tm都是什么氛围！</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/07/12/U3bY9g.png" alt="https://kubernetes.io/docs/setup/learning-environment/minikube/"></p><br><blockquote><p>依照官网配置，始终不能启动minikube，官网并没有写太多细节，类似ipv4转发，Linux版本这些官网并没有提到，但是这些因素也决定minikube能否安装成功，我根据官网流程和部署，整理绝大部分安装时涉及到的点，如果环境相同，是能配置成功的。</p></blockquote><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>先介绍一下运行环境：</p><table><thead><tr><th>类型</th><th>配置</th></tr></thead><tbody><tr><td>系统</td><td>系统 Vmware14 + CentOS7 + Linux4.4</td></tr><tr><td>网络</td><td>Proxy代理，所有socks5代理带本地Windows，Windows可以直接连接Google，所有没有配置国内的源</td></tr></tbody></table><p><strong>需要注意的点：</strong></p><ul><li>宿主机参数调整： <ul><li>关闭防火墙 &amp; Selinux </li><li>关闭交换分区</li><li>配置至少2CPU，这次安装配置为2核4G</li><li>内核版本4.10，3.10的版本安装不了</li><li>开启ipv4、bridge内核转发</li><li>确保各项服务自启没问题</li></ul></li><li>docker配置<ul><li>docker的driver要和k8s一样，这里设置的是systemd，有时候也会设置cgroup</li></ul></li></ul><br><p>1、升级内核—-不要在Linux3.10的内核上安装，会有很多bug，建议升级到4.14</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -Uvh https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br><span class="line">yum list available --disablerepo=<span class="string">'*'</span> --enablerepo=elrepo-kernel</span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-ml</span><br><span class="line">vim /etc/default/grub    【 Change GRUB_DEFAULT=X ===&gt; GRUB_DEFAULT=0 】</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg  【 recreate the kernel configuration 】</span><br></pre></td></tr></table></figure><p>2、设置本地代理，Windows上跑的Vmware，Windows可以直连外网，具体可以google，这里不方便展示</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ALL_PROXY=socks5://windowsIp:port</span><br><span class="line"></span><br><span class="line">取消代理</span><br><span class="line"><span class="built_in">unset</span> ALL_PROXY</span><br></pre></td></tr></table></figure><p>3、关闭交换分区</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">swapoff -a                         暂时关闭</span><br><span class="line">sed -i <span class="string">'s/.*swap/#&amp;/'</span> /etc/fstab   永久关闭</span><br></pre></td></tr></table></figure><p>4、禁用防火墙和Selinux</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld </span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">'s\SELINUX=enforcing\SELINUX=disabled\'</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><p>5、调整内核参数</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br></pre></td></tr></table></figure><p>6、安装依赖包和docker</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加docker仓库</span></span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用夜间测试库</span></span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> docker-ce-nightly</span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> docker-ce-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装最新版的docker</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io conntrack -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动docker并允许自启动（这一步在minikube运行的时候是必须的）</span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p>7、修改docker和kubelte的Cgroup driver</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"exec-opts"</span>: [<span class="string">"native.cgroupdriver=systemd"</span>]</span><br><span class="line">  <span class="comment"># "exec-opts": ["native.cgroupdriver=cgroupfs"] 有时候cgroupfs就有用，不知道抽的什么风，应该是要和kubeadm匹配</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">最后检查一下</span><br><span class="line">docker info | grep -i cgroup</span><br><span class="line">- Cgroup Driver: systemd</span><br></pre></td></tr></table></figure><p>8、安装kubectl、kubeadm、minikube</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加Google源</span></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line">yum install -y kubectl kubeadm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span></span><br><span class="line"><span class="comment"># - 增加 --cgroup-driver=cgroupfs</span></span><br><span class="line"><span class="comment"># Environment="KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --cgroup-driver=cgroupfs"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置自启</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">systemctl restart kubelet</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装minikube，并添加到环境变量</span></span><br><span class="line">curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span><br><span class="line">chmod +x minikube &amp;&amp; sudo mkdir -p /usr/<span class="built_in">local</span>/bin/ &amp;&amp; sudo install minikube /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure><p>9、完成安装</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ minikube status</span><br><span class="line">- minikube</span><br><span class="line">- <span class="built_in">type</span>: Control Plane</span><br><span class="line">- host: Running</span><br><span class="line">- kubelet: Running</span><br><span class="line">- apiserver: Running</span><br><span class="line">- kubeconfig: Configured</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p><strong>运行一个简单的HTTP Server</strong></p><p>拉取镜像</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl create deployment hello-minikube --image=k8s.gcr.io/echoserver:1.10</span><br><span class="line">deployment.apps/hello-minikube created</span><br></pre></td></tr></table></figure><p>部署服务</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl expose deployment hello-minikube --<span class="built_in">type</span>=NodePort --port=8080</span><br><span class="line">service/hello-minikube exposed</span><br></pre></td></tr></table></figure><p>查看状态</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl get pod</span><br><span class="line">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">hello-minikube-64b64df8c9-rcrfl   1/1     Running   0          98s</span><br></pre></td></tr></table></figure><p>得到这个服务的URL</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ minikube service hello-minikube --url</span><br><span class="line">http://192.168.134.129:32056</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/07/12/U3Tepj.png" alt="第一个K8S服务"></p><p>删除这个Service</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl delete services hello-minikube</span><br><span class="line">service <span class="string">"hello-minikube"</span> deleted</span><br></pre></td></tr></table></figure><p>删除这个Deployment</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl delete deployment hello-minikube</span><br><span class="line">deployment.apps <span class="string">"hello-minikube"</span> deleted</span><br></pre></td></tr></table></figure><p>停止minikube集群</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ minikube stop</span><br><span class="line">* Stopping <span class="string">"minikube"</span> <span class="keyword">in</span> none ...</span><br><span class="line">* Node <span class="string">"minikube"</span> stopped.</span><br></pre></td></tr></table></figure><p>删除本地minikube集群</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ minikube delete</span><br><span class="line">* Uninstalling Kubernetes v1.18.3 using kubeadm ...</span><br><span class="line">* Deleting <span class="string">"minikube"</span> <span class="keyword">in</span> none ...</span><br><span class="line">* Removed all traces of the <span class="string">"minikube"</span> cluster.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;先吐槽一下K8S的官网，一个搞技术的，非得被逼成这样，这tm都是什么氛围！&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/I
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>宿主机设置操作容器的定时任务无效</title>
    <link href="http://archks.gitee.io/web/2020/07/11/Docker-Err1/"/>
    <id>http://archks.gitee.io/web/2020/07/11/Docker-Err1/</id>
    <published>2020-07-11T08:26:21.000Z</published>
    <updated>2020-07-11T08:34:01.719Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看定时任务</span></span><br><span class="line">[root@ ~]<span class="comment"># crontab -l</span></span><br><span class="line">0 */1 * * * sh /data/cront/wx_sgin.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行的脚本</span></span><br><span class="line">[root@ ~]<span class="comment"># cat /data/cront/wx_sgin.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mys /bin/bash -c <span class="string">'python3 /data/wx_sign.py'</span> </span><br><span class="line">docker cp mys:/img/SignInResult.png /data/<span class="built_in">log</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该脚本执行完之后，会在/data/log/下生成一张图片，但是并没有看到图片，可见定时任务没有执行</span></span><br><span class="line"><span class="comment"># 查看/var/spool/mail/root，发现如下报错</span></span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/07/11/UllSBR.png" alt="UllSBR.png" style="zoom:50%;" /><p>具体原因出在这条命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mys /bin/bash -c <span class="string">'python3 /data/wx_sign.py'</span></span><br></pre></td></tr></table></figure><p>脚本操纵docker容器不可以是TTY(交互模式)，修改如下：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -i mys /bin/bash -c <span class="string">'python3 /data/wx_sign.py'</span></span><br></pre></td></tr></table></figure><p>把-t参数去掉即可。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@ ~]<span class="comment"># docker exec --help</span></span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -d, --detach               Detached mode: run <span class="built_in">command</span> <span class="keyword">in</span> the background</span><br><span class="line">      --detach-keys string   Override the key sequence <span class="keyword">for</span> detaching a container</span><br><span class="line">  -e, --env list             Set environment variables (default [])</span><br><span class="line">      --<span class="built_in">help</span>                 Print usage</span><br><span class="line">  -i, --interactive          Keep STDIN open even <span class="keyword">if</span> not attached</span><br><span class="line">      --privileged           Give extended privileges to the <span class="built_in">command</span></span><br><span class="line">  -t, --tty                  Allocate a pseudo-TTY</span><br><span class="line">  -u, --user string          Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 查看定时任务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span cla
      
    
    </summary>
    
    
      <category term="报错" scheme="http://archks.gitee.io/web/categories/%E6%8A%A5%E9%94%99/"/>
    
    
  </entry>
  
  <entry>
    <title>Django3.0.8访问url报错Forbidden(CSRF Cookie not set)</title>
    <link href="http://archks.gitee.io/web/2020/07/11/Django-Err2/"/>
    <id>http://archks.gitee.io/web/2020/07/11/Django-Err2/</id>
    <published>2020-07-11T08:13:50.000Z</published>
    <updated>2020-07-11T08:24:26.621Z</updated>
    
    <content type="html"><![CDATA[<p>修该settings.py文件，注释其中关于CSRF防御机制：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">     <span class="comment">#'django.middleware.csrf.CsrfViewMiddleware',</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Middleware是Django请求/响应处理的插件框架。它是一个轻巧的低级”插件”系统，用于全局改变Django的输入或输出，每个中间件组件负责执行某些特定功能。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;修该settings.py文件，注释其中关于CSRF防御机制：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MIDDLEWARE = [&lt;/
      
    
    </summary>
    
    
      <category term="报错" scheme="http://archks.gitee.io/web/categories/%E6%8A%A5%E9%94%99/"/>
    
    
  </entry>
  
  <entry>
    <title>【摘文】月亮与六便士</title>
    <link href="http://archks.gitee.io/web/2020/07/11/%E6%9C%88%E4%BA%AE%E4%B8%8E%E5%85%AD%E4%BE%BF%E5%A3%AB/"/>
    <id>http://archks.gitee.io/web/2020/07/11/%E6%9C%88%E4%BA%AE%E4%B8%8E%E5%85%AD%E4%BE%BF%E5%A3%AB/</id>
    <published>2020-07-11T04:03:15.000Z</published>
    <updated>2020-07-11T04:04:40.703Z</updated>
    
    <content type="html"><![CDATA[<p>我认为有些人诞生在某个地方，他们会认为那不是自己心甘情愿的。只是一个偶然的原因，自己被随便扔到某个地方，某种环境下，而他们却一直梦想着某个连自己都不清楚的地方，好像那才是他的故乡。在出生的地方他们像过客；从孩提时就熟悉的绿树成荫的原野，同小伙伴一起玩耍的街巷小道，对他们不过是旅途中的一个驿站。这种人在自己亲友中可能终生郁郁寡欢，在他们唯一熟悉的环境里也始终孑然一身。也许正是对乡土的生疏使得他们远走他乡，寻找一处可以永恒定居的寓所。说不定在他们内心深处仍然隐伏着多少世代前祖的习性和癖好，引导他们回到他们祖先在远古时期就已经离开的故土。有时候一个人偶然到了一个地方，会神秘地感觉到这正是自己栖身之所，是他一直寻找的家园。于是他就在那个似曾相识的环境下，在那些素未谋面的人中找到了归属感，留了下来。倒像是这里的一切才是她从小就熟悉的一样。他在这里终于找到了宁静。</p><p>一般来说，爱情对于男人来说不过是插曲，是日常生活中许多事物中的一件，但是小说却把爱情夸大了，给了他违反生活真实性的重要地位。尽管少数男人把爱情当作头等大事，但这些人常常是一些毫无情趣的家伙；即便那些把爱情当成生活的女人，也不太看得起这类男人。女人会被这样的男人吸引，会被他们奉承的心花怒放，但心里却不会有安全感——这些人是种可怜的生物。男人们即使在恋爱的短暂期间，也不停的去干些别的事以分散精力：首先他们得赚钱；其次他们还会沉湎于体育活动；最后还可能对艺术感兴趣。大多数情况下，他们会把自己不同的活动在时空里间隔开来，在进行一种活动时，暂时把另一种放下。男人们有专心致志于正在从事的活动的专注力；如果一种活动受到另一种影响，他们会非常恼火。至于坠入情网的男人于女人的区别是：女人能整天整夜谈恋爱，而男人却只能有时有晌的顾及一下它。</p><p>女人可以原谅男人对他的伤害，但永远不能原谅男人对她做出的牺牲。</p><p>布兰奇·施特勒夫的行为我容易解释，我认为她做出那种事来只不过是屈服于肉体的诱惑。现在回想起来，他对自己丈夫从来就没有真正的感情，我认为她对施特勒夫的情感，只是因为施特勒夫能提供她所需要的关爱与舒适安定的生活。那应该是一种本能地回应，大多数女人都把自己这种回应误以为是爱情。这其实是一种可以对任何一个人产生被动的感情，正像藤曼一样随便攀附在哪棵树上。这种感情可以让一个女孩子嫁给任何一个需要她，并能满足她所需要的东西的男人，也许时间久了也会对这个男人产生爱情，所以人们认为这种情感的力量，把它跟真正的爱情混为一谈。但这种情感究竟是什么呢？它只不过是安全感，对安定保障生活的本能需求，还有就是虚荣心，丰富的物质生活能带来满足感、荣誉感以及他人的认可；女人们禀性善良、喜爱虚荣，认为这种感情一样富于精神价值。但在冲动的热情面前，这种感情毫无防卫能力。</p><p>“如果他生活真的贫困不堪，我还是准备帮帮他。我会给你寄笔钱去，在他需要时，你可以一点一点给他。”但我知道她答应这件事并不是出于善心。有人说不幸可以使人性变得高贵，这句话并不总对；使人变得高尚的有时候反而是幸福，不幸在大多数情况下只会使人心胸狭隘，报复心强。</p><p>正是这点使我狼狈。有人也说过自己不在乎别人的看法。但多半是自欺欺人。一般来说他们能够自行其是都是因为相信别人不理解自己那些怪异的想法。最甚者也是因为有几个好友知交表示支持才敢不顾大多数人的意见。一个人如果做一些违背传统的事儿，而事实上这是他所属那个群体的常态的话，人们对此也就不会觉得不可思议。相反，这个人还会为此洋洋自得，因为它既可以标榜自己有足够的勇气，又不至冒太大的风险。我觉得渴望得到他人的认可，是人类文明的天性。一个做出来有悖传统的事的女人，招致大众的非议后，再没有谁会比她还快的跑到尊严体面那里寻求庇护。</p><p>我是绝对不相信那些说自己不在乎他人说什么的人，这不过是一种虚张声势。他们的意思是，他们相信别人，根本不会发现自己那些小的过错，就算是被指责一下也不会造成什么太大的损失。</p><p>家庭的生活，心里不无艳羡。这家人感情似乎 非常融洽，经常说一些外人无从理解的小笑话，然后自顾自地笑得要命。由这点我想到了查理斯·斯特里克兰先生。他不善言辞，也不是很聪明，但在他自己那个环境下，他的智慧应付起来还是绰绰有余，这不仅是事业成功的保证，也是生活幸福的保障。斯特里克兰太太是个招人喜爱的女人，她很爱她的丈夫。我想这对夫妻的生活，如果不受任何干扰，诚实、体面，两个孩子中规中矩，正在健康成长着;而不知不觉间，他俩会慢慢变老，儿女逐渐长大成人，一个出息成美丽的姑娘，将来会结婚生子;另一个则成为仪表堂堂的男子汉，很可能会成为一名军人。最后这对夫妻告老引退，子孙绕膝，过着富足、体面的晚年生活。他们会尽享天年，安详度过一生。这是世间无数对夫妻的故事。这种生活有着一种和谐安静的美，使人想到一条平静的小河，蜿蜒流过绿草茵茵的田野、牧场，流过河岸边郁郁的树荫，最后汇人浩瀚的大海;可大海是如此平静，如此沉默，我突然有了某种无法名状的不安，某种失落。这也许只是我自己的感触(这种感触在那时那些日子里，经常出现在我心里)，我总觉得人这样度过一生似乎缺点什么。</p><p>我不否认所看到的这种生活的社会价值，也看到了它井然有序的幸福。但我血液里却有种强烈的躁动，某种对未知世界的渴望。这种宁静安详的生活，让我不时会产生焦虑与恐惧。我渴望改变，无论怎样的改变，只要不是这样按部就班地活着就行。为此，我愿意面对任何的艰险。——（妻离子散，家破人亡）</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;我认为有些人诞生在某个地方，他们会认为那不是自己心甘情愿的。只是一个偶然的原因，自己被随便扔到某个地方，某种环境下，而他们却一直梦想着某个连自己都不清楚的地方，好像那才是他的故乡。在出生的地方他们像过客；从孩提时就熟悉的绿树成荫的原野，同小伙伴一起玩耍的街巷小道，对他们不过
      
    
    </summary>
    
    
      <category term="摘录" scheme="http://archks.gitee.io/web/categories/%E6%91%98%E5%BD%95/"/>
    
    
  </entry>
  
  <entry>
    <title>【摘文】追风筝的人</title>
    <link href="http://archks.gitee.io/web/2020/07/11/%E8%BF%BD%E9%A3%8E%E7%AD%9D%E7%9A%84%E4%BA%BA/"/>
    <id>http://archks.gitee.io/web/2020/07/11/%E8%BF%BD%E9%A3%8E%E7%AD%9D%E7%9A%84%E4%BA%BA/</id>
    <published>2020-07-11T04:01:49.000Z</published>
    <updated>2020-07-11T04:04:57.790Z</updated>
    
    <content type="html"><![CDATA[<p>最后一批哀悼者已经致哀完毕，清真寺人去楼空，只有那个毛拉在收起麦克风，用一块绿布裹起《古兰经》。将军和我走进黄昏的阳光中，我们走下台阶，走过一群吸烟的男人。我零星听到他们的谈话，下个周末在尤宁有场足球赛，圣克拉拉新开了一家阿富汗餐厅，生活已然前进，留爸爸在了后面。</p><p> 有那么一阵，即使癌症也没能阻止爸爸到跳蚤市场去，我们仍搜罗各处车库市场，爸爸当司机，我指路，并且在星期天摆摊。爸爸和那个古老国家的人互致问候，我和顾客为一两块钱讨价还价。仿佛一切如常，仿佛我成为孤儿的日子并没有随着每次收摊渐渐逼近。</p><p> 想着她锁骨上方那美丽的凹陷，我在脑海里一遍又一遍回放着我们的对话。她说的是:“听说你是个作家”还是“我听说你写作”</p><p>“我知道美国给你输入了乐观的性子，这也是她了不起的地方。那非常好，我们是忧郁的民族，我们阿富汗人，对吧?我们总是陷在悲伤和自恋中，我们在失败，灾难面前屈服，将这些当成生活的实质，甚至为必须，我们总是说生活会继续的。”</p><p>我成为今天的我，是在1975年某个阴云密布的寒冷冬日，那年我十二岁。我清楚的记得当时自己趴在一度坍塌的泥墙后面，窥探着那条小巷，旁边是结冰的小溪。许多年过去了，人们说陈年旧事可以被埋葬，然而我终于明白这是错的，因为往事会自行爬上来。回首前尘，我意识到在过去的二十六年里，自己始终在窥视着荒芜的巷子。</p><p>“现在，不管那个毛拉怎么说，罪行只有一种，那就是盗窃，其他罪行都是盗窃的变种。”“当你说谎，你就偷走别人知道真相的权利，当你诈骗，你偷走公平的权利。”</p><p>无关乎这些事情，因为历史不会轻易改变，宗教也是。最终，我是普什图人，他是哈扎拉人，我是逊尼派，他是什叶派，这些没有什么能改变，没有。<br>但我们是一起蹒跚学步的孩子，这点也没有任何历史、种族、社会或者宗教能改变得了。十二岁以前，我大部分时间都在根哈桑玩耍，有时候回想起来，我的整个童年，似乎就是和哈桑一起度过的某个懒洋洋的悠长夏日，我们在爸爸院子里那些交错的树木中彼此追逐，玩捉迷藏，玩警察与强盗，玩牛仔和印第安人，折磨昆虫，这带给我们无与伦比的快乐。</p><p>那儿有再次成为好人的路。我抬眼看看那比翼齐飞的风筝。我忆起哈桑，我缅怀爸爸。我想到阿里。我思念喀布尔。我想起曾经的生活，想起1975年那个改变了一切的冬天。那造就了今天的我。</p><p>我看着窗外的雨水，像是熔化了的白银。</p><p>那天早些时候，我确信无人注意，做了一件二十六年前就已经做过的事情，将一把皱皱的钞票塞在草席下面。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最后一批哀悼者已经致哀完毕，清真寺人去楼空，只有那个毛拉在收起麦克风，用一块绿布裹起《古兰经》。将军和我走进黄昏的阳光中，我们走下台阶，走过一群吸烟的男人。我零星听到他们的谈话，下个周末在尤宁有场足球赛，圣克拉拉新开了一家阿富汗餐厅，生活已然前进，留爸爸在了后面。&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="摘录" scheme="http://archks.gitee.io/web/categories/%E6%91%98%E5%BD%95/"/>
    
    
  </entry>
  
  <entry>
    <title>【摘文】人间失格</title>
    <link href="http://archks.gitee.io/web/2020/07/11/%E4%BA%BA%E9%97%B4%E5%A4%B1%E6%A0%BC/"/>
    <id>http://archks.gitee.io/web/2020/07/11/%E4%BA%BA%E9%97%B4%E5%A4%B1%E6%A0%BC/</id>
    <published>2020-07-11T04:00:21.000Z</published>
    <updated>2020-07-11T04:04:02.949Z</updated>
    
    <content type="html"><![CDATA[<p>作者背景：<br>昭和6年，太宰治与初代同居，后又开始从事共产主义运动，为此几次搬家，在此期间，他发现自己一直信任的妻子在认识他之前早己与人有染，内心受到极大的打击，于是，他去青森警察署自首，为自己的共产主义革命生涯划上了句号。昭和10年，太宰治在镰仓山企图自缢未果。<br>自缢事件之后，太宰治患上盲肠炎，因治疗中大量使用镇痛药而上瘾，不得不入院治疗了三个月之久，其间因其没有按时交纳学费被东京大学开除学籍。出院后不久，因镇痛剂注射上瘾，不惜举债买药，生活陷入了混乱之中。昭和11年10月，在亲朋好友的劝说和哄骗之下住进精神病院，这次入院经历成为他一生都无法释怀的经历，也成为写作《人间失格》的原动力。</p><p>太宰治，日本“无赖派”文学代表作家，与川端康成、三岛由纪夫并称战后文学的巅峰人物。出生于富<br>豪之家，本名津岛修治。中学期间，开始创作小说、杂文、戏剧，对泉镜花、芥川龙之介的作品相当倾倒。芥川的自杀对他产生了相当大的冲击与影响。一九三〇年，进入东大法文科，初会井伏鳟二，奉为终生之师。同年他以资金援助的形式参与了日本共产党的重建工作，两年后与左翼活动脱离关系。一九三五年凭借《逆行》入围第一届芥川奖。他的很多重要作品，如《东京八景》、《小丑之花》、《晚年》、《斜阳》、《人间失格》等，多为自我生活的写照，表现日本社会与现代人精神与感官世界的双重萎靡。太宰治曾多次自杀未遂，最终在三十九岁时与最后一位爱人相约投水自尽。 [2] </p><p>《人间失格》<br>内容摘要：<br>俗话说：“金钱散尽，情缘两断”。其实人们对于这句话的解释是颠倒的。并不是说男人的钱一用光，就会被女人甩掉。而是说男人一旦没有钱，就会意志消沉，变得颓废窝囊，连笑的力气都没有。性格也开始扭曲，最终破罐子破摔，主动甩掉女人。</p><p>我的想法：<br>主角大庭叶藏，生于惶惶不安之中，讨好他人，表面做一些滑稽之事，是为了掩藏内心的恐惧和不安。这种不安恐惧出自对其他人的不信任，无论是对于他的朋友家庭还是亲人。他长得俊美，但整日酗酒，对于女人，抱着可有可无的态度。他不会直接去拒绝一个女人，而是用自己独特的滑稽手段，去敷衍去奉承。<br>看完这篇手札，不想再娱乐自己了，看着叶藏用自己滑稽去逗乐其他人，把他们逗得捧腹大笑，而自己却惶惶不安，不禁想这样是为了什么。人生在世，一本正经的活着，不苟言笑，谨言慎行；亦或是逗逼气质十足，弄些恶心的言语色情的言语，找人世中微不足道的存在感，沦为别人眼中的笑柄。</p><p>读书摘录：<br>我自幼体弱多病，长期卧床在铺。躺在床上，我笃定地认为这些床单，枕头套、被套都是单调乏味的装饰品。将满二十岁时，才得知这些竟也都是实用品。颇感意外，对于人活于世的简朴，不禁悲从中来。</p><p>百度书评：<br>一个封闭在自己世界里的主人公。<br>书中的主人公叶藏既不能理解女人心的浅薄，也不断被朋友利用，却认为妥协退让才是活下去的方法，甚至为了混迹世间，学习人性的种种卑劣。第一手札描写的三张照片可说是其一生的缩影。从强颜欢笑到矫饰轻薄，最后是而无表情的“死相”，正是叶藏极力迎合社会却最终失败的一生。叙述者“我”对三张照片的评价毫不客气—古怪，令人生厌。这无疑是站在社会一般人的角度去评价叶藏；也可以说是太宰治分裂出来一个“正常”的人格来痛斥自己。这种自虐式的叙述却很难读出讽刺的意味，反倒情真意切得令人同情。接下来的第二手札则是叶藏对自己“罪孽”的陈述。幼年叶藏的本性曾与人类最丑恶的七宗罪之一—欺骗发生了第一次冲击。父亲的演讲会上，男佣们背地里批评演讲枯燥无味，一转身又为了讨好主人而赞不绝口。叶藏口睹了这一“可恨罪想”，为人类在生活中表现出来的心口不一而惊异，同时又认为这必是活下去的“妙谛”。他是个与常识社会格格不入的“外人”，故而他对人类种种常态的评述就显得分外客观有力。</p><p>Goodby<br>田岛想要离开自己的十个情人，与自己将要从乡下来到城市的妻子同居安分守己的日子。但无奈自己过于软弱，不想在告别情人的同时伤害他们，于是就让绢子打扮起来，让那些情人自己察觉。无奈绢子过分贪财，而且嗓门又像乌鸦。处处占小便宜，自己不舍得花钱，却很喜欢用别人的钱，田岛请客的时候，她恨不得吃撑死。如此一个道德品质低劣的女人，然后就没有然后了。<br>个人十分不喜绢子的设定。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;作者背景：&lt;br&gt;昭和6年，太宰治与初代同居，后又开始从事共产主义运动，为此几次搬家，在此期间，他发现自己一直信任的妻子在认识他之前早己与人有染，内心受到极大的打击，于是，他去青森警察署自首，为自己的共产主义革命生涯划上了句号。昭和10年，太宰治在镰仓山企图自缢未果。&lt;br
      
    
    </summary>
    
    
      <category term="摘录" scheme="http://archks.gitee.io/web/categories/%E6%91%98%E5%BD%95/"/>
    
    
  </entry>
  
  <entry>
    <title>解决Hexo+Github网络图片无法加载问题</title>
    <link href="http://archks.gitee.io/web/2020/07/08/%E8%A7%A3%E5%86%B3Hexo-Github%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/"/>
    <id>http://archks.gitee.io/web/2020/07/08/%E8%A7%A3%E5%86%B3Hexo-Github%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/</id>
    <published>2020-07-08T05:03:47.000Z</published>
    <updated>2020-07-08T05:14:26.182Z</updated>
    
    <content type="html"><![CDATA[<p>如下图是我将Hexo搬到Github上时，网络图片加载不出来的情况，图片链接是完好的：</p><img no-lazy src="https://s1.ax1x.com/2020/07/08/UEzfJI.png" alt="UEzfJI.png"  /><p>解决方法：</p><blockquote><p><a href="https://github.com/Troy-Yang/hexo-lazyload-image" target="_blank" rel="noopener">https://github.com/Troy-Yang/hexo-lazyload-image</a></p></blockquote><p>1、安装hexo-lazyload-image</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-lazyload-image --save</span><br></pre></td></tr></table></figure><p>2、修改project里的主_config.yml配置</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lazyload:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">  onlypost: <span class="literal">false</span> <span class="comment"># optional</span></span><br><span class="line">  loadingImg: <span class="comment"># optional eg ./images/loading.gif</span></span><br><span class="line">  isSPA: <span class="literal">false</span> <span class="comment"># optional</span></span><br></pre></td></tr></table></figure><p>3、设置图片样式，只需要设置一个图片样式</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;img no-lazy src=<span class="string">"abc.png"</span> /&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;如下图是我将Hexo搬到Github上时，网络图片加载不出来的情况，图片链接是完好的：&lt;/p&gt;
&lt;img no-lazy src=&quot;https://s1.ax1x.com/2020/07/08/UEzfJI.png&quot; alt=&quot;UEzfJI.png&quot;  /&gt;



&lt;p&gt;解
      
    
    </summary>
    
    
      <category term="报错" scheme="http://archks.gitee.io/web/categories/%E6%8A%A5%E9%94%99/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker中Django迁移无效</title>
    <link href="http://archks.gitee.io/web/2020/07/08/Django-Err1/"/>
    <id>http://archks.gitee.io/web/2020/07/08/Django-Err1/</id>
    <published>2020-07-08T02:12:54.000Z</published>
    <updated>2020-07-08T05:02:21.498Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">django-admin startproject project</span><br><span class="line">cd project</span><br><span class="line">python manage.py startapp api</span><br></pre></td></tr></table></figure><p>可以看到，虽然执行了<code>python manage.py makemigrations</code>，但是models.py中定义的模型并没有迁移到数据库中，网上找了很久，发现是要再后面加上APP名，即<code>python manage.py makemigrations api</code></p><hr><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/07/08/UERPOO.png" alt="UERPOO.png"></p><img no-lazy src="https://s1.ax1x.com/2020/07/08/UE26Qf.png" alt="UE26Qf.png"  /><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/07/08/UE2bOU.png" alt="UE2bOU.png"></p><hr><p>我的文件目录是这样的：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@ project]<span class="comment"># tree -L 2</span></span><br><span class="line">.</span><br><span class="line">├── api</span><br><span class="line">│   ├── admin.py</span><br><span class="line">│   ├── apps.py</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── migrations</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   ├── __pycache__</span><br><span class="line">│   ├── tests.py</span><br><span class="line">│   ├── urls.py</span><br><span class="line">│   └── views.py</span><br><span class="line">├── manage.py</span><br><span class="line">└── project</span><br><span class="line">    ├── asgi.py</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── __pycache__</span><br><span class="line">    ├── settings.py</span><br><span class="line">    ├── urls.py</span><br><span class="line">    └── wsgi.p</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;django-a
      
    
    </summary>
    
    
      <category term="报错" scheme="http://archks.gitee.io/web/categories/%E6%8A%A5%E9%94%99/"/>
    
    
  </entry>
  
  <entry>
    <title>SSH——用户密钥未在远程主机注册</title>
    <link href="http://archks.gitee.io/web/2020/07/06/SSH%E2%80%94%E7%94%A8%E6%88%B7%E5%AF%86%E9%92%A5%E6%9C%AA%E5%9C%A8%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E6%B3%A8%E5%86%8C/"/>
    <id>http://archks.gitee.io/web/2020/07/06/SSH%E2%80%94%E7%94%A8%E6%88%B7%E5%AF%86%E9%92%A5%E6%9C%AA%E5%9C%A8%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E6%B3%A8%E5%86%8C/</id>
    <published>2020-07-06T03:43:16.000Z</published>
    <updated>2020-07-06T03:57:26.488Z</updated>
    
    <content type="html"><![CDATA[<p>如图：</p><div align="center"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/07/06/UCaFDe.png" style="zoom:33%;" /></div><p>刚开始以为是上传的公钥不对，结果生成了几次公钥，发现还是老样子。后来去检查<code>/etc/ssh/sshd_config</code>配置文件，没检查出什么问题，于是从其他主机（能用私钥登录的主机）上复制了SSH的配置文件到本故障主机，然后重启SSHD服务，再用私钥连接，还是出现以上问题！</p><p>查看<code>/var/log/secure</code>日志文件：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Authentication refused: bad ownership or modes <span class="keyword">for</span> file /root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>发现是权限不匹配的问题</p><p>解决：</p><blockquote><p><a href="https://www.bo56.com/ssh%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E9%99%86%E8%AE%BE%E7%BD%AE%E6%97%B6authentication-refused-bad-ownership-or-modes%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" target="_blank" rel="noopener">https://www.bo56.com/ssh%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E9%99%86%E8%AE%BE%E7%BD%AE%E6%97%B6authentication-refused-bad-ownership-or-modes%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</a></p></blockquote><p>sshd为了安全，对属主的目录和文件权限有所要求。如果权限不对，则ssh的免密码登陆不生效。<br>用户目录权限为 755 或者 700，就是不能是77x。<br>.ssh目录权限一般为755或者700。<br>rsa_id.pub 及authorized_keys权限一般为644<br>rsa_id权限必须为600</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;如图：&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;
&lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0
      
    
    </summary>
    
    
      <category term="报错" scheme="http://archks.gitee.io/web/categories/%E6%8A%A5%E9%94%99/"/>
    
    
  </entry>
  
  <entry>
    <title>Dockerfile制作Nginx容器</title>
    <link href="http://archks.gitee.io/web/2020/06/29/Produce-the-docker-image-about-nginx/"/>
    <id>http://archks.gitee.io/web/2020/06/29/Produce-the-docker-image-about-nginx/</id>
    <published>2020-06-29T02:59:50.000Z</published>
    <updated>2020-07-08T05:08:23.044Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>飞絮飞花何处是，层冰积雪摧残，疏疏一树五更寒。爱他明月好，憔悴也相关。<br>最是繁丝摇落后，转教人忆春山。湔裙梦断续应难。西风多少恨，吹不散眉弯。</p></blockquote><a id="more"></a><h1 id="困难"><a href="#困难" class="headerlink" title="困难"></a>困难</h1><ul><li><input checked="" disabled="" type="checkbox"> 容器启动流程</li><li><input checked="" disabled="" type="checkbox"> Sed替换等命令</li><li><input checked="" disabled="" type="checkbox"> CMD和EntryPoint的异同</li><li><input checked="" disabled="" type="checkbox"> 动态指定全局、局部参数</li><li><input checked="" disabled="" type="checkbox"> 优化哪些方面</li><li><input disabled="" type="checkbox"> 脚本能够正确的读取参数，且正确的写入到配置文件!!!</li></ul><h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>Docker镜像制作/容器运行<br>1、制作一个Nginx镜像，遵循镜像可迁移、可复制原则、镜像、层级、体积最小化原则<br>2、要求启动能支持指定Nginx进程的监听端口<br>3、首页输出一个hello world<br>4、容器支持开机启动、异常能自拉起<br>5、能够任意指定Nginx的公共参数，包括global、http等全局模块的参数；<br>6、通过启动指定Nginx优化参数，实现首页性能并发超2万（4核服务器）。</p><h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><h2 id="1、制作Nginx容器？"><a href="#1、制作Nginx容器？" class="headerlink" title="1、制作Nginx容器？"></a>1、制作Nginx容器？</h2><p>一开始的时候，以为是要从CentOS7中一步一步用命令安装Nginx，后来发现这样不太合理[中间层不够精简]，就用了Nginx的官方镜像。</p><h2 id="2、动态指定参数"><a href="#2、动态指定参数" class="headerlink" title="2、动态指定参数?"></a>2、动态指定参数?</h2><p>方法一：模板！<br>如果想要修改端口，那么就必须在Nginx服务起来之前改才有效(了解Docker容器启动流程对完成这一步很有帮助，下面会讲到Docker启动流程)。Nginx官方的template支持该端口，在宿主机编写nginx.conf.template模板，然后复制到容器的/etc/nginx/tempalte/目录，容器会自动把template模板语法填入变量，然后生成conf配置文件且放到容器的/etc/nginx/conf.d/</p><p>方法二：脚本！<br>脚本必须是容器启动时执行的脚本，一般就是EntryPoint的执行脚本。通过在<code>docker run -e ENV=XXX</code>的时候指明环境变量，然后再脚本中调用环境变量，通过sed替换配置文件，然后启动nginx，来达到修改端口，这种方法也可以修改Nginx的其他参数。</p><h2 id="3、Nginx优化？"><a href="#3、Nginx优化？" class="headerlink" title="3、Nginx优化？"></a>3、Nginx优化？</h2><h3 id="维度1：网络"><a href="#维度1：网络" class="headerlink" title="维度1：网络"></a>维度1：网络</h3><ul><li><input checked="" disabled="" type="checkbox"> 提高连接数</li><li><input checked="" disabled="" type="checkbox"> 选择响应模型</li><li><input disabled="" type="checkbox"> Gzip</li><li><input checked="" disabled="" type="checkbox"> sendfile</li><li><input checked="" disabled="" type="checkbox"> tcp_nopush</li></ul><p><strong>（1）提高连接并发</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">worker_processes  # Nginx进程</span><br><span class="line">worker_connections # 每个进程的最大连接数</span><br></pre></td></tr></table></figure><blockquote><p>官方建议Nignx进程数目和CPU核心数相同， 这样可以减少上下文切换带来的消耗，但是Nginx接受响应的机制是：当有一个请求过来时，先抢到的worker就处理这个请求，也就意味着，worker数量越多，Nginx并发就越高，同时需要考虑进程切换带来的损耗，把上下文切换损耗、Worker进程并发维持在一个合理的值？</p></blockquote><p>CPU数量为2<br>先设置Worker数量为2，查看并发：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@cmd ~]<span class="comment"># for i in &#123;1..3&#125;;do ./hey -c 20000 -z 5s http://localhost:8080 | grep Request; done</span></span><br><span class="line">  Requests/sec:18919.2902</span><br><span class="line">  Requests/sec:20607.1078</span><br><span class="line">  Requests/sec:21383.8651</span><br></pre></td></tr></table></figure><p>设置Worker数量为4，查看并发：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@cmd ~]# for i in &#123;1..3&#125;;do ./hey -c 20000 -z 5s http://localhost:8080 | grep Request; done</span><br><span class="line">  Requests/sec:20987.5554</span><br><span class="line">  Requests/sec:20566.2954</span><br><span class="line">  Requests/sec:21486.3096</span><br></pre></td></tr></table></figure><p>设置Worker数量为8，查看并发：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@cmd ~]# for i in &#123;1..3&#125;;do ./hey -c 20000 -z 5s http://localhost:8080 | grep Request; done</span><br><span class="line">  Requests/sec:18960.3266</span><br><span class="line">  Requests/sec:19998.3097</span><br><span class="line">  Requests/sec:19924.4970</span><br></pre></td></tr></table></figure><blockquote><p>可见适当提高Worker的数量确实可以提高并发，但是并不明显，而且如果Worker数量过多，甚至会减少并发。</p></blockquote><br><p><strong>（2）改变请求响应机制</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">events&#123;</span><br><span class="line">    use epoll;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><p><strong>（3）Gzip相关</strong><br>原本打算开Gzip的，这个对大文件有效，但是对于小文件，开了Gzip反而会消耗CPU资源[当然这个消耗也很小]，会得不偿失。</p><br><p><strong>（4）零拷贝</strong></p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/index.html</a><br>可以直接在内核中完成文件传输<br>如果应用程序可以直接访问网络接口存储，那么在应用程序访问数据之前存储总线就不需要被遍历，数据传输所引起的开销将会是最小的。应用程序或者运行在用户模式下的库函数可以直接访问硬件设备的存储，操作系统内核除了进行必要的虚拟存储配置工作之外，不参与数据传输过程中的其它任何事情。直接 I/O 使得数据可以直接在应用程序和外围设备之间进行传输，完全不需要操作系统内核页缓存的支持。</p></blockquote><br><p><strong>（5）Nopush</strong><br>这个选项Nginx默认关闭，我们选择打开。在<code>sendfile</code>开启情况下，tcp_nopush可以提高网络包的<code>传输效率</code>，所有资源一起打包然后发送，但没有实时性。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcp_nopush on;</span><br></pre></td></tr></table></figure><br><br><h3 id="维度2：磁盘"><a href="#维度2：磁盘" class="headerlink" title="维度2：磁盘"></a>维度2：磁盘</h3><p><strong>（1）加缓存</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxy_cache_path /tmp/cache levels=1:2 keys_zone=code_cache:10m max_size=10g inactive=60m use_temp_path=off;</span><br></pre></td></tr></table></figure><p>还是2核CPU，2个Worker：【不加tcp_nopush】</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@cmd ~]# for i in &#123;1..3&#125;;do ./hey -c 30000 -z 5s http://127.0.0.1:80 | grep Request;done</span><br><span class="line">  Requests/sec:52213.8096</span><br><span class="line">  Requests/sec:53834.7774</span><br><span class="line">  Requests/sec:55434.2433</span><br></pre></td></tr></table></figure><p>可以看到加了缓存之后，并发涨了2.5倍。</p><br><p><strong>（2）减读写</strong><br>因为日志写入需要占用大量的IO，所以关闭了日志写入，如果不想做的太极端，可以调整写入级别，尽量只写入少量日志。</p><br><p><strong>（3）调整最大文件打开数目</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ulimit -n 65535</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 同时连接的数量受限于系统上可用的文件描述符的数量</span></span><br><span class="line">worker_rlimit_nofile  # 将此值增加到大于worker_processes * worker_connections的值</span><br></pre></td></tr></table></figure><br><h3 id="维度3：CPU"><a href="#维度3：CPU" class="headerlink" title="维度3：CPU"></a>维度3：CPU</h3><p>绑定Worker进程到指定CPU</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">4</span>;         <span class="comment"># 4核CPU的配置</span></span><br><span class="line"><span class="attribute">worker_cpu_affinity</span> <span class="number">0001</span> <span class="number">0010</span> <span class="number">0100</span> <span class="number">1000</span>; <span class="comment"># 将每个Worker进程绑定到一个CPU</span></span><br></pre></td></tr></table></figure><p>作用不大！</p><br><hr><p><strong>总结</strong>：如果不加缓存，磁盘会成为瓶颈，加了缓存，CPU会成为瓶颈。</p><img no-lazy src="https://s1.ax1x.com/2020/06/29/NflGTA.png" alt="宿主机资源占用"  /><center>[1,2 分别是两颗CPU]</center><h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><ul><li><input checked="" disabled="" type="checkbox"> Version 1 【镜像制作】</li><li><input checked="" disabled="" type="checkbox"> Version 2 【指定参数，优化并发】</li><li><input checked="" disabled="" type="checkbox"> Version 3 【指定参数，优化并发】</li><li><input checked="" disabled="" type="checkbox"> Version 4 【任意参数指定，进一步提升并发】</li></ul><hr><p><strong>Version 1</strong></p><ul><li><input checked="" disabled="" type="checkbox"> 制作Nginx镜像</li><li><input checked="" disabled="" type="checkbox"> 修改监听端口</li><li><input checked="" disabled="" type="checkbox"> 能正常访问</li><li><input disabled="" type="checkbox"> 指定任意参数</li><li><input disabled="" type="checkbox"> Nginx优化</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/29/NW6z9K.png" alt="CentOS安装Nginx的Dockerfile"></p><p>为什么一开始注释掉了<code>CMD [&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;]</code> ———— 因为不注释就会导致容器拉起异常！原因是因为容器开机会执行docker-entrypoint脚本，然而我的EntryPoint脚本中并没有写”exec $@”，就不会把Nginx放到前台执行，导致了容器执行完脚本直接退出。刚开始用的解决办法是把Nginx进程直接写到check.sh中，通过EntryPoint执行，这样也能保证前台有Nginx任务，docker容器不至于异常退出。</p><blockquote><p>Docker容器进程需要放在前台执行，如果那么脚本执行完前台没有任务，那么容器会自动退出。<br>容器启动时会加载CMD命令，如果有EntryPoint，那么就加载EntryPoint，CMD作为参数传给EntryPoint。</p></blockquote><br><br><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/29/NWcwDJ.png" alt="容器中的健康检查脚本"></p><p>这个健康检查脚本应该没什么用，如果一号进程退出了，容器就挂了，给自己的健康检查也就做不了了，后来换成了再docker run的时候加上–restart=always参数，并且保证docker daemon能够开机自启。</p><br><br><hr><p><strong>Version 2</strong></p><ul><li><input checked="" disabled="" type="checkbox"> 尝试在命令行着替换部分参数，用的是容器内部读取环境变量的方法</li><li><input disabled="" type="checkbox"> 还是未能完成全部参数的动态指定</li><li><input disabled="" type="checkbox"> 优化了Nginx并发</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/29/NWfU0g.png" alt="NWfU0g.png"></p><br><br><hr><p><strong>Version 3</strong></p><ul><li><input disabled="" type="checkbox"> 未能实现全部配置可自定义</li><li><input checked="" disabled="" type="checkbox"> 优化了Nginx并发</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nginx ~ ]#cat start.sh   # &lt;====这是个容器开机启动脚本</span><br><span class="line">append()&#123;</span><br><span class="line">    echo "$&#123;1&#125;" &gt;&gt; /etc/nginx/nginx.conf</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rm /etc/nginx/nginx.conf -rf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> WORK_PROGRESSES=4</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WORKER_CPU_AFFINITY=<span class="string">"0001 0010 0100 1000"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WORKER_RLIMIT_NOFILE=65535</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WORKER_CONNECTIONS=65535</span></span><br><span class="line"></span><br><span class="line">append  "user  nginx;"</span><br><span class="line">append  "worker_processes $&#123;WORK_PROGRESSES&#125;;"</span><br><span class="line">append  "worker_cpu_affinity $&#123;WORKER_CPU_AFFINITY&#125;;"</span><br><span class="line">append  "worker_rlimit_nofile $&#123;WORKER_RLIMIT_NOFILE&#125;;"</span><br><span class="line">append  "pid /var/run/nginx.pid;"</span><br><span class="line">append  "events &#123; use epoll; worker_connections $&#123;WORKER_CONNECTIONS&#125;;&#125;"</span><br><span class="line">append  "http &#123;"</span><br><span class="line">append  "include       /etc/nginx/mime.types;"</span><br><span class="line">append  "default_type  application/octet-stream;"</span><br><span class="line">append  "open_file_cache max=65535 inactive=60s;"</span><br><span class="line">append  " sendfile       on;"</span><br><span class="line">append  " tcp_nopush     on;"</span><br><span class="line">append  " tcp_nodelay     on;"</span><br><span class="line">append  " keepalive_timeout $&#123;KEEPALIVE_TIMEOUT&#125;;"</span><br><span class="line">append  " include /etc/nginx/conf.d/*.conf;"</span><br><span class="line">append  "&#125;"</span><br><span class="line">sed -i '0,/listen.*;/s/listen.*;/listen '$&#123;LISTEN&#125;';/' /etc/nginx/conf.d/default.conf</span><br><span class="line">exec "$@"</span><br></pre></td></tr></table></figure><p>直接把环境变量echo进nginx配置文件，这样写比sed简单，且能达到同样的效果。</p><br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@nginx ~ ]# cat dockerfile</span><br><span class="line">FROM nginx:latest</span><br><span class="line">MAINTAINER zen &lt;2212585023@qq.com&gt;</span><br><span class="line">ENV NGINX_VERSION 1.19.1</span><br><span class="line">COPY ./index.html /usr/share/nginx/html/</span><br><span class="line">COPY ./start.sh /</span><br><span class="line">RUN chmod +x /start.sh</span><br><span class="line">STOPSIGNAL SIGTERM # 这个是kill -15 温柔的杀死容器里的1号进程</span><br><span class="line">EXPOSE 80</span><br><span class="line">ENTRYPOINT ["/start.sh"]</span><br><span class="line">CMD ["nginx", "-g", "daemon off;"]</span><br></pre></td></tr></table></figure><p>拉去Nginx镜像，复制HTML文件，复制开机启动脚本，需要注意的是，Nginx官方默认docker-entrypoint.d/目录下的脚本就是开机启动脚本，执行Nginx启动命令。</p><blockquote><p>关于 CMD [“nginx”,”-g”,”daemon off;”] 这个命令，刚开始我以为是在命令行执行nginx -g daemon off，但是在容器内，这条命始终执行不了，以至于我怀疑CMD到底是干什么？命令到底是怎么执行的？越搞越乱！后来发现这条命令执行还需要加一些符号，即Nginx -g “daemon off;” ，这个问题纠结了很久！</p></blockquote><br><p>运行方式</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -itd  \</span><br><span class="line"> -e WORK_PROGRESSES=2 \</span><br><span class="line"> -e WORKER_RLIMIT_NOFILE=65535 \</span><br><span class="line"> -e WORKER_CONNECTIONS=65535 \</span><br><span class="line"> -e KEEPALIVE_TIMEOUT=15 \</span><br><span class="line"> -e LISTEN=80\</span><br><span class="line"> --net=host --name x1 nginx/v1</span><br></pre></td></tr></table></figure><br><hr><p><strong>Version 4</strong></p><ul><li><input checked="" disabled="" type="checkbox"> 任意参数指定</li><li><input checked="" disabled="" type="checkbox"> 更高的并发</li></ul><p>先看结果，还是原来的两核CPU，实现了57000左右的并发</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@cmd ~]# for i in &#123;1..3&#125;;do ./hey -c 30000 -z 5s http://127.0.0.1:8080 | grep Requests;done</span><br><span class="line">  Requests/sec:58493.2355</span><br><span class="line">  Requests/sec:55574.4684</span><br><span class="line">  Requests/sec:56862.8460</span><br></pre></td></tr></table></figure><p>思路还是在启动容器的时候执行EntryPoint脚本修改Nginx参数，不同的地方在于将Nginx参数位置作为前缀，通过前缀指定参数插入的位置，比如</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Global   -- ngx_glo_worker_progress     相当于全局配置下的worker_progress</span><br><span class="line">Events   -- ngx_evt_worker_connections  相当于events中的worker_connections</span><br><span class="line">Http     -- ngx_http_sendfile           相当于http模块中的sendfile</span><br><span class="line">Server   -- ngx_ser_listen              相当于server模块中的listen</span><br><span class="line">Location -- ngx_loc_root                相当于location模块中的root</span><br></pre></td></tr></table></figure><br>通过case进行筛选，然后插入到nginx.conf配置文件的不同位置,脚本代码如下：<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CONFIG_PATH=/etc/nginx/nginx.conf </span><br><span class="line"></span><br><span class="line">cat &gt;/etc/nginx/nginx.conf &lt;&lt; 'EOF'</span><br><span class="line">user nginx;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 default_server;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root /usr/share/nginx/html/;</span><br><span class="line">            add_header Nginx-Cache "$upstream_cache_status";</span><br><span class="line">            proxy_set_header Host $http_host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            include params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/nginx/params &lt;&lt; 'EOF'</span><br><span class="line">proxy_connect_timeout 30;</span><br><span class="line">proxy_send_timeout 60;</span><br><span class="line">proxy_read_timeout 60;</span><br><span class="line">proxy_buffer_size 32k;</span><br><span class="line">proxy_buffering on;</span><br><span class="line">proxy_buffers 4 128k;</span><br><span class="line">proxy_busy_buffers_size 256k;</span><br><span class="line">proxy_max_temp_file_size 256k;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 读出来的时候只有：ngx_http_proxy_cache_path=/tmp/cache</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 遗留Bug！！！</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 已有的替换 出现[include]会替换多个</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 没有的插入 [<span class="variable">$proxy_add_x_forwarded_for</span>] 没有测试能否插入变量，\<span class="variable">$xxx</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 用line循环可以避免中间有空行的变量：ngx_http_proxy_cache_path=/tmp/cache levels=1:2 keys_zone=code_cache:10m max_size=10g inactive=60m use_temp_path=off</span></span><br><span class="line">line=$(env | grep -E "^ngx" | wc -l)</span><br><span class="line">for i in `seq $line`;</span><br><span class="line">do</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 这里将第一个<span class="string">'='</span>号替换为0x80是为了防止后面有相同的等号误操作，比如ngx_http_proxy_cache_path=/tmp/cache levels=1:2;这样的变量</span></span><br><span class="line">    one=$(env | grep -E "^ngx" | sed -n $&#123;i&#125;'p')</span><br><span class="line">    value=$(echo  "$&#123;one&#125;"  | sed 's/=/0x80/1' | awk -F '0x80' '&#123;print $2&#125;' )</span><br><span class="line">    field=$(echo  "$&#123;one&#125;"  | sed 's/=/0x80/1' | awk -F '0x80' '&#123;print $1&#125;' ) # field=前缀+后缀 </span><br><span class="line">    prefix=$(echo "$&#123;field&#125;"  | sed 's/_/ /2' | awk '&#123;print $1&#125;') # 前缀决定字段的位置 ngx_loc</span><br><span class="line">    suffix=$(echo "$&#123;field&#125;" | sed 's/_/ /2' | awk '&#123;print $2&#125;')  # 后缀决定什么字段 listen</span><br><span class="line"></span><br><span class="line">    glo_ins()&#123;</span><br><span class="line">        field=$&#123;1&#125;" "$&#123;2&#125;";"</span><br><span class="line">        if [[ -z $(grep "$1" $&#123;CONFIG_PATH&#125;) ]];then</span><br><span class="line">        # 由于出现过ngx_http_tcp_nopush会插入到proxy_set_header Host $http_host;下面，所有在sed侧加入了完全匹配\&lt;\&gt;</span><br><span class="line">            sed -i '/\&lt;events\&gt;/i '"$&#123;field&#125;" $&#123;CONFIG_PATH&#125;</span><br><span class="line">        else </span><br><span class="line">            sed -i '/\&lt;'"$&#123;1&#125;"'\&gt;/c '"$&#123;field&#125;" $&#123;CONFIG_PATH&#125;</span><br><span class="line">        fi</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    oth_insrt()&#123;</span><br><span class="line">        module="$&#123;1&#125;"</span><br><span class="line">        field="$&#123;2&#125; $&#123;3&#125;;"</span><br><span class="line">        if [[ -z $(grep "$2" $&#123;CONFIG_PATH&#125;) ]];then</span><br><span class="line">            sed -i '/\&lt;'"$&#123;module&#125;"'\&gt;/a '"$&#123;field&#125;"  $&#123;CONFIG_PATH&#125;</span><br><span class="line">        else </span><br><span class="line">            sed -i '/\&lt;'"$&#123;2&#125;"'\&gt;/c '"$&#123;field&#125;"  $&#123;CONFIG_PATH&#125;</span><br><span class="line">        fi</span><br><span class="line">    &#125;</span><br><span class="line">    # 主要逻辑如下：</span><br><span class="line">    case $&#123;prefix&#125; in</span><br><span class="line">    ngx_glo)</span><br><span class="line">        glo_ins "$suffix" "$value"</span><br><span class="line">        ;;</span><br><span class="line">    ngx_evt)</span><br><span class="line">        oth_insrt events "$suffix" "$value"</span><br><span class="line">        ;;</span><br><span class="line">    ngx_http)</span><br><span class="line">        oth_insrt http "$suffix" "$value"</span><br><span class="line">        ;;</span><br><span class="line">    ngx_ser)</span><br><span class="line">        oth_insrt server "$suffix" "$value"</span><br><span class="line">        ;;</span><br><span class="line">    ngx_loc)</span><br><span class="line">        oth_insrt location "$suffix" "$value"</span><br><span class="line">        ;;</span><br><span class="line">    esac</span><br><span class="line">done</span><br><span class="line">exec "$@"</span><br></pre></td></tr></table></figure><ul><li><input checked="" disabled="" type="checkbox"> &nbsp;&nbsp;Sed各种匹配替换</li><li><input checked="" disabled="" type="checkbox"> “${var}”所包含的是一个完整的变量，如果用${var}且变量为”x=1 y=2 z=3”,那么从环境变量里取出来的时候，往往只能取到x=1</li></ul><p>参数指定如下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat run.sh </span></span><br><span class="line">docker rm $(docker ps -a | grep -E '\&lt;x1\&gt;' | awk '&#123;print $1&#125;') -f</span><br><span class="line">docker rmi $(docker image ls | grep 'nginx/v1' |awk '&#123;print $3&#125;')  --force</span><br><span class="line">docker build -t nginx/v1 .</span><br><span class="line">docker run -itd --cpuset-cpus="0,1" \</span><br><span class="line">-e ngx_glo_worker_processes=4 \</span><br><span class="line">-e ngx_glo_worker_rlimit_nofile=65535 \</span><br><span class="line">-e ngx_evt_worker_connections=65535 \</span><br><span class="line">-e ngx_http_tcp_nopush=on \</span><br><span class="line">-e ngx_http_sendfile=on \</span><br><span class="line">-e ngx_http_proxy_cache_path="/tmp/cache levels=1:2 keys_zone=code_cache:10m max_size=10g inactive=60m use_temp_path=off" \</span><br><span class="line">-e ngx_ser_listen=8080 \</span><br><span class="line">-e ngx_loc_proxy_cache=code_cache \</span><br><span class="line">-e ngx_loc_proxy_cache_valid="any 30m" \</span><br><span class="line">--net=host --name --restart=always x1 nginx/v1</span><br></pre></td></tr></table></figure><hr><br><br><br>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;飞絮飞花何处是，层冰积雪摧残，疏疏一树五更寒。爱他明月好，憔悴也相关。&lt;br&gt;最是繁丝摇落后，转教人忆春山。湔裙梦断续应难。西风多少恨，吹不散眉弯。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="容器" scheme="http://archks.gitee.io/web/categories/%E5%AE%B9%E5%99%A8/"/>
    
    
      <category term="Docker" scheme="http://archks.gitee.io/web/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>VsCode远程开发</title>
    <link href="http://archks.gitee.io/web/2020/06/18/VsCode_Remote_Config/"/>
    <id>http://archks.gitee.io/web/2020/06/18/VsCode_Remote_Config/</id>
    <published>2020-06-18T02:50:36.000Z</published>
    <updated>2020-07-04T17:18:01.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>草铺横野六七里，笛弄晚风三四声。<br>归来饱饭黄昏后，不脱蓑衣卧月明。</p></blockquote><a id="more"></a><p>Powershell下安装OpenSSH，安装失败也不要紧</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Get-WindowsCapability -Online | ? Name -like <span class="string">'OpenSSH*'</span></span><br><span class="line">Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</span><br><span class="line">Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0</span><br></pre></td></tr></table></figure><p>1、下载插件：Remote Development</p><p>2、Ctrl+Shift+P打开设置Remote SSH Settings，设置Remote.SSH:Show Login Terminal为true</p><p><a href="https://imgchr.com/i/NeFgxO" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/18/NeFgxO.png" alt="NeFgxO.png"></a></p><p>3、左下角会多出来一个远程连接的图标，点击图标会弹出选择框，选择Connect to Host</p><p>4、选择一个Host，或者采用如下形式登录</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh root@x.x.x.x -A</span><br></pre></td></tr></table></figure><p>5、输入登录密码</p><p>6、添加远程文件夹</p><p>7、选择终端解释器，这里我选择了/bin/bash，Ctrl+Shift+` 新建终端</p><p><a href="https://imgchr.com/i/NeFcRK" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/18/NeFcRK.png" alt="NeFcRK.png"></a></p><p>相关链接：</p><blockquote><p><a href="https://blog.csdn.net/yh0503/article/details/89851899" target="_blank" rel="noopener">https://blog.csdn.net/yh0503/article/details/89851899</a></p></blockquote><blockquote><p><a href="https://docs.microsoft.com/zh-cn/windows-server/administration/openssh/openssh_install_firstuse" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/windows-server/administration/openssh/openssh_install_firstuse</a></p></blockquote><hr>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;草铺横野六七里，笛弄晚风三四声。&lt;br&gt;归来饱饭黄昏后，不脱蓑衣卧月明。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="运维" scheme="http://archks.gitee.io/web/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="VsCode" scheme="http://archks.gitee.io/web/tags/VsCode/"/>
    
  </entry>
  
  <entry>
    <title>Win快捷键</title>
    <link href="http://archks.gitee.io/web/2020/06/18/Win_ShotCut/"/>
    <id>http://archks.gitee.io/web/2020/06/18/Win_ShotCut/</id>
    <published>2020-06-18T00:37:32.000Z</published>
    <updated>2020-07-04T17:17:42.906Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>十年生死两茫茫，不思量，自难忘。<br>千里孤坟，无处话凄凉。<br>纵使相逢应不识，尘满面，鬓如霜。<br>夜来幽梦忽还乡，小轩窗，正梳妆。<br>相顾无言，惟有泪千行。<br>料得年年肠断处，明月夜，短松冈。</p></blockquote><a id="more"></a><p>Win+P 投影<br>Win+K 蓝牙<br>Win+D 桌面<br>Win+E 此电脑<br>Win+R 调出”运行”</p><hr><p>Win+Q 搜索<br>Win+W 截图<br>Win+i 设置<br>Win+A 通知<br>Win+F 反馈<br>Win+L 锁屏<br>Win+X 左下功能界面<br>Win+V 历史剪贴板<br>Win+M 最小化当前界面<br>Win+&gt; 表情符号😊🤦‍♂️</p><hr><p>Ctrl+Win+⬅ 切换到左边的桌面<br>Ctrl+Win+➡ 切换到右边的桌面</p><p>分屏功能键<br>Win+up<br>Win+left<br>Win+right<br>Win+down</p><hr><p>Alt+F4+[Fn] 关机<br>Win+Nbr[1,2,3] 打开任务栏第Nbr位的软件<br>Win+Space 切换输入法<br>F2  重命名<br>F11 全屏</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;十年生死两茫茫，不思量，自难忘。&lt;br&gt;千里孤坟，无处话凄凉。&lt;br&gt;纵使相逢应不识，尘满面，鬓如霜。&lt;br&gt;夜来幽梦忽还乡，小轩窗，正梳妆。&lt;br&gt;相顾无言，惟有泪千行。&lt;br&gt;料得年年肠断处，明月夜，短松冈。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="快捷键" scheme="http://archks.gitee.io/web/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    
  </entry>
  
  <entry>
    <title>ls根目录卡死</title>
    <link href="http://archks.gitee.io/web/2020/06/17/ls_root_broken_down/"/>
    <id>http://archks.gitee.io/web/2020/06/17/ls_root_broken_down/</id>
    <published>2020-06-17T14:46:04.000Z</published>
    <updated>2020-07-06T03:43:55.355Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>无善无恶心之体，有善有恶意之动<br>知善知恶是良知，为善去恶是格物</p></blockquote><a id="more"></a><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>只要涉及到根目录，使用ls和df命令就会出现卡死情况。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@zen] <span class="built_in">pwd</span></span><br><span class="line">/root</span><br><span class="line">[root@zen] ls /</span><br><span class="line">^C</span><br><span class="line">[root@zen] df h</span><br><span class="line">^C</span><br><span class="line">[root@zen] ls /opt</span><br><span class="line">containerd  google  jumpserver  mysql  prometheus</span><br></pre></td></tr></table></figure><h1 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h1><p>1、起初在网上找了一些方法，大多是目录挂载的问题；里面叫你用strace定位问题，然后在lstate的时候会发现是目录没挂载上去，但是我用strace的时候，是正常退出的，因为流程过长，strace的log放在结尾了。</p><p>类似于这样： </p><blockquote><p><a href="https://blog.51cto.com/chaichuan/2104093" target="_blank" rel="noopener">https://blog.51cto.com/chaichuan/2104093</a><br><a href="https://blog.csdn.net/u010801696/article/details/78490103" target="_blank" rel="noopener">https://blog.csdn.net/u010801696/article/details/78490103</a></p></blockquote><p>2、后来发现可能是日志文件过大，或者是文件细碎导致ls太慢，通常是/var/spool/postfix/这个目录下的maildrop太大，但是我看了一下我的，并没有太大。maildrop 爆满的问题一般是 crontab 未屏蔽错误造成的,可以将crontab里的条目指定到&amp;&gt;/dev/null</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@zen]<span class="comment"># ll /var/spool/postfix/</span></span><br><span class="line">total 56</span><br><span class="line">drwx------. 2 postfix root     4096 Oct 31  2018 active</span><br><span class="line">drwx------. 2 postfix root     4096 Oct 31  2018 bounce</span><br><span class="line">drwx------. 2 postfix root     4096 Oct 31  2018 flush</span><br><span class="line">drwx------. 2 postfix root     4096 Oct 31  2018 hold</span><br><span class="line">drwx------. 2 postfix root     4096 Oct 31  2018 incoming</span><br><span class="line">drwx-wx---. 2 postfix postdrop 4096 Oct 31  2018 maildrop</span><br></pre></td></tr></table></figure><p>3、第三种可能是磁盘挂载的问题，根目录丢失之类的。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /etc/fstab</span><br><span class="line">cat /etc/mtab</span><br><span class="line">grep -v rootfs /proc/mounts <span class="comment"># 修复</span></span><br></pre></td></tr></table></figure><p>/etc/fstab 中的挂载点是开机加载的<br>/etc/mtab  中的挂载点是内核动态实时更新的<br>简单来说就是一次修复挂载的问题，但是我做完这几部操作，依旧没有用</p><blockquote><p><a href="https://zhang.ge/5107.html" target="_blank" rel="noopener">https://zhang.ge/5107.html</a></p></blockquote><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>其实和另一台服务器有关，我们暂时把它称之为O[other]，我们这台服务器为M[me],O上开启了NFS服务，Me服务器挂载了O上的磁盘。过了段时间，O服务器进行了重装，但是M服务器还在挂载O上的磁盘，此时other服务器没有开启NFS服务，但是Me服务器依旧挂载着O的磁盘。</p><p>于是执行ls / 命令的时候，me服务器加载目录，加载前几个好好的，在strace中可以看到，但加载到/mount_point的时候，就会向O服务器发送请求，[应该是某个NFSBug，明明O上的NFS Down了，这个M服务器还是在一直等待响应]，于是看上去就像是me服务器卡死了，其实它是在等待NFS的响应。</p><p>采取的解决措施：重启，有尝试过umount卸载挂载点，但会卡住。</p><hr><p>2020/6/22 看鸟哥Linux私房菜发现也有这方面的情况：</p><p>只要有用到文件系统， 那么整个目录树系统就会主动的去查询全部的挂载点。如果你的 NFS 服务器与客户端之间的联机因为网络问题， 或者是服务器端先关机了，却没有通知客户端，那么客户端只要动到文件系统的指令 (例如 df, ls, cp 等等) ，整个系统就会慢到爆！因为你必须要等到文件系统搜寻等待逾时后，系统才会饶了你！(鸟哥等过 df 指令 30 分钟过…)</p><table><thead><tr><th>参数</th><th>参数功能</th><th>预设参数</th></tr></thead><tbody><tr><td>fg，bg</td><td>当执行挂载时，该挂载的行为会在前景 (fg) 还是在背景 (bg) 执行？ 若在前景执行时，则 mount 会持续尝试挂载，直到成功或 time out 为止，若为背景执行， 则 mount 会在背景持续多次进行 mount ，而不会影响到前景的程序操作。 如果你的网络联机有点不稳定，或是服务器常常需要开关机，那建议使用 bg 比较妥当。</td><td>fg</td></tr><tr><td>soft，hard</td><td>如果是 hard 的情况，则当两者之间有任何一部主机脱机，则 RPC 会持续的呼叫，直到对方恢复联机为止。如果是 soft 的话，那 RPC 会在 time out 后『重复』呼叫，而非『持续』呼叫， 因此系统的延迟会比较不这么明显。同上，如果你的服务器可能开开关关，建议用 soft 喔！</td><td>hard</td></tr><tr><td>intr</td><td>当你使用上头提到的 hard 方式挂载时，若加上 intr 这个参数， 则当 RPC 持续呼叫中，该次的呼叫是可以被中断的 (interrupted)。</td><td>没有</td></tr><tr><td>rsize，wsize</td><td>读出(rsize)与写入(wsize)的区块大小 (block size)。 这个设定值可以影响客户端与服务器端传输数据的缓冲记忆容量。一般来说， 如果在局域网络内 (LAN) ，并且客户端与服务器端都具有足够的内存，那这个值可以设定大一点， 比如说 32768 (bytes) 等，提升缓冲记忆区块将可提升 NFS 文件系统的传输能力！ 但要注意设定的值也不要太大，最好是达到网络能够传输的最大值为限。</td><td>rsize=1024 wsize=1024</td></tr></tbody></table><p>for example:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mount -t nfs -o nosuid,noexec,nodev,rw  192.168.1.1:/data /tmp</span><br></pre></td></tr></table></figure><p>最后补充下NFS无法挂载的原因分析：</p><ol><li>客户端主机和IP网段不被允许使用, ‘mount to NFS x.x.x.x failed:system error connection refused’</li><li>服务器或客户端服务未启动,’mount to NFS x.x.x.x failed:RPC Error : programe not registered’</li><li>被防火墙拦截</li></ol><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@zen]<span class="comment"># strace  ls / </span></span><br><span class="line">execve(<span class="string">"/usr/bin/ls"</span>, [<span class="string">"ls"</span>, <span class="string">"/"</span>], [/* 23 vars */]) = 0</span><br><span class="line">brk(NULL)                               = 0x169f000</span><br><span class="line">mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd6d51a1000</span><br><span class="line">access(<span class="string">"/etc/ld.so.preload"</span>, R_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">open(<span class="string">"/etc/ld.so.cache"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0644, st_size=52409, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 52409, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7fd6d5194000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libselinux.so.1"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\220j\0\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=155744, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 2255216, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d4d5a000</span><br><span class="line">mprotect(0x7fd6d4d7e000, 2093056, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d4f7d000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x23000) = 0x7fd6d4f7d000</span><br><span class="line">mmap(0x7fd6d4f7f000, 6512, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7fd6d4f7f000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libcap.so.2"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\20\26\0\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=20048, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 2114112, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d4b55000</span><br><span class="line">mprotect(0x7fd6d4b59000, 2093056, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d4d58000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x3000) = 0x7fd6d4d58000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libacl.so.1"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0p\37\0\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=37064, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd6d5193000</span><br><span class="line">mmap(NULL, 2130560, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d494c000</span><br><span class="line">mprotect(0x7fd6d4953000, 2097152, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d4b53000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x7000) = 0x7fd6d4b53000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libc.so.6"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0`&amp;\2\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=2156240, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 3985920, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d457e000</span><br><span class="line">mprotect(0x7fd6d4741000, 2097152, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d4941000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1c3000) = 0x7fd6d4941000</span><br><span class="line">mmap(0x7fd6d4947000, 16896, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7fd6d4947000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libpcre.so.1"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\360\25\0\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=402384, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 2494984, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d431c000</span><br><span class="line">mprotect(0x7fd6d437c000, 2097152, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d457c000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x60000) = 0x7fd6d457c000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libdl.so.2"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0P\16\0\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=19248, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd6d5192000</span><br><span class="line">mmap(NULL, 2109744, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d4118000</span><br><span class="line">mprotect(0x7fd6d411a000, 2097152, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d431a000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x2000) = 0x7fd6d431a000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libattr.so.1"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\320\23\0\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=19896, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 2113904, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d3f13000</span><br><span class="line">mprotect(0x7fd6d3f17000, 2093056, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d4116000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x3000) = 0x7fd6d4116000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">open(<span class="string">"/lib64/libpthread.so.0"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\200m\0\0\0\0\0\0"</span>..., 832) = 832</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0755, st_size=142144, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 2208904, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fd6d3cf7000</span><br><span class="line">mprotect(0x7fd6d3d0e000, 2093056, PROT_NONE) = 0</span><br><span class="line">mmap(0x7fd6d3f0d000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x16000) = 0x7fd6d3f0d000</span><br><span class="line">mmap(0x7fd6d3f0f000, 13448, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7fd6d3f0f000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd6d5191000</span><br><span class="line">mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd6d518f000</span><br><span class="line">arch_prctl(ARCH_SET_FS, 0x7fd6d518f840) = 0</span><br><span class="line">mprotect(0x7fd6d4941000, 16384, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fd6d3f0d000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fd6d4116000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fd6d431a000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fd6d457c000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fd6d4b53000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fd6d4d58000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x7fd6d4f7d000, 4096, PROT_READ) = 0</span><br><span class="line">mprotect(0x61a000, 4096, PROT_READ)     = 0</span><br><span class="line">mprotect(0x7fd6d51a2000, 4096, PROT_READ) = 0</span><br><span class="line">munmap(0x7fd6d5194000, 52409)           = 0</span><br><span class="line">set_tid_address(0x7fd6d518fb10)         = 23051</span><br><span class="line">set_robust_list(0x7fd6d518fb20, 24)     = 0</span><br><span class="line">rt_sigaction(SIGRTMIN, &#123;0x7fd6d3cfd860, [], SA_RESTORER|SA_SIGINFO, 0x7fd6d3d06630&#125;, NULL, 8) = 0</span><br><span class="line">rt_sigaction(SIGRT_1, &#123;0x7fd6d3cfd8f0, [], SA_RESTORER|SA_RESTART|SA_SIGINFO, 0x7fd6d3d06630&#125;, NULL, 8) = 0</span><br><span class="line">rt_sigprocmask(SIG_UNBLOCK, [RTMIN RT_1], NULL, 8) = 0</span><br><span class="line">getrlimit(RLIMIT_STACK, &#123;rlim_cur=8192*1024, rlim_max=RLIM64_INFINITY&#125;) = 0</span><br><span class="line">statfs(<span class="string">"/sys/fs/selinux"</span>, 0x7ffca215e650) = -1 ENOENT (No such file or directory)</span><br><span class="line">statfs(<span class="string">"/selinux"</span>, 0x7ffca215e650)      = -1 ENOENT (No such file or directory)</span><br><span class="line">brk(NULL)                               = 0x169f000</span><br><span class="line">brk(0x16c0000)                          = 0x16c0000</span><br><span class="line">open(<span class="string">"/proc/filesystems"</span>, O_RDONLY)     = 3</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0444, st_size=0, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd6d51a0000</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"nodev\tsysfs\nnodev\trootfs\nnodev\tr"</span>..., 1024) = 371</span><br><span class="line"><span class="built_in">stat</span>(<span class="string">"/etc/sysconfig/64bit_strstr_via_64bit_strstr_sse2_unaligned"</span>, 0x7ffca215dbb0) = -1 ENOENT (No such file or directory)</span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">""</span>, 1024)                       = 0</span><br><span class="line">close(3)                                = 0</span><br><span class="line">munmap(0x7fd6d51a0000, 4096)            = 0</span><br><span class="line">access(<span class="string">"/etc/selinux/config"</span>, F_OK)     = 0</span><br><span class="line">open(<span class="string">"/usr/lib/locale/locale-archive"</span>, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line">fstat(3, &#123;st_mode=S_IFREG|0644, st_size=106172832, ...&#125;) = 0</span><br><span class="line">mmap(NULL, 106172832, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7fd6cd7b5000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">ioctl(1, TCGETS, &#123;B38400 opost isig icanon <span class="built_in">echo</span> ...&#125;) = 0</span><br><span class="line">ioctl(1, TIOCGWINSZ, &#123;ws_row=39, ws_col=105, ws_xpixel=0, ws_ypixel=0&#125;) = 0</span><br><span class="line"><span class="built_in">stat</span>(<span class="string">"/"</span>, &#123;st_mode=S_IFDIR|0555, st_size=4096, ...&#125;) = 0</span><br><span class="line">openat(AT_FDCWD, <span class="string">"/"</span>, O_RDONLY|O_NONBLOCK|O_DIRECTORY|O_CLOEXEC) = 3</span><br><span class="line">getdents(3, /* 29 entries */, 32768)    = 800</span><br><span class="line">getdents(3, /* 0 entries */, 32768)     = 0</span><br><span class="line">close(3)                                = 0</span><br><span class="line">fstat(1, &#123;st_mode=S_IFCHR|0620, st_rdev=makedev(136, 0), ...&#125;) = 0</span><br><span class="line">mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd6d51a0000</span><br><span class="line">write(1, <span class="string">"baiduds  CloudResetPwdAgentNew\t "</span>..., 76baiduds  CloudResetPwdAgentNew   data  homelost+found  opt   runsys  usr</span><br><span class="line">) = 76</span><br><span class="line">write(1, <span class="string">"bin\t CloudResetPwdUpdateAgent  d"</span>..., 70bin CloudResetPwdUpdateAgent  dev libmedia    proc  sbintmp  var</span><br><span class="line">) = 70</span><br><span class="line">write(1, <span class="string">"boot\t CloudrResetPwdAgent\t   etc"</span>..., 62boot CloudrResetPwdAgent   etc lib64mnt    root  srvtms</span><br><span class="line">) = 62</span><br><span class="line">close(1)                                = 0</span><br><span class="line">munmap(0x7fd6d51a0000, 4096)            = 0</span><br><span class="line">close(2)                                = 0</span><br><span class="line">exit_group(0)                           = ?</span><br><span class="line">+++ exited with 0 +++</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;无善无恶心之体，有善有恶意之动&lt;br&gt;知善知恶是良知，为善去恶是格物&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="报错" scheme="http://archks.gitee.io/web/categories/%E6%8A%A5%E9%94%99/"/>
    
    
      <category term="NFS" scheme="http://archks.gitee.io/web/tags/NFS/"/>
    
  </entry>
  
  <entry>
    <title>Vimium快捷键</title>
    <link href="http://archks.gitee.io/web/2020/06/16/Vimium_ShotCut/"/>
    <id>http://archks.gitee.io/web/2020/06/16/Vimium_ShotCut/</id>
    <published>2020-06-16T10:02:13.000Z</published>
    <updated>2020-07-04T17:18:04.516Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>世味年來薄似紗，誰令騎馬客京華。<br>小樓一夜聽春雨，深巷明朝賣杏花。<br>矮紙斜行閒作草，晴窗細乳戲分茶。<br>素衣莫起風塵嘆，猶及清明可到家。</p></blockquote><a id="more"></a><p>转自： <a href="https://sspai.com/post/27723" target="_blank" rel="noopener">https://sspai.com/post/27723</a></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/16/NkPFhQ.png" alt="NkPFhQ.png"></p><h1 id="1、常用快捷键"><a href="#1、常用快捷键" class="headerlink" title="1、常用快捷键"></a>1、常用快捷键</h1><ul><li>j：向下滚动一点</li><li>k：向上滚动一点</li><li>gg：到页面最底部</li><li>G：到页面最底部</li><li>d：向下翻一屏</li><li>u：向上翻一屏</li><li>gs: 查看网页源代码</li><li>yy：拷贝当前页面的URL到剪贴板</li><li>gu：跳转到父页面</li><li>K：跳转到右边标签页</li><li>J：跳转到左边标签页</li><li>x：关闭当前标签页</li><li>X：恢复刚刚关闭的标签页</li><li>H：在历史记录中后退</li><li>L：在历史记录中前进</li><li>？：查看帮助页面</li></ul><h1 id="2、打开新页面"><a href="#2、打开新页面" class="headerlink" title="2、打开新页面"></a>2、打开新页面</h1><ul><li><p>复制一段链接：经常在网页上看到一段链接文字，但却是不可点的。原来你需要先复制，然后新建标签页，再粘贴，敲回车后才能打开。现在呢？你只需要把要打开的链接复制一下，直接按「p」或「P」就可以打开了，小写的 p 是在当前标签页打开，大写的 P 则新建标签页打开。 </p></li><li><p>从收藏夹、历史记录打开：是不是之前看过什么网页，现在又想看了，还需要再打开历史记录找？或者想打开收藏夹里的某个链接？现在，直接按下「o」，输入对应的关键字后，会一起搜索你的历史记录和收藏夹，如果你输的是一个网址，回车还能直接打开。</p></li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/16/NkPbD0.png" alt="NkPbD0.png"></p><h1 id="3、只用敲三下，打开当前页面上任意一个链接"><a href="#3、只用敲三下，打开当前页面上任意一个链接" class="headerlink" title="3、只用敲三下，打开当前页面上任意一个链接"></a>3、只用敲三下，打开当前页面上任意一个链接</h1><p>如果说，任意一个页面上，哪所有再多链接，你也不用鼠标，最多只需要敲三个键，你就可以迅速打开任意一个链接，你信不信？Vimium 就可以办到。</p><p>你只需要按一下「f」，然后当前页面上所有可点击的元素，都会生成一个对应的快捷键分派给这些链接。比如我现在想点击导航栏上的「专题」，只需要再输入「GJ」，OK！完成了，你只敲了三个键，就打开了「专题」页面。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/16/NkiE5D.png" alt="NkiE5D.png"></p><h1 id="4、显示当前所有的标签页，并快速切换"><a href="#4、显示当前所有的标签页，并快速切换" class="headerlink" title="4、显示当前所有的标签页，并快速切换"></a>4、显示当前所有的标签页，并快速切换</h1><p>有时候在查找信息、翻阅资料时，经常会一口气打开几十个网站，东西一多，Chrome 会自动将每个标签页的宽度缩小，几乎就看不到它们的标题了。用了 Vimium，你可以按一下大写的「T」，就可以显示当前打开的所有标签页，并支持快捷搜索和跳转。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://s1.ax1x.com/2020/06/16/Nkie8H.png" alt="Nkie8H.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;世味年來薄似紗，誰令騎馬客京華。&lt;br&gt;小樓一夜聽春雨，深巷明朝賣杏花。&lt;br&gt;矮紙斜行閒作草，晴窗細乳戲分茶。&lt;br&gt;素衣莫起風塵嘆，猶及清明可到家。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="快捷键" scheme="http://archks.gitee.io/web/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    
  </entry>
  
  <entry>
    <title>Jetbrains快捷键</title>
    <link href="http://archks.gitee.io/web/2020/06/16/Jetbrains_ShutCut/"/>
    <id>http://archks.gitee.io/web/2020/06/16/Jetbrains_ShutCut/</id>
    <published>2020-06-16T03:23:57.000Z</published>
    <updated>2020-07-04T17:19:27.331Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>高城鼓动兰釭灺。睡也还醒，醉也还醒：忽听孤鸿三两声。<br>人生只似风前絮。欢也零星，悲也零星，都作连江点点萍。</p></blockquote><a id="more"></a><p>转自： <a href="https://segmentfault.com/a/1190000007206543" target="_blank" rel="noopener">https://segmentfault.com/a/1190000007206543</a></p><h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><hr><table><thead><tr><th>快捷键组合</th><th>说明</th></tr></thead><tbody><tr><td>Ctrl + Space</td><td>代码自动完成提示（选择）</td></tr><tr><td>Alt + Enter</td><td>显示意图动作和快速修复</td></tr><tr><td>Ctrl + P</td><td>参数信息（在调用方法参数忘记的时候，提示）</td></tr><tr><td>Ctrl + Q</td><td>快速查找文件，可以查找当前类定义的文件等</td></tr><tr><td>Ctrl + 鼠标滑过</td><td>基本信息</td></tr><tr><td>Alt + Insert</td><td>生成代码…(细节需要多次操作会发现很有意思)</td></tr><tr><td>Ctrl + O</td><td>重写方法（在PHPStorm中是重写父类方法，会有选择框）</td></tr><tr><td>Ctrl + I</td><td>实现方法（一般是指实现接口类或抽象类方法）</td></tr><tr><td>Ctrl + Alt + T</td><td>环绕代码块 (if..else, try..catch, for, 等)</td></tr><tr><td>Ctrl + /</td><td>单行注释(//)</td></tr><tr><td>Ctrl + Shift + /</td><td>块注释 (/**/)</td></tr><tr><td>Ctrl + W</td><td>选择依次递增的代码块，具体使用目前来看比较少</td></tr><tr><td>Ctrl + Shift + W</td><td>去掉当前选择返回上一个选择，类似于撤销选择，与上面的相反</td></tr><tr><td>Ctrl + Alt + L</td><td>格式化代码，一般来说，写的代码格式不整齐统一，这个很有用</td></tr><tr><td>Ctrl + Alt + I</td><td>自啮合线，这个解释不太好解释，测试结果就是会自动根据代码来进行对齐</td></tr><tr><td>Ctrl + D</td><td>复制当前行或选定的块</td></tr><tr><td>Ctrl + Y</td><td>删除插入符号所在行</td></tr><tr><td>Ctrl + Shift + J</td><td>智能线连接（HTML和JavaScript才有用）</td></tr><tr><td>Ctrl + Enter</td><td>智能分割线 (HTML 和 JavaScript 才有用)</td></tr><tr><td>Shift + Enter</td><td>开始新行，比如光标在当前行，不需要切换到行尾按Enter，直接按这个组合键即可</td></tr><tr><td>Ctrl + Shift + U</td><td>切换选中的英文文字的大小写，此处其实用到挺多的</td></tr><tr><td>Ctrl + Shift + ] 或 [</td><td>选择直到代码块的开始或结束，我之前不知道这个，其实很有用</td></tr><tr><td>Ctrl + Delete</td><td>删除从当前光标到当前单词结尾</td></tr><tr><td>Ctrl + Backspace</td><td>从光标位置删除到当前单词的开始</td></tr><tr><td>Ctrl + + 或 -</td><td>这里是ctrl和加号或者减号产生的组合，可以折叠或展开当前代码块</td></tr><tr><td>Ctrl + F4</td><td>关闭活动中的tab</td></tr><tr><td>Ctrl + Shift + V</td><td>从历史粘贴</td></tr></tbody></table><h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><hr><p><em>此处我是用得很少</em></p><table><thead><tr><th>快捷键组合</th><th>说明</th></tr></thead><tbody><tr><td>F8</td><td>跳过</td></tr><tr><td>F7</td><td>步进</td></tr><tr><td>Shift + F8</td><td>跳出</td></tr><tr><td>Alt + F8</td><td>表达式求值</td></tr><tr><td>F9</td><td>恢复程序</td></tr><tr><td>Ctrl + F8</td><td>切断断点</td></tr><tr><td>Ctrl+Shift+F8</td><td>查看断点</td></tr></tbody></table><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><hr><table><thead><tr><th>快捷键组合</th><th>说明</th></tr></thead><tbody><tr><td>Shift + F10</td><td>运行</td></tr><tr><td>Shift + F9</td><td>调试</td></tr><tr><td>Ctrl + Shift + F10</td><td>从编辑器运行上下文配置（Run context configuration from editor），此处可能翻译不够准确</td></tr><tr><td>Ctrl + Shift + X</td><td>在命令行运行</td></tr></tbody></table><h2 id="搜索-替换"><a href="#搜索-替换" class="headerlink" title="搜索/替换"></a>搜索/替换</h2><table><thead><tr><th>快捷键组合</th><th>说明</th></tr></thead><tbody><tr><td>Ctrl + F/R</td><td>查找/替换</td></tr><tr><td>F3/Shift + F3</td><td>查找下一个/上一个</td></tr><tr><td>Ctrl + Shift + F/R</td><td>在目录中查找/替换</td></tr></tbody></table><h2 id="查找哪些地方使用"><a href="#查找哪些地方使用" class="headerlink" title="查找哪些地方使用"></a>查找哪些地方使用</h2><table><thead><tr><th>快捷键组合</th><th>说明</th></tr></thead><tbody><tr><td>Alt + F7 / Ctrl + F7</td><td>当前文件查找被使用/在文件中查找哪些地方使用</td></tr><tr><td>Ctrl + Shift + F7</td><td>文件中搜索并在使用的地方高亮显示</td></tr><tr><td>Ctrl + Alt + F7</td><td>显示哪些地方被使用</td></tr></tbody></table><h2 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h2><hr><table><thead><tr><th>快捷键组合</th><th>说明</th></tr></thead><tbody><tr><td>Ctrl + N</td><td>跳转到指定类</td></tr><tr><td>Ctrl + Shift + N</td><td>跳转到文件</td></tr><tr><td>Ctrl + Alt + Shift + N</td><td>跳转到符号</td></tr><tr><td>Ctrl + G</td><td>跳转到第几行</td></tr><tr><td>Alt + Right/Left</td><td>切换编辑器活动窗</td></tr><tr><td>Esc</td><td>Go to editor (from tool window)</td></tr><tr><td>Ctrl + E</td><td>弹出最近编辑文件，我也是在写这文档才知道，太方便了</td></tr><tr><td>Ctrl + Alt + Left/Right</td><td>导航前进/后退</td></tr><tr><td>Ctrl + Shift + Backspace</td><td>跳转到最近编辑的代码位置</td></tr><tr><td>Alt + F1</td><td>在任何视图中选择当前文件或符号</td></tr><tr><td>Ctrl + B 或 Ctrl + Click</td><td>跳到申明（如跳转到当前函数声明的地方，这个很常用，可以实操一下）</td></tr><tr><td>Ctrl + Alt + B</td><td>与上面相反，跳到执行位置</td></tr><tr><td>Ctrl + Shift + I</td><td>打开快速定义查找</td></tr><tr><td>Ctrl + Shift + B</td><td>跳转到类型声明</td></tr><tr><td>Ctrl + U</td><td>跳到超级方法(super-method)/超类 (super-class)</td></tr><tr><td>Alt + Up/Down</td><td>跳转到上一个或者下一个方法，在编辑一个类的时候，方便一个一个的方法进行查看</td></tr><tr><td>Ctrl + ] / [</td><td>跳转到代码块的开始或结束</td></tr><tr><td>F2 / Shift + F2</td><td>跳转到上一个或下一个高亮错误地方，这个检查代码语法错误很有用</td></tr><tr><td>F4 / Ctrl + Enter</td><td>编辑源代码/查看源代码</td></tr></tbody></table><h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><hr><table><thead><tr><th>快捷键组合</th><th>说明</th></tr></thead><tbody><tr><td>快速按两次 Shift</td><td>搜索任何一个地方</td></tr><tr><td>Ctrl + Shift + A</td><td>查找方法(Action)</td></tr><tr><td>Alt + #[0-9]</td><td>打开相应的工具窗口（这个我也没搞明白）</td></tr><tr><td>Ctrl + Alt + F11</td><td>开启或关闭全屏模式</td></tr><tr><td>Ctrl + Shift + F12</td><td>开启或关闭最大化编辑</td></tr><tr><td>Alt + Shift + F</td><td>添加到收藏列表（我觉得这个功能很神奇，不知道为啥要这么做）</td></tr><tr><td>Alt + Shift + I</td><td>检查当前文件以及当前配置文件</td></tr><tr><td>Ctrl + Alt + S</td><td>打开设置对话框（表示会与QQ默认快捷键冲突）</td></tr><tr><td>Ctrl + Tab</td><td>在 tabs 和工具窗口间切换</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;高城鼓动兰釭灺。睡也还醒，醉也还醒：忽听孤鸿三两声。&lt;br&gt;人生只似风前絮。欢也零星，悲也零星，都作连江点点萍。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="快捷键" scheme="http://archks.gitee.io/web/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    
  </entry>
  
  <entry>
    <title>Chrome快捷键</title>
    <link href="http://archks.gitee.io/web/2020/06/16/Chrome_ShutCut/"/>
    <id>http://archks.gitee.io/web/2020/06/16/Chrome_ShutCut/</id>
    <published>2020-06-16T03:23:27.000Z</published>
    <updated>2020-07-04T17:19:41.482Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>春未老，风细柳斜斜。试上超然台上望，半壕春水一城花。烟雨暗千家。<br>寒食后，酒醒却咨嗟。休对故人思故国，且将新火试新茶。诗酒趁年华。</p></blockquote><a id="more"></a><p>转自：<a href="https://www.runoob.com/w3cnote/google-chrome-shortcuts.html" target="_blank" rel="noopener">https://www.runoob.com/w3cnote/google-chrome-shortcuts.html</a></p><h2 id="Windows-和-Linux版本的chrome"><a href="#Windows-和-Linux版本的chrome" class="headerlink" title="Windows 和 Linux版本的chrome"></a>Windows 和 Linux版本的chrome</h2><h3 id="标签页和窗口快捷键"><a href="#标签页和窗口快捷键" class="headerlink" title="标签页和窗口快捷键"></a>标签页和窗口快捷键</h3><table><thead><tr><th align="left">操作</th><th align="left">快捷键</th></tr></thead><tbody><tr><td align="left">打开新窗口</td><td align="left">Ctrl + n</td></tr><tr><td align="left">在隐身模式下打开新窗口</td><td align="left">Ctrl + Shift + n</td></tr><tr><td align="left">打开新的标签页，并跳转到该标签页</td><td align="left">Ctrl + t</td></tr><tr><td align="left">重新打开最后关闭的标签页，并跳转到该标签页</td><td align="left">Ctrl + Shift + t</td></tr><tr><td align="left">跳转到下一个打开的标签页</td><td align="left">Ctrl + Tab 或 Ctrl + PgDn</td></tr><tr><td align="left">跳转到上一个打开的标签页</td><td align="left">Ctrl + Shift + Tab 或 Ctrl + PgUp</td></tr><tr><td align="left">跳转到特定标签页</td><td align="left">Ctrl + 1 到 Ctrl + 8</td></tr><tr><td align="left">跳转到最后一个标签页</td><td align="left">Ctrl + 9</td></tr><tr><td align="left">在当前标签页中打开主页</td><td align="left">Alt + Home</td></tr><tr><td align="left">关闭当前标签页</td><td align="left">Ctrl + w 或 Ctrl + F4</td></tr><tr><td align="left">关闭所有打开的标签页和浏览器</td><td align="left">Ctrl + Shift + w</td></tr><tr><td align="left">最小化当前窗口</td><td align="left">Alt + 空格键 + n</td></tr><tr><td align="left">最大化当前窗口</td><td align="left">Alt + 空格键 + x</td></tr><tr><td align="left">退出 Google Chrome</td><td align="left">Ctrl + Shift + q 或 Alt + F4</td></tr></tbody></table><h3 id="chrome-功能快捷键"><a href="#chrome-功能快捷键" class="headerlink" title="chrome 功能快捷键"></a>chrome 功能快捷键</h3><table><thead><tr><th align="left">操作</th><th align="left">快捷键</th></tr></thead><tbody><tr><td align="left">打开”菜单”</td><td align="left">Alt + f、Alt + e 或 F10</td></tr><tr><td align="left">显示或隐藏书签栏</td><td align="left">Ctrl + Shift + b</td></tr><tr><td align="left">打开书签管理器</td><td align="left">Ctrl + Shift + o</td></tr><tr><td align="left">在新标签页中打开”历史记录”页</td><td align="left">Ctrl + h</td></tr><tr><td align="left">在新标签页中打开”下载内容”页</td><td align="left">Ctrl + j</td></tr><tr><td align="left">打开 Chrome 任务管理器</td><td align="left">Shift + Esc</td></tr><tr><td align="left">将焦点放置在 Chrome 工具栏中的第一项上</td><td align="left">Shift + Alt + t</td></tr><tr><td align="left">在地址栏、书签栏（若显示）和页面内容之间向前切换焦点</td><td align="left">F6</td></tr><tr><td align="left">在地址栏、书签栏（若显示）和页面内容之间向后切换焦点</td><td align="left">Shift + F6</td></tr><tr><td align="left">打开查找栏搜索当前网页</td><td align="left">Ctrl + f 或 F3</td></tr><tr><td align="left">跳转到与查找栏中搜索字词相匹配的下一条内容</td><td align="left">Ctrl + g</td></tr><tr><td align="left">跳转到与查找栏中搜索字词相匹配的上一条内容</td><td align="left">Ctrl + Shift + g</td></tr><tr><td align="left">打开”开发者工具”</td><td align="left">Ctrl + Shift + j 或 F12</td></tr><tr><td align="left">打开”清除浏览数据”选项</td><td align="left">Ctrl + Shift + Delete</td></tr><tr><td align="left">在新标签页中打开 Chrome 帮助中心</td><td align="left">F1</td></tr><tr><td align="left">使用其他帐户登录或进入隐身模式</td><td align="left">Ctrl + Shift + m</td></tr><tr><td align="left">打开反馈表单</td><td align="left">Ctrl + Shift + i</td></tr></tbody></table><h3 id="地址栏快捷键"><a href="#地址栏快捷键" class="headerlink" title="地址栏快捷键"></a>地址栏快捷键</h3><table><thead><tr><th align="left">操作</th><th align="left">快捷键</th></tr></thead><tbody><tr><td align="left">使用默认搜索引擎进行搜索</td><td align="left">输入搜索字词并按 Enter 键</td></tr><tr><td align="left">使用其他搜索引擎进行搜索</td><td align="left">输入搜索引擎名称并按 Tab 键</td></tr><tr><td align="left">为网站名称添加 www. 和 .com，并在当前标签页中打开该网站</td><td align="left">输入网站名称并按 Ctrl + Enter 键</td></tr><tr><td align="left">为网站名称添加 www. 和 .com，并在新标签页中打开该网站</td><td align="left">输入网站名称并按 Alt + Enter 键</td></tr><tr><td align="left">跳转到地址栏</td><td align="left">Ctrl + l、Alt + d 或 F6</td></tr><tr><td align="left">从页面中的任意位置搜索</td><td align="left">Ctrl + k 或 Ctrl + e</td></tr></tbody></table><h3 id="网页快捷键"><a href="#网页快捷键" class="headerlink" title="网页快捷键"></a>网页快捷键</h3><table><thead><tr><th align="left">操作</th><th align="left">快捷键</th></tr></thead><tbody><tr><td align="left">打开选项以打印当前网页</td><td align="left">Ctrl + p</td></tr><tr><td align="left">打开选项以保存当前网页</td><td align="left">Ctrl + s</td></tr><tr><td align="left">重新加载当前网页</td><td align="left">F5 或 Ctrl + r</td></tr><tr><td align="left">重新加载当前网页（忽略缓存的内容）</td><td align="left">Shift + F5 或 Ctrl + Shift + r</td></tr><tr><td align="left">停止加载网页</td><td align="left">Esc</td></tr><tr><td align="left">浏览下一个可点击项</td><td align="left">Tab</td></tr><tr><td align="left">浏览上一个可点击项</td><td align="left">Shift + Tab</td></tr><tr><td align="left">使用 Chrome 打开计算机中的文件</td><td align="left">按住 Ctrl + o 键并选择文件</td></tr><tr><td align="left">显示当前网页的 HTML 源代码（不可修改）</td><td align="left">Ctrl + u</td></tr><tr><td align="left">将当前网页保存为书签</td><td align="left">Ctrl + d</td></tr><tr><td align="left">将所有打开的标签页以书签的形式保存在新文件夹中</td><td align="left">Ctrl + Shift + d</td></tr><tr><td align="left">开启或关闭全屏模式</td><td align="left">F11</td></tr><tr><td align="left">放大网页上的所有内容</td><td align="left">Ctrl 和 +</td></tr><tr><td align="left">缩小网页上的所有内容</td><td align="left">Ctrl 和 -</td></tr><tr><td align="left">将网页上的所有内容恢复到默认大小</td><td align="left">Ctrl + 0</td></tr><tr><td align="left">向下滚动网页，一次一个屏幕</td><td align="left">空格键或 PgDn</td></tr><tr><td align="left">向上滚动网页，一次一个屏幕</td><td align="left">Shift + 空格键或 PgUp</td></tr><tr><td align="left">转到网页顶部</td><td align="left">首页</td></tr><tr><td align="left">转到网页底部</td><td align="left">末尾</td></tr><tr><td align="left">在网页上水平滚动</td><td align="left">按住 Shift 键并滚动鼠标滚轮</td></tr><tr><td align="left">将光标移到文本字段中的上一个字词前面</td><td align="left">Ctrl + 向左箭头键</td></tr><tr><td align="left">将光标移到文本字段中的上一个字词后面</td><td align="left">Ctrl + 向右箭头键</td></tr><tr><td align="left">删除文本字段中的上一个字词</td><td align="left">Ctrl + Backspace</td></tr><tr><td align="left">将焦点移到通知上</td><td align="left">Alt + n</td></tr><tr><td align="left">在通知中允许</td><td align="left">Alt + Shift + a</td></tr><tr><td align="left">在通知中拒绝</td><td align="left">Alt + Shift + d</td></tr><tr><td align="left">在当前标签页中打开主页</td><td align="left">Alt + Home</td></tr></tbody></table><h3 id="网页快捷键-1"><a href="#网页快捷键-1" class="headerlink" title="网页快捷键"></a>网页快捷键</h3><table><thead><tr><th align="left">操作</th><th align="left">快捷键</th></tr></thead><tbody><tr><td align="left">在当前标签页中打开链接（仅限鼠标）</td><td align="left">将链接拖到标签页中</td></tr><tr><td align="left">在新的后台标签页中打开链接</td><td align="left">按住 Ctrl 键的同时点击链接</td></tr><tr><td align="left">打开链接，并跳转到该链接</td><td align="left">按住 Ctrl + Shift 键的同时点击链接</td></tr><tr><td align="left">打开链接，并跳转到该链接（仅使用鼠标）</td><td align="left">将链接拖到标签栏的空白区域</td></tr><tr><td align="left">在新窗口中打开链接</td><td align="left">按住 Shift 键的同时点击链接</td></tr><tr><td align="left">在新窗口中打开标签页（仅使用鼠标）</td><td align="left">将标签页拖出标签栏</td></tr><tr><td align="left">将标签页移至当前窗口（仅限鼠标）</td><td align="left">将标签页拖到现有窗口中</td></tr><tr><td align="left">将标签页移回其原始位置</td><td align="left">拖动标签页的同时按 Esc</td></tr><tr><td align="left">将当前网页保存为书签</td><td align="left">将相应网址拖动到书签栏中</td></tr><tr><td align="left">下载链接目标</td><td align="left">按住 Alt 键的同时点击链接</td></tr><tr><td align="left">显示浏览记录</td><td align="left">右键点击”后退”箭头 返回 或”前进”箭头 下一个，或者点击并按住”后退”箭头 返回 或”前进”箭头 下一个</td></tr><tr><td align="left">最大化或最小化窗口</td><td align="left">双击标签栏的空白区域</td></tr><tr><td align="left">放大网页上的所有内容</td><td align="left">按住 Ctrl 键的同时向上滚动鼠标滚轮</td></tr><tr><td align="left">缩小网页上的所有内容</td><td align="left">按住 Ctrl 键的同时向下滚动鼠标滚轮</td></tr></tbody></table><h2 id="Mac-系统"><a href="#Mac-系统" class="headerlink" title="Mac 系统"></a>Mac 系统</h2><h3 id="标签页和窗口快捷键-1"><a href="#标签页和窗口快捷键-1" class="headerlink" title="标签页和窗口快捷键"></a>标签页和窗口快捷键</h3><table><thead><tr><th><strong>操作</strong></th><th><strong>快捷键</strong></th></tr></thead><tbody><tr><td>打开新窗口</td><td><strong>⌘ + n</strong></td></tr><tr><td>在无痕模式下打开新窗口</td><td><strong>⌘ + Shift + n</strong></td></tr><tr><td>打开新的标签页，并跳转到该标签页</td><td><strong>⌘ + t</strong></td></tr><tr><td>重新打开最后关闭的标签页，并跳转到该标签页</td><td><strong>⌘ + Shift + t</strong></td></tr><tr><td>跳转到下一个打开的标签页</td><td><strong>⌘ + Option + 向右箭头键</strong></td></tr><tr><td>跳转到上一个打开的标签页</td><td><strong>⌘ + Option + 向左箭头键</strong></td></tr><tr><td>跳转到特定标签页</td><td><strong>⌘ + 1</strong> 到 <strong>⌘ + 8</strong></td></tr><tr><td>跳转到最后一个标签页</td><td><strong>⌘ + 9</strong></td></tr><tr><td>打开当前标签页浏览记录中记录的上一个页面</td><td><strong>⌘ + [</strong> 或 <strong>⌘ + 向左箭头键</strong></td></tr><tr><td>打开当前标签页浏览记录中记录的下一个页面</td><td><strong>⌘ + ]</strong> 或 <strong>⌘ + 向右箭头键</strong></td></tr><tr><td>关闭当前标签页或弹出式窗口</td><td><strong>⌘ + w</strong></td></tr><tr><td>关闭当前窗口</td><td><strong>⌘ + Shift + w</strong></td></tr><tr><td>最小化窗口</td><td><strong>⌘ + m</strong></td></tr><tr><td>隐藏 Google Chrome</td><td><strong>⌘ + h</strong></td></tr><tr><td>退出 Google Chrome</td><td><strong>⌘ + q</strong></td></tr></tbody></table><h3 id="Google-Chrome-功能快捷键"><a href="#Google-Chrome-功能快捷键" class="headerlink" title="Google Chrome 功能快捷键"></a>Google Chrome 功能快捷键</h3><table><thead><tr><th><strong>操作</strong></th><th><strong>快捷键</strong></th></tr></thead><tbody><tr><td>显示或隐藏书签栏</td><td><strong>⌘ + Shift + b</strong></td></tr><tr><td>打开书签管理器</td><td><strong>⌘ + Option + b</strong></td></tr><tr><td>在新标签页中打开”设置”页</td><td><strong>⌘ + ,</strong></td></tr><tr><td>在新标签页中打开”历史记录”页</td><td><strong>⌘ + y</strong></td></tr><tr><td>在新标签页中打开”下载内容”页</td><td><strong>⌘ + Shift + j</strong></td></tr><tr><td>打开查找栏搜索当前网页</td><td><strong>⌘ + f</strong></td></tr><tr><td>跳转到与查找栏中搜索字词相匹配的下一条内容</td><td><strong>⌘ + g</strong></td></tr><tr><td>跳转到与查找栏中搜索字词相匹配的上一条内容</td><td><strong>⌘ + Shift + g</strong></td></tr><tr><td>打开查找栏后，搜索选定文本</td><td><strong>⌘ + e</strong></td></tr><tr><td>打开”开发者工具”</td><td><strong>⌘ + Option + i</strong></td></tr><tr><td>打开”清除浏览数据”选项</td><td><strong>⌘ + Shift + Delete</strong></td></tr><tr><td>使用其他帐号登录或以访客身份浏览</td><td><strong>⌘ + Shift + m</strong></td></tr></tbody></table><h3 id="地址栏快捷键-1"><a href="#地址栏快捷键-1" class="headerlink" title="地址栏快捷键"></a>地址栏快捷键</h3><table><thead><tr><th><strong>操作</strong></th><th><strong>快捷键</strong></th></tr></thead><tbody><tr><td>使用默认搜索引擎进行搜索</td><td>输入搜索字词并按 <strong>Enter</strong> 键</td></tr><tr><td>使用其他搜索引擎进行搜索</td><td>输入搜索引擎名称并按 <strong>Tab</strong> 键</td></tr><tr><td>为网站名称添加 <code>www.</code> 和 <code>.com</code>，并在当前标签页中打开该网站</td><td>输入网站名称并按 <strong>Control + Enter</strong> 键</td></tr><tr><td>为网站名称添加 <code>www.</code> 和 <code>.com</code>，并在新标签页中打开该网站</td><td>输入网站名称并按 <strong>Control + Shift + Enter</strong> 键</td></tr><tr><td>在新的后台标签页中打开网站</td><td>输入网址并按 <strong>⌘ + Enter</strong> 键</td></tr><tr><td>跳转到地址栏</td><td><strong>⌘ + l</strong></td></tr><tr><td>从地址栏中移除联想查询内容</td><td>按<strong>向下箭头键</strong>以突出显示相应内容，然后按 <strong>Shift + fn + Delete</strong></td></tr></tbody></table><h3 id="网页快捷键-2"><a href="#网页快捷键-2" class="headerlink" title="网页快捷键"></a>网页快捷键</h3><table><thead><tr><th><strong>操作</strong></th><th><strong>快捷键</strong></th></tr></thead><tbody><tr><td>打开选项以打印当前网页</td><td><strong>⌘ + p</strong></td></tr><tr><td>打开选项以保存当前网页</td><td><strong>⌘ + s</strong></td></tr><tr><td>打开”页面设置”对话框</td><td><strong>⌘ + Option + p</strong></td></tr><tr><td>通过电子邮件发送当前网页</td><td><strong>⌘ + Shift + i</strong></td></tr><tr><td>重新加载当前网页</td><td><strong>⌘ + r</strong></td></tr><tr><td>重新加载当前网页（忽略缓存的内容）</td><td><strong>⌘ + Shift + r</strong></td></tr><tr><td>停止加载网页</td><td><strong>Esc</strong></td></tr><tr><td>浏览下一个可点击项</td><td><strong>Tab</strong></td></tr><tr><td>浏览上一个可点击项</td><td><strong>Shift + Tab</strong></td></tr><tr><td>使用 Google Chrome 打开计算机中的文件</td><td>按住 <strong>⌘ + o</strong> 键并选择文件</td></tr><tr><td>显示当前网页的 HTML 源代码（不可修改）</td><td><strong>⌘ + Option + u</strong></td></tr><tr><td>打开 JavaScript 控制台</td><td><strong>⌘ + Option + j</strong></td></tr><tr><td>将当前网页保存为书签</td><td><strong>⌘ + d</strong></td></tr><tr><td>将所有打开的标签页以书签的形式保存在新文件夹中</td><td><strong>⌘ + Shift + d</strong></td></tr><tr><td>开启或关闭全屏模式</td><td><strong>⌘ + Ctrl + f</strong></td></tr><tr><td>放大网页上的所有内容</td><td><strong>⌘ 和 +</strong></td></tr><tr><td>缩小网页上的所有内容</td><td><strong>⌘ 和 -</strong></td></tr><tr><td>将网页上的所有内容恢复到默认大小</td><td><strong>⌘ + 0</strong></td></tr><tr><td>向下滚动网页，一次一个屏幕</td><td><strong>空格键</strong></td></tr><tr><td>向上滚动网页，一次一个屏幕</td><td><strong>Shift + 空格键</strong></td></tr><tr><td>搜索网络</td><td><strong>⌘ + Option + f</strong></td></tr><tr><td>将光标移到文本字段中的上一个字词前面</td><td><strong>Option + 向左箭头键</strong></td></tr><tr><td>将光标移到文本字段中的上一个字词后面</td><td><strong>Option + 向右箭头键</strong></td></tr><tr><td>删除文本字段中的上一个字词</td><td><strong>Option + Delete</strong></td></tr><tr><td>在当前标签页中打开主页</td><td><strong>⌘ + Shift + h</strong></td></tr></tbody></table><h3 id="鼠标快捷键"><a href="#鼠标快捷键" class="headerlink" title="鼠标快捷键"></a>鼠标快捷键</h3><table><thead><tr><th><strong>操作</strong></th><th><strong>快捷键</strong></th></tr></thead><tbody><tr><td>在当前标签页中打开链接（仅限鼠标）</td><td>将链接拖到标签页中</td></tr><tr><td>在新的后台标签页中打开链接</td><td>按住 <strong>⌘</strong> 键的同时点击链接</td></tr><tr><td>打开链接，并跳转到该链接</td><td>按住 <strong>⌘ + Shift</strong> 键的同时点击链接</td></tr><tr><td>打开链接，并跳转到该链接（仅使用鼠标）</td><td>将链接拖到标签栏的空白区域</td></tr><tr><td>在新窗口中打开链接</td><td>按住 <strong>Shift</strong> 键的同时点击链接</td></tr><tr><td>在新窗口中打开标签页（仅使用鼠标）</td><td>将标签页拖出标签栏</td></tr><tr><td>将标签页移至当前窗口（仅限鼠标）</td><td>将标签页拖到现有窗口中</td></tr><tr><td>将标签页移回其原始位置</td><td>拖动标签页的同时按 <strong>Esc</strong></td></tr><tr><td>将当前网页保存为书签</td><td>将相应网址拖动到书签栏中</td></tr><tr><td>下载链接目标</td><td>按住 <strong>Option</strong> 键的同时点击链接</td></tr><tr><td>显示浏览记录</td><td>右键点击”后退”箭头 <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://static.runoob.com/images/mix/left.png" alt="返回"> 或”前进”箭头 <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://static.runoob.com/images/mix/right.png" alt="下一个"> ，或者左键点击（并按住鼠标左键不放）”后退”箭头 <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://static.runoob.com/images/mix/left.png" alt="返回"> 或”前进”箭头 <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://static.runoob.com/images/mix/right.png" alt="下一个"></td></tr><tr><td>将窗口高度最大化</td><td>双击标签栏的空白区域</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;春未老，风细柳斜斜。试上超然台上望，半壕春水一城花。烟雨暗千家。&lt;br&gt;寒食后，酒醒却咨嗟。休对故人思故国，且将新火试新茶。诗酒趁年华。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="快捷键" scheme="http://archks.gitee.io/web/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    
  </entry>
  
  <entry>
    <title>VSCode快捷键</title>
    <link href="http://archks.gitee.io/web/2020/06/16/VsCode_ShotCut/"/>
    <id>http://archks.gitee.io/web/2020/06/16/VsCode_ShotCut/</id>
    <published>2020-06-16T02:51:59.000Z</published>
    <updated>2020-07-04T17:17:58.456Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>醉漾轻舟，信bai流引到花深处。<br>尘缘du相误，无计花间住。<br>烟水茫茫，千里斜阳暮。<br>山无数，乱红如雨，不记来时路。</p></blockquote><a id="more"></a><p>常用的几个</p><table><thead><tr><th>shortcut</th><th>info</th></tr></thead><tbody><tr><td>Ctrl+Shift+K</td><td>删除当前行</td></tr><tr><td>Ctrl+L</td><td>选中当前行</td></tr><tr><td>Ctrl+letf, Ctrl+Right</td><td>逐个单词跳转</td></tr><tr><td>Ctrl+B</td><td>打开左侧页面</td></tr><tr><td>Ctrl+J</td><td>打开终端</td></tr><tr><td>Ctrl+F</td><td>搜索</td></tr><tr><td>Ctrl+D</td><td>查找当下字符，可以跳转</td></tr><tr><td>Fn+Up , Fn+Down</td><td>翻半页</td></tr><tr><td>Ctrl+Backspace</td><td>删除一个单词</td></tr><tr><td>Shift + Alt +Down</td><td>复制一行</td></tr><tr><td>Ctrl+],Ctrl+[</td><td>缩进tab和退缩进</td></tr><tr><td>Ctrl+Shift+W</td><td>关闭编辑器</td></tr><tr><td>Ctrl+W</td><td>关闭当前编辑文本</td></tr><tr><td>Ctrl + Enter</td><td>在当前行下插入新的一行</td></tr><tr><td>Ctrl+Shift+|</td><td>匹配括号跳转</td></tr><tr><td>Ctrl + up/down</td><td>行视图上下偏移</td></tr><tr><td>Ctrl + P</td><td>跳转文件</td></tr><tr><td>Alt + Click</td><td>插入光标-支持多个</td></tr><tr><td>Ctrl + =/-</td><td>放大 / 缩小</td></tr><tr><td>Ctrl + Shift + V</td><td>复制到当前激活的终端</td></tr><tr><td>Ctrl + `</td><td>打开集成终端</td></tr><tr><td>Ctrl + Shift + `</td><td>创建一个新的终端</td></tr></tbody></table><p>为tab设置颜色</p><ul><li>安装Material Theme插件</li><li>Ctrl+Shift+P，选择Material Theme：set accent color</li><li>选择喜欢颜色</li></ul><p>查看运行插件</p><p>Ctrl+Shift+P ； 输入<code>show running extensions</code>查看所有运行插件</p><p>更多快捷键：<a href="https://blog.csdn.net/crper/article/details/54099319" target="_blank" rel="noopener">https://blog.csdn.net/crper/article/details/54099319</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;醉漾轻舟，信bai流引到花深处。&lt;br&gt;尘缘du相误，无计花间住。&lt;br&gt;烟水茫茫，千里斜阳暮。&lt;br&gt;山无数，乱红如雨，不记来时路。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="快捷键" scheme="http://archks.gitee.io/web/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    
  </entry>
  
  <entry>
    <title>KVM实例总结</title>
    <link href="http://archks.gitee.io/web/2020/06/04/KVM_Initial/"/>
    <id>http://archks.gitee.io/web/2020/06/04/KVM_Initial/</id>
    <published>2020-06-04T09:19:51.000Z</published>
    <updated>2020-07-04T17:19:21.421Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>大雨落幽燕，白浪滔天，秦皇岛外打鱼船，一片汪洋都不见。知向谁边？<br>往事越千年，魏武挥鞭，东临碣石有遗篇。萧瑟秋风今又是，换了人间。</p></blockquote><a id="more"></a><h1 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h1><p>kvm创建虚拟机的根本在于这样一条命令，<code>virsh define vm-template.xml</code>，这条命令的核心就是创建一个虚拟机，之后或者之前的内容都是围绕着这条命令和这个虚拟机的。</p><ul><li>更新vm-templatem模板是为了进行子机资源配置</li><li>在更新模板之前检查时主机是为了防止给子机过量的资源导致母机不稳定</li><li>桥接网卡是为了让子机连接局域网</li></ul><p>所以，virsh define vm-template.xml 其本质是在安全可靠的前提下，将母机的资源通过kvm虚拟化的形式分配给子机。</p><p>所以主要考虑方向有两个</p><p>1、保障母机和子机的安全可靠，包括系统安全和网络安全</p><p>2、进行资源分配，包括网络资源、存储资源、计算资源等</p><p>该脚本考虑了母机分配资源不会超过母机承受范围的资源安全，其他系统层面和网络层面的安全问题还需考虑</p><h1 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">- 1、sed   </span><br><span class="line">- 替换注释 sed -i <span class="string">"s/^IPADDR/#&amp;/"</span> file</span><br><span class="line">- 字段追加 sed -i <span class="string">"/DEVICE/a\BRIDGE='br0'"</span> file</span><br><span class="line">- 指定行插入 sed -i <span class="string">"4iContent"</span> file</span><br><span class="line">- 注意<span class="string">""</span> 和<span class="string">''</span>的区别，在使用变量时可以加\转义字符</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 2、cat </span><br><span class="line">- cat &lt;&lt; EOF &gt; file ，这里的变量需要转义字符\,且EOF不能使用双引号<span class="string">"EOF"</span>,否则变量会消失</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 3、expect</span><br><span class="line">- expect执行顺序容易错乱</span><br><span class="line">- expect <span class="string">"~"</span> &#123; send <span class="string">"umount /share \r"</span> &#125; ：常用expect方法</span><br><span class="line">- 如果执行expect需要等待很长时间，可以把timeout设置为-1</span><br><span class="line">- expect脚本执行时，不能使用sh script.sh 这样相当于用shell的解释器执行，可以采用./script <span class="variable">$args</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 4、<span class="keyword">while</span></span><br><span class="line">- <span class="keyword">while</span> <span class="built_in">read</span> a b c d e;<span class="keyword">do</span> ....; <span class="keyword">done</span> &lt; file，用于读取类似格式为 192.168.1.1 255.255.255.0 C 之类的文本，读取之后 a b c d e 均为file中对应的变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 5、<span class="built_in">echo</span></span><br><span class="line">- 注意<span class="built_in">echo</span>颜色的使用，红色闪烁和绿色健康：-e <span class="string">"\033[31m\033[01m\033[05m[ err ]\033[0m"</span>  <span class="string">"\033[32m [ OK ] \033[0m"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 6、bc</span><br><span class="line">- shell中浮点数和整数、浮点数和浮点数不能直接比较大小，可以使用bc工具</span><br><span class="line">- <span class="built_in">echo</span> <span class="string">"1.1 &gt; 1"</span> | bc  正确为1 错误为0</span><br></pre></td></tr></table></figure><h1 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">完成过程</span><br><span class="line">   - 1|主机检查-（磁盘、CPU、内存） 写了自动检查&amp;手动检查[0]</span><br><span class="line">   - 2|网卡桥接，创建一个br0作为网桥，连接eth1和kvm虚拟机</span><br><span class="line">   - 3|安装软件，执行tlinux*.run</span><br><span class="line">   - 4|重启母机</span><br><span class="line">   - 5|主机通信[1]</span><br><span class="line">   - 6|创建子机磁盘，包括系统盘、数据盘、共享盘</span><br><span class="line">   - 6|配置模板，包括调整CPU个数、内存大小、vlanid、网卡、uuid、mac地址、子机名称</span><br><span class="line">   - 7|使用6中的模板创建子机[2]</span><br><span class="line">   - 8|登录子机[3]</span><br><span class="line">   - 9|执行脚本，只要expect程序不错，这里基本不会错[4]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[0]</span><br><span class="line">刚开始考虑当母机资源超过一定比例则程序退出，比如磁盘使用超过2/3，后来觉得这样不够灵活，改用百分比，默认50%</span><br><span class="line">在设置百分比的时候有几点小问题</span><br><span class="line">1、浮点数运算保留小数</span><br><span class="line">    使用scale可以准确保留小数，<span class="built_in">echo</span> <span class="string">"scale=2;62/3"</span> | bc 结果 20.66</span><br><span class="line">    使用<span class="built_in">printf</span>可以保留小数位，补零填充  <span class="built_in">printf</span> %.2f 结果20.00</span><br><span class="line">2、浮点数运算不保留小数</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"123.123"</span>|sed <span class="string">"s/\..*//g"</span></span><br><span class="line">    *代表0到多个，所以第一个命令中\.*只能替换掉小数点变成空</span><br><span class="line">    \..*代表了小数点之后的1到多个</span><br><span class="line">3、除法</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"2 / 3"</span> | bc                          这个结果会显示为0</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"scale=2 ;2 / 3"</span> | bc                 这个结果会显示为.66</span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"%.2f"</span> `<span class="built_in">echo</span> <span class="string">"scale=2;2/3"</span> | bc`    这个结果会显示为0.66</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[1]</span><br><span class="line">刚开始的时候选择将subvm_configuration.sh这个脚本cat进内存，然后用expect登录到子机的时候<span class="built_in">echo</span>到文件，然后执行。后来发现expect输出的时候会把subvm_configuration.sh脚本里的内容先执行一遍，而且还存在其他一些问题，比如说<span class="built_in">echo</span>到文件的时候残缺不全、不换行、文件为空等。</span><br><span class="line">后来采用磁盘共享的方式，在宿主机上创建一块磁盘，然后挂载到/tmp/share/这个目录，再将subvm_configuration.sh脚本和ipinfo配置文件复制到该目录，之后在子机的XML文件中添加一块disk(vdc)，登录进子机后，挂载vdc，此时就可以看到母机上/tmp/share/下的内容了。直接执行脚本即可。</span><br><span class="line">磁盘共享也有一个缺点，就是文件内容不能实时刷新，比如在母机上改了ipinfo，只有子机重启后，子机上的ipinfo才可以刷新，鉴于/tmp/share/这个目录每个子机一生只有一次用到，所以这个问题暂时不需要解决。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[2]</span><br><span class="line">创建子机</span><br><span class="line">1、<span class="keyword">if</span> ( vlanid != 0  &amp;&amp; xenbrx not <span class="keyword">in</span> `brctl show` ) 会报错网卡未找到导致虚拟机启动失败</span><br><span class="line">2、vm-template模板不正确，包括&lt;emulator&gt;/usr/<span class="built_in">local</span>/bin/qemu-system-x86_64&lt;/emulator&gt;路径不正确，会导致虚拟机无法启动</span><br><span class="line">3、disk的slot卡槽相同会导致虚拟机无法启动</span><br><span class="line">4、需要注意的是，virsh define vm-template 这条命令的执行路径是/usr/<span class="built_in">local</span>/etc/libvirt/qemu/vm-template，最后会在/usr/<span class="built_in">local</span>/etc/libvirt/qemu/下生成vm<span class="variable">$ipfmt</span>.xml的配置文件。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[3]</span><br><span class="line">expect会有很多问题</span><br><span class="line">1、命令不按顺序执行</span><br><span class="line">2、传入的变量为空，且传入的变量下标是从0开始的；shell传入变量下标从1开始，0代表自身文件</span><br><span class="line">3、<span class="built_in">set</span> timeout <span class="variable">$time</span> 设置的时间不一定准确，设置了300秒延时，但未到300s，程序还是退出了，可以考虑直接设置 timeout 为-1</span><br><span class="line">4、expect有多种写法，有expect &lt;&lt; EOF ; expect eof ; 最正常的是上面用的</span><br><span class="line">5、expect文件用的解释器是/usr/bin/expect，这里将login.sh使用cat写在了单独的文件中</span><br><span class="line"></span><br><span class="line">[4]</span><br><span class="line">1、subvm_configuration.sh配置了两张网卡，格式化vdb数据盘，配置ssh</span><br><span class="line">2、eth0为连接外网的网卡，使用tunnel，eth1为内网网卡，使用vlan</span><br><span class="line"></span><br><span class="line">xenbrX为隧道入口，母机收到从xenbr361口收到的报文，就发给另一端隧道，从而实现连接外网</span><br><span class="line">tunnel network ---- host(default router: subhost -&gt; netowrk , throught interface &amp; sh vlan.sh ) ---- subhost</span><br><span class="line"></span><br><span class="line">母机收到vlan的报文，就在指定vlan的广播域内进行路由（不一定是母机进行路由）</span><br><span class="line">vlan network ---- host(broadcast router: subhost ---&gt; broadcast/vlanid throught 802.1Q )  ---- subhost</span><br></pre></td></tr></table></figure><h1 id=""><a href="#" class="headerlink" title="[*]"></a>[*]</h1><p>expect合理用法</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat  &lt;&lt; EOF &gt;  <span class="variable">$&#123;workdir&#125;</span>/login.sh</span><br><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="keyword">if</span> &#123; \<span class="variable">$argc</span> &lt; 1&#125; &#123;</span><br><span class="line">puts <span class="string">"Usage:cmd &lt;host&gt;"</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">set</span> timeout -1</span><br><span class="line"><span class="built_in">set</span> host [lindex \<span class="variable">$argv</span> 0]</span><br><span class="line">spawn virsh console \<span class="variable">$host</span></span><br><span class="line">expect <span class="string">"*Escape*"</span> &#123; send <span class="string">"\r"</span> &#125;</span><br><span class="line">expect <span class="string">"*login*"</span> &#123; send <span class="string">"root\r"</span> &#125;</span><br><span class="line">expect <span class="string">"*Password*"</span> &#123; send <span class="string">"xxxx\r"</span> &#125;</span><br><span class="line">interact</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>高效的while</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> equipmentName ip netmask;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"=====================<span class="variable">$&#123;equipmentName&#125;</span>=================="</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"inner_ip:<span class="variable">$&#123;ip&#125;</span>"</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"inner_netmask:<span class="variable">$&#123;netmask&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span> &lt; file</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;大雨落幽燕，白浪滔天，秦皇岛外打鱼船，一片汪洋都不见。知向谁边？&lt;br&gt;往事越千年，魏武挥鞭，东临碣石有遗篇。萧瑟秋风今又是，换了人间。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="http://archks.gitee.io/web/categories/Linux/"/>
    
    
      <category term="KVM" scheme="http://archks.gitee.io/web/tags/KVM/"/>
    
  </entry>
  
  <entry>
    <title>WebSocket</title>
    <link href="http://archks.gitee.io/web/2020/05/03/WebSocket/"/>
    <id>http://archks.gitee.io/web/2020/05/03/WebSocket/</id>
    <published>2020-05-03T11:28:35.000Z</published>
    <updated>2020-07-04T17:17:48.944Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>忆昔午桥桥上饮，坐中多是豪英。<br>长沟流月去无声，杏花疏影里，吹笛到天明。</p><p>二十馀年成一梦，此身虽在堪惊。<br>闲登小阁看新晴，古今多少事，渔唱起三更。</p></blockquote><a id="more"></a><h1 id="WS介绍"><a href="#WS介绍" class="headerlink" title="WS介绍"></a>WS介绍</h1><p>HTTP</p><p>超文本传输协议(HTTP,HypertextTransferProtocol)是互联网上应用最为广泛的一种网络协议。是用于从WWW服务器传输超文本到本地浏览器的传送协议。</p><p>Web通讯</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/05/03/ToOBRW7IeUilqa9.png" alt="image-20200503143751258.png"></p><p>WebSocket</p><p>WebSocket Protocal是HTML5一种新的协议，它实现了浏览器与服务器全双工通信（full-duple），一开始握手需要借助http请求完成。</p><p>HTTP请求是无状态的，每一次收发数据都需要建立连接。WebSocket不需要建立连接就可以收发数据。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/05/03/2e13BGHfSyCtAqs.png" alt="image-20200503143949598.png"></p><p>WebSocket对象提供一组API，用于创建和管理WebSocket连接，以及通过连接发送和接受数据。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">创建WebSocket对象</span><br><span class="line">var ws = new WebSocket(url,[protocals]);</span><br><span class="line"></span><br><span class="line">url: 表示要连接的URL，这个URL应该为响应WebSocket的地址</span><br><span class="line">protocals:可以是单个的协议名字字符串或者包含多个协议名字字符串的数组</span><br></pre></td></tr></table></figure><p>方法</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">close([code][,reason]) 关闭websocket连接或停止正在进行的连接请求</span><br><span class="line">code: 一个数字表示关闭连接的状态号，表示连接关闭的原因</span><br><span class="line">reason: 一个可读字符串，表示连接被关闭的原因</span><br><span class="line"></span><br><span class="line">send(data) 通过websocket连接，向服务器发送数据</span><br><span class="line">data: 一个数字值表示关闭连接的状态号，表示连接被关闭的原因</span><br></pre></td></tr></table></figure><p>属性</p><table><thead><tr><th>名词</th><th>解释</th></tr></thead><tbody><tr><td>onclose</td><td>用于监听连接关闭事件监听器。当WebSocket对象的ReadyState状态变为CLOSED时，会触发该事件。会接受一个close event对象</td></tr><tr><td>onerror</td><td>当错误发生时，用于监听error事件的事件监听器，会接受一个error event对象</td></tr><tr><td>onmessage</td><td>一个用于消息事件的事件监听器，这一事件当有消息到达的时候该事件会触发。会接受一个message event对象</td></tr><tr><td>onopen</td><td>一个用于连接打开事件的事件监听器，当readyState的值变为OPEN的时候会触发该事件，会接受一个open event对象</td></tr><tr><td>readyState</td><td>连接的当前状态 0 连接还没开启 1 连接已经开启并准备好进行通信 2 连接正在关闭的过程中 3 连接已经关闭，或者连接无法建立</td></tr></tbody></table><h1 id="简易的WS"><a href="#简易的WS" class="headerlink" title="简易的WS"></a>简易的WS</h1><p>npm安装websocket</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install websocket</span><br></pre></td></tr></table></figure><p>后端页面</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(<span class="string">'websocket'</span>).server;</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建服务器</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Received request for '</span> + request.url);</span><br><span class="line">    response.writeHead(<span class="number">404</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 监听8080端口</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Server is listening on port 8080'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建websocket服务器</span></span><br><span class="line">wsServer = <span class="keyword">new</span> WebSocketServer(&#123;</span><br><span class="line">    httpServer: server,</span><br><span class="line">    autoAcceptConnections: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//websocket建立连接</span></span><br><span class="line">wsServer.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//当前的连接</span></span><br><span class="line">    <span class="keyword">var</span> connection = request.accept(<span class="literal">null</span>, request.origin);</span><br><span class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Connection accepted.'</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定时向客户端发送消息</span></span><br><span class="line">    setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        connection.sendUTF(<span class="string">"服务端发送新消息"</span>+(<span class="keyword">new</span> <span class="built_in">Date</span>()))</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听当前连接，发送message的时候</span></span><br><span class="line">    connection.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (message.type === <span class="string">'utf8'</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Received Message: '</span> + message.utf8Data);</span><br><span class="line">            connection.sendUTF(message.utf8Data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (message.type === <span class="string">'binary'</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Received Binary Message of '</span> + message.binaryData.length + <span class="string">' bytes'</span>);</span><br><span class="line">            connection.sendBytes(message.binaryData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 监听当前连接，当close的时候出发事件</span></span><br><span class="line">    connection.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">reasonCode, description</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Peer '</span> + connection.remoteAddress + <span class="string">' disconnected.'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>前端页面</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Websocket前端页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 创建websocket对象</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:3000"</span>);</span></span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        <span class="comment">// 监听建立连接</span></span></span><br><span class="line"><span class="actionscript">        ws.onopen = <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"连接成功！"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">//监听有新消息</span></span></span><br><span class="line"><span class="actionscript">        ws.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"有新消息！"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面效果</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/05/03/4jEb27kvDXBKF8H.png" alt="image-20200503150850275.png"></p><h1 id="多人通讯"><a href="#多人通讯" class="headerlink" title="多人通讯"></a>多人通讯</h1><p>后端</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>)</span><br><span class="line"><span class="comment">// 引入websocket模块</span></span><br><span class="line"><span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(<span class="string">'websocket'</span>).server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//存储所有终端连接</span></span><br><span class="line"><span class="keyword">var</span> clients  = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入http模块，搭建http服务器</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"><span class="comment">// server.listen(3000, ()=&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log("服务器搭建成功！,监听localhost:3000")</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务器创建成功"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建websocket服务对象</span></span><br><span class="line"><span class="keyword">var</span> wsServer = <span class="keyword">new</span> WebSocketServer(&#123;<span class="attr">httpServer</span>:server&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听连接请求，建立连接</span></span><br><span class="line"><span class="comment">// webSocketRequest 当前连接建立的请求</span></span><br><span class="line">wsServer.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">webSocketRequest</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"建立连接"</span>)</span><br><span class="line">    <span class="comment">// 当前连接 会话</span></span><br><span class="line">    <span class="keyword">var</span> connection = webSocketRequest.accept(<span class="literal">null</span>, <span class="string">'accepted-origin'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把连接添加到终端</span></span><br><span class="line">    clients.push(connection)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端发来信息的时候 ,判断信息的两种类型</span></span><br><span class="line">    <span class="comment">// For Text Frames:</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     type: "utf8",</span></span><br><span class="line">    <span class="comment">//     utf8Data: "A string containing the received message."</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// // For Binary Frames:</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     type: "binary",</span></span><br><span class="line">    <span class="comment">//     binaryData: binaryDataBuffer // a Buffer object containing the binary message payload</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    connection.on(<span class="string">"message"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果是文本类型，则给每一个当前的连接都发送一遍</span></span><br><span class="line">        <span class="keyword">if</span>(msg.type == <span class="string">"utf8"</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"遍历用户，发送数据...."</span>+msg.utf8Data)</span><br><span class="line">            <span class="comment">// 遍历连接数组，给每一个连接发送数据</span></span><br><span class="line">            clients.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">                <span class="comment">//发送数据</span></span><br><span class="line">                item.sendUTF(msg.utf8Data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当连接断开的时候 , 触发事件</span></span><br><span class="line">    connection.on(<span class="string">"close"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">reasonCode,description</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"断开连接"</span>)</span><br><span class="line">        <span class="comment">// 获取当前索引，根据索引删除连接</span></span><br><span class="line">        <span class="keyword">var</span> index = clients.indexOf(connection)</span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        clients.splice(index,<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>前端</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>多终端通信<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span>SEND<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:3000"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> inputNode = <span class="built_in">document</span>.getElementById(<span class="string">"msg"</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ulCon = <span class="built_in">document</span>.getElementById(<span class="string">"content"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 将用户输入发送给服务端</span></span></span><br><span class="line">            ws.send(inputNode.value)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        ws.onopen = <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"连接成功！"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        ws.onmessage=<span class="function"><span class="keyword">function</span><span class="params">(msg)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 接受服务端传来的数据</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 这里不是msg.value，因为这里的msg是websocket的msg，不是id=msg的意思</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"MSG.value:"</span>+msg.data)</span></span><br><span class="line"><span class="actionscript">            content.innerHTML+=<span class="string">'&lt;li&gt;'</span>+msg.data+<span class="string">'&lt;/li&gt;'</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;忆昔午桥桥上饮，坐中多是豪英。&lt;br&gt;长沟流月去无声，杏花疏影里，吹笛到天明。&lt;/p&gt;
&lt;p&gt;二十馀年成一梦，此身虽在堪惊。&lt;br&gt;闲登小阁看新晴，古今多少事，渔唱起三更。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="编程" scheme="http://archks.gitee.io/web/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="WebSocket" scheme="http://archks.gitee.io/web/tags/WebSocket/"/>
    
  </entry>
  
  <entry>
    <title>NodeJS（一） 静态路由</title>
    <link href="http://archks.gitee.io/web/2020/04/29/NodeJS_1/"/>
    <id>http://archks.gitee.io/web/2020/04/29/NodeJS_1/</id>
    <published>2020-04-29T11:57:22.000Z</published>
    <updated>2020-07-04T17:18:54.594Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>念两句诗<br>黄金榜上，偶失龙头望。<br>明代暂遗贤，如何向。<br>未遂风云便，争不恣游狂荡。何须论得丧？<br>才子词人，自是白衣卿相。</p></blockquote><a id="more"></a><h1 id="Nodejs简介"><a href="#Nodejs简介" class="headerlink" title="Nodejs简介"></a>Nodejs简介</h1><p>​    V8引擎本身是用于Chrome浏览器的JS解释部分，但是Ryan Dahl将其搬到了服务器上，用于做服务器。</p><p>​    浏览器和服务器类似，浏览器是发送HTTP请求，接受HTTP响应，服务器也是接受HTTP请求，发送HTTP响应。都已HTML的方式实现。</p><p>​    Nodejs是一个让Javascript运行在服务器端的开发平台，它让Javascript的触角伸到了服务器端，可以和PHP、JSP、Python、Ruby平起平坐。</p><p>不同之处：</p><ol><li>Nodejs不是一种独立的语言，与PHP、JSP、Python的“既是语言，也是平台不同，Nodejs的使用Javascript进行编程，运行在Javascript引擎上（V8）</li><li>与PHP、JSP相比，Nodejs跳过了Apache、Nginx、IIS等HTTP服务器，自己不用建设在任何服务器软件之上。</li></ol><p>Nodejs特点</p><ol><li>单线程</li><li>非阻塞IO</li><li>事件驱动</li></ol><p>1、单线程</p><p>在java、php等服务器端语言中，会为每个客户连接创建一个新的线程，每个线程耗费大约2MB的内存，理论上，一个8G内存的服务器可以同时连接的最大用户数为4000个。</p><p>Nodejs不为每个客户连接创建一个新的线程，而仅仅使用一个线程。当有用户连接了，就触发一个内部时间，通过非阻塞I/O、事件驱动机制，让Node.js程序宏观上也是并行的。使用Nodejs，一个8G的服务器可以同时处理超过4万用户的连接</p><p>另外，单线程带来的好处，还有操作系统完全不再有创建线程，销毁线程带来的时间开销。</p><p>但是，一个用户造成的线程崩溃，其他服务也就崩溃了。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/04/29/GgYacbvhxfnMFPp.png" alt="image-20200427100929280.png"></p><p>2、非阻塞I/O（non-blocking IO）</p><p>例如，当在访问数据库取得数据的时候，需要一段时间。在传统的单线程处理机制中，在执行了访问数据库代码之后，整个线程都将暂停下来，等待数据库返回结果，才能执行后面的代码。也就是说，I/O阻塞了代码的执行，极大的降低了程序的执行效率。</p><p>由于Nodejs采用了非阻塞I/O机制，因此在执行访问数据库代码之后，将立即转而执行后面的代码，把数据库返回结果的处理代码放在回调函数中，从而提高了程序执行效率。</p><p>当某个I/O执行完毕时，将以事件的形式同之I/O操作的线程，线程执行这个事件的回调函数，为了处理异步I/O，线程必须有事件循环，不断的检查有没有未处理的事件。</p><p>阻塞模式下，一个线程只能处理一项任务，想要提高吞吐量必须通过多线程，而非阻塞模式下，一个线程永远在执行计算操作，这个线程的CPU核心利用率永远是100%。</p><p>3、事件驱动（event-driven）</p><p>在Node中，客户端请求建立连接，提交数据等行为，会触发相应的事件，在Node中，一个时刻只能执行一个事件回调函数，但是在执行一个事件回调函数的中途，可以转而处理其他事件（比如又有新用户连接），然后返回据徐执行原事件的回调函数，这种处理机制，称为”时间环“</p><p>Nodejs底层时C++，底层代码中，近半数都是用于事件队列、回调函数队列的构建。</p><h1 id="Nodejs适合做什么？"><a href="#Nodejs适合做什么？" class="headerlink" title="Nodejs适合做什么？"></a>Nodejs适合做什么？</h1><p>​    善于I/O，不善于计算。因为Nodejs最擅长的就是任务调度，如果你的业务有很多CPU计算，实际上也相当于计算阻塞了这个单线程。</p><p>​    当应用程序需要处理大量并发I/O，而向客户端发出响应之前，应用程序内部不需要进行复杂处理的时候，Nodejs非常合适。Nodejs也非常合适与web socket配合，开发长连接（长连接实际上是通过大量请求模拟长连接）的实时交互应用程序。</p><p>比如</p><ul><li>用户表单收集</li><li>考试系统</li><li>聊天室</li><li>图文直播</li><li>提供JSON的API</li></ul><p>Nodejs本身就是极客追求性能极致的产物，缺少了服务器的健壮考量。所以Node不可能应用在极高可靠性的业务中。</p><h1 id="Hello-Node"><a href="#Hello-Node" class="headerlink" title="Hello Node"></a>Hello Node</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//require表示导包</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="comment">//创建服务器，参数是一个回调函数，表示如果有什么请求进来，要做什么</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123; </span><br><span class="line">    <span class="comment">// req表示请求，request；res表示响应，response</span></span><br><span class="line">    <span class="comment">// 设置HTTP头部，状态码200，文件类型html，字符集utf8</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">    res.end(<span class="string">"Hello NodeJS"</span>);</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment">//运行服务器，监听3000端口，任何地址都可以访问</span></span><br><span class="line"> server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/04/29/iVcvReodCyXm7t6.png" alt="image-20200427105856751.png"></p><p>NodeJS是服务器语句，写的js语句都将运行在服务器上，返回给客户的，都是已经处理好的纯HTML。如果想修改程序，必须中断当前程序，然后重新启动node，不支持热部署。</p><h1 id="Nodejs路由"><a href="#Nodejs路由" class="headerlink" title="Nodejs路由"></a>Nodejs路由</h1><p>Node.JS没有根目录，因为它没有web容器的概念。</p><p>先写一个静态的H5页面：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.app</span>&#123;</span></span><br><span class="line">            background-color: red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Nodejs读取文件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app"</span>&gt;</span>这是一个测试文件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果大概是这样：</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/04/29/U5NCRwMdscT1KVn.png" alt="image-20200427210543157" style="zoom:33%;" /><ol><li>使用req.url判断输入的路径</li><li>使用fs.readFile()读取网页页面</li><li>使用res.end()返回数据</li></ol><p>然后写staticRender.js文件</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">"/red"</span>)&#123;</span><br><span class="line">        <span class="comment">// 输入路由和源文件没有关系</span></span><br><span class="line">        fs.readFile(<span class="string">"./red.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">            res.end(data);</span><br><span class="line">    </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(req.url == <span class="string">"/blue"</span>)&#123;</span><br><span class="line">        fs.readFile(<span class="string">"./blue.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">            res.end(data);</span><br><span class="line">    </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">404</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">        res.end(<span class="string">"没有这个页面"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/04/29/U5NCRwMdscT1KVn.png" alt="image-20200427210543157" style="zoom:33%;" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.loli.net/2020/04/29/CjBTplzuqLcP5x8.png" alt="image-20200428123714399" style="zoom:33%;" /><p>NodeJS任何静态页面都需要路由，比如在HTML中插入一个image或者css样式，也需要设置一条路由。Nodejs擅长做顶层路由设计。</p><h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><p>Nodejs中，讲很多的功能划分为了一个个module。</p><h2 id="HTTP模块"><a href="#HTTP模块" class="headerlink" title="HTTP模块"></a>HTTP模块</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//引用模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123; </span><br><span class="line">    <span class="comment">//req参数表示请求，res表示响应</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务器接收到了请求"</span>+req.url);</span><br><span class="line">    <span class="comment">//告诉浏览器连接终止</span></span><br><span class="line">    res.end(); <span class="comment">//end中必须是字符串或者缓冲区</span></span><br><span class="line"> &#125;);</span><br><span class="line"> server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><p>向请求发送响应头，此方法只能在消息上调用一次，并且必须在调用 response.end() 之前调用。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br></pre></td></tr></table></figure><p>req的属性，最关键的就是req.url属性，表示用户请求的URL地址，所有路由设计，都是通过req.url来实现的，我们比较关心的不是拿到URL，而是识别这个URL。</p><p>识别URL用到两个模块，一个是url模块，另一个是querystring模块。</p><h2 id="url"><a href="#url" class="headerlink" title="url"></a>url</h2><p>用于解析url，这样就可以不用正则表达式了</p><p><a href="http://nodejs.cn/api/url.html#url_url_strings_and_url_objects" target="_blank" rel="noopener">http://nodejs.cn/api/url.html#url_url_strings_and_url_objects</a></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="comment">//url.parse()可以将一个完整的URL地址分为很多部分</span></span><br><span class="line">myURL=url.parse(<span class="string">'https://user:pass@sub.host.com:8080/p/a/t/h?query=string#hash'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(myURL.host);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// url.host 获取及设置 URL 的主机部分。</span></span><br><span class="line">    <span class="comment">// url.hostname 获取及设置 URL 的主机名部分。 url.host 和 url.hostname 之间的区别是 url.hostname 不包含端口。</span></span><br><span class="line">    <span class="comment">// url.password 获取及设置 URL 的密码部分。</span></span><br><span class="line">    <span class="comment">// url.pathname 获取及设置 URL 的路径部分。</span></span><br><span class="line">    <span class="comment">// url.port 获取及设置 URL 的端口部分。</span></span><br><span class="line">    <span class="comment">// url.protocol 获取及设置 URL 的协议部分。</span></span><br><span class="line">    <span class="comment">// url.username 获取及设置 URL 的用户名部分。</span></span><br><span class="line">    <span class="comment">// url.query 获取及设置URL的查询部分 &amp;name=jack&amp;age=18</span></span><br><span class="line">    <span class="comment">// url.parse(req.url,true).query = &gt; </span></span><br><span class="line">    <span class="comment">// [Object: null prototype] &#123; name: 'jack', age: '18' &#125;</span></span><br><span class="line">    <span class="comment">// [Object: null prototype] &#123; name: 'jack', age: '18' &#125;</span></span><br><span class="line"></span><br><span class="line">url.parse(<span class="string">'url'</span>,<span class="literal">true</span>); <span class="comment">//如果第二个参数是true，那么就可以把所有的查询变为对象 ， 就可以直接打点得到这个参数。</span></span><br></pre></td></tr></table></figure><p>表单提交案例：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>表单提交<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:3000"</span> <span class="attr">method</span>=<span class="string">"GET"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"男"</span>/&gt;</span>男</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"女"</span>/&gt;</span>女<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>提交到浏览器的结果为：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:3000/?name=杜振铨&amp;age=21&amp;sex=男</span><br></pre></td></tr></table></figure><p>然后在Nodejs服务端用url解析出来</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    myURL=url.parse(req.url,<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">var</span> info = <span class="string">"服务器收到了 - 姓名："</span>+myURL.query.name + <span class="string">"性别："</span>+myURL.query.sex + <span class="string">"年龄："</span>+myURL.query.age;</span><br><span class="line">    <span class="comment">// 这里要用UTF8不然中文乱码</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    res.end(info);</span><br><span class="line"> &#125;).listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><p>最后在网页上呈现这样的效果：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">服务器收到了 - 姓名：杜振铨 性别：男 年龄：21</span><br></pre></td></tr></table></figure><p>简单的路由演示：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// http://127.0.0.1:3000/teacher/122456</span></span><br><span class="line">    <span class="comment">//提取出url,为/teacher/123456</span></span><br><span class="line">    <span class="keyword">var</span> myurl = req.url;</span><br><span class="line">    <span class="built_in">console</span>.log(myurl);</span><br><span class="line"></span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    <span class="comment">//比较前9位 [0,9)</span></span><br><span class="line">    <span class="keyword">if</span>(myurl.substr(<span class="number">0</span>,<span class="number">9</span>) == <span class="string">"/teacher/"</span>)&#123;</span><br><span class="line">        <span class="comment">//取出从第九位开始往后的,这里就是123456</span></span><br><span class="line">        tearcherid = myurl.substr(<span class="number">9</span>);</span><br><span class="line">        <span class="comment">//看取出来的id是否满足6位数字,不满足则返回不存在,学生栏也一样</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="regexp">/^\d&#123;6&#125;$/</span>.test(tearcherid))&#123;</span><br><span class="line">            res.end(<span class="string">"您要查询的老师信息为 id:"</span>+tearcherid);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.end(<span class="string">"您访问的老师不存在!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(myurl.substr(<span class="number">0</span>,<span class="number">9</span>) == <span class="string">"/student/"</span>)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> studentid = myurl.substr(<span class="number">9</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="regexp">/^\d&#123;10&#125;$/</span>.test(studentid))&#123;</span><br><span class="line">            res.end(<span class="string">"您要查询的学生信息为 id:"</span>+studentid);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.end(<span class="string">"您访问的学生不存在!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        res.end(<span class="string">"您访问的人员不存在!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><h2 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h2><ol><li>readFile读取文件</li><li>mkdir 新建文件夹</li><li>rmdir 移除文件夹</li><li>fs.Stats 查看文件属性<ol><li>stats.isBlockDevice()</li><li>stats.isCharacterDevice()</li><li>stats.isDirectory()</li><li>stats.isFIFO()</li><li>stats.isFile()</li><li>stats.isSocket()</li><li>….</li></ol></li><li></li></ol><p>读取文件</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 三个参数,第一个是完整的路径,当前目录写./</span></span><br><span class="line">   <span class="comment">// 第二个参数是字符集,也可以不设置</span></span><br><span class="line">   <span class="comment">// 第三个参数是回调函数,表示文件读取成功后,做的事</span></span><br><span class="line">   fs.readFile(<span class="string">"./demo.txt"</span>,&#123;<span class="string">"charset"</span>:<span class="string">"utf-8"</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123; </span><br><span class="line">       <span class="comment">// 抛异常</span></span><br><span class="line">       <span class="keyword">if</span>(err)&#123;</span><br><span class="line">           <span class="keyword">throw</span> err;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="built_in">console</span>.log(userid+<span class="string">"文件读取完毕!"</span>);</span><br><span class="line">       res.end(data);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>利用读取文件，验证事件环，即NodeJS的单进程异步非阻塞事件驱动模型。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> userid = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">10000</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(userid);</span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    fs.readFile(<span class="string">"./demo.txt"</span>,&#123;<span class="string">"charset"</span>:<span class="string">"utf-8"</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(userid+<span class="string">"文件读取完毕!"</span>);</span><br><span class="line">        res.end(data);</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><p>通过访问 <a href="http://127.0.0.1:3000" target="_blank" rel="noopener">http://127.0.0.1:3000</a></p><p>我们可以看到如下</p><p>5435<br>5435文件读取完毕!</p><p>现在我们模拟1000并发</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line">url = <span class="string">"http://127.0.0.1:3000"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span><span class="params">()</span>:</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    print(response.status_code)</span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">    t = Thread(target=req,)</span><br><span class="line">    t.start()</span><br><span class="line">    l.append(t)</span><br><span class="line">[ i.join() <span class="keyword">for</span> i <span class="keyword">in</span> l]</span><br><span class="line">print(<span class="string">"完成!"</span>)</span><br></pre></td></tr></table></figure><p>然后就可以看到</p><p>6182<br>9997<br>6182文件读取完毕!<br>9997文件读取完毕!<br>3450<br>3450文件读取完毕!</p><p>可以发现，NodeJS在处理当前用户的时候，还会切换到另外的事件调度。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">   <span class="comment">//recursive 多级目录需要递归创建 </span></span><br><span class="line">fs.mkdir(<span class="string">"./ablum/niki"</span>,&#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;,(err) =&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="fs处理异步问题"><a href="#fs处理异步问题" class="headerlink" title="fs处理异步问题"></a>fs处理异步问题</h2><ol><li>由于异步性，下面的语句会在回调函数之前执行</li><li>所以console.log()已经把文件夹输出了，但事实上for循环并没有开始遍历</li><li>三层回调涉及到的方法<ol><li>http.createServer()创建一个服务器</li><li>fs.readdir() 读取目录下文件和文件夹</li><li>fs.stat() 读取文件或者文件夹的状态</li></ol></li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">"/favicon.ico"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 定义一个变量，用来存放目录</span></span><br><span class="line">    <span class="keyword">var</span> dirs = []</span><br><span class="line">    <span class="comment">// 读取./ablum下的所有文件,包括文件和文件夹</span></span><br><span class="line">    fs.readdir(<span class="string">"./ablum"</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,files</span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(files.length);</span><br><span class="line">        <span class="comment">// 便利这些文件和文件夹,找到其中是文件夹的,将其放入dirs</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;files.length;i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> path = <span class="string">"./ablum/"</span>+files[i];</span><br><span class="line">            fs.stat( path,<span class="function"><span class="keyword">function</span>(<span class="params">err,stats</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(stats.isDirectory())&#123;</span><br><span class="line">                    dirs.push(path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 由于异步,上面的函数执行完了会立刻执行下面的函数,也就是说,上面还没开始遍历,下面已经执行了.所以这里的dirs是[]空的</span></span><br><span class="line">        <span class="built_in">console</span>.log(dirs);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    res.end(<span class="string">"Success"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><p>解决办法：迭代器——循环强制同步</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">"/favicon.ico"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个变量，用来存放目录</span></span><br><span class="line">    <span class="keyword">var</span> dirs = []</span><br><span class="line">    <span class="comment">// 读取./ablum下的所有文件,包括文件和文件夹</span></span><br><span class="line">    fs.readdir(<span class="string">"./ablum"</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,files</span>) </span>&#123; </span><br><span class="line">        <span class="comment">//定义一个递归函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">iterator</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 一旦下标到达数组长度,则返回</span></span><br><span class="line">            <span class="keyword">if</span>(i == files.length)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(dirs);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> path = <span class="string">"./ablum/"</span>+files[i];</span><br><span class="line">            <span class="comment">// 判断是否为文件夹,如果是,则加入dirs</span></span><br><span class="line">            fs.stat(path,<span class="function"><span class="keyword">function</span> (<span class="params">err,stats</span>) </span>&#123; </span><br><span class="line">                <span class="keyword">if</span>(stats.isDirectory())&#123;</span><br><span class="line">                    dirs.push(path);</span><br><span class="line">                &#125;</span><br><span class="line">                iterator(i+<span class="number">1</span>);</span><br><span class="line">             &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 强制当前下标迭代完再迭代下一个下标</span></span><br><span class="line">        iterator(<span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    res.end(<span class="string">"Success"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure><h1 id="静态目录"><a href="#静态目录" class="headerlink" title="静态目录"></a>静态目录</h1><ol><li>通过路径访问文件</li><li>浏览器的Content-type能读取文件正确的格式以便渲染</li><li>事先在同级目录下准备static文件，用于存放html、css、jpg等静态资源</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line"><span class="comment">//得到用户的路径</span></span><br><span class="line"><span class="keyword">var</span> pathname = url.parse(req.url).pathname;</span><br><span class="line"><span class="comment">//默认首页</span></span><br><span class="line"><span class="keyword">if</span>(pathname == <span class="string">"/"</span>)&#123;</span><br><span class="line">pathname = <span class="string">"index.html"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//拓展名</span></span><br><span class="line"><span class="keyword">var</span> extname = path.extname(pathname);</span><br><span class="line"></span><br><span class="line"><span class="comment">//真的读取这个文件</span></span><br><span class="line">fs.readFile(<span class="string">"./static/"</span> + pathname,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(err)&#123;</span><br><span class="line"><span class="comment">//如果此文件不存在，就应该用404返回</span></span><br><span class="line">fs.readFile(<span class="string">"./static/404.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">res.writeHead(<span class="number">404</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">res.end(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//MIME类型，就是</span></span><br><span class="line"><span class="comment">//网页文件：  text/html</span></span><br><span class="line"><span class="comment">//jpg文件 :   image/jpg</span></span><br><span class="line"><span class="keyword">var</span> mime = getMime(extname);</span><br><span class="line">res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:mime&#125;);</span><br><span class="line">res.end(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;).listen(<span class="number">3000</span>,<span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMime</span>(<span class="params">extname</span>)</span>&#123;</span><br><span class="line"><span class="keyword">switch</span>(extname)&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">".html"</span> :</span><br><span class="line"><span class="keyword">return</span> <span class="string">"text/html"</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">".jpg"</span> : </span><br><span class="line"><span class="keyword">return</span> <span class="string">"image/jpg"</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">".css"</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"text/css"</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;念两句诗&lt;br&gt;黄金榜上，偶失龙头望。&lt;br&gt;明代暂遗贤，如何向。&lt;br&gt;未遂风云便，争不恣游狂荡。何须论得丧？&lt;br&gt;才子词人，自是白衣卿相。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="编程" scheme="http://archks.gitee.io/web/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="NodeJS" scheme="http://archks.gitee.io/web/tags/NodeJS/"/>
    
  </entry>
  
</feed>
