<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8" >
    <meta name="baidu-site-verification" content="dIcXMeY8Ya" />
    
    <title>Linux网络存储 | zen&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" >
    <meta name="keywords" content="Jelon, 前端, Web, 张德龙, 前端开发" >
    <meta name="description" content="Jelon个人前端小站" >

    
    <link rel="alternative" href="/atom.xml" title="zen&#39;s blog" type="application/atom+xml" >
    
    
    <link rel="shortcut icon" href="../../../../favicon.ico" >
    
    
<link rel="stylesheet" href="../../../../css/style.css">

    <!--[if lt IE 9]>
    
<script src="../../../../js/html5.js"></script>

    <![endif]-->
    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d5ebf515ab530cfbdda5f5c85093fb41";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/" target="_blank" rel="noopener">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="../../../../index.html">
                <div class="cover">
                    <span class="name">zen&#39;s blog</span>
                    <span class="description"></span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="" class="item ">
                <a href="../../../../index.html" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="" class="item ">
                <a href="../../../../lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="" class="item ">
                <a href="../../../../about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="" class="item ">
                <a href="../../../../comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/jangdelong" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="http://weibo.com/jangdelong" class="sinaweibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href="https://www.facebook.com/profile.php?id=100011855760219&amp;ref=bookmarks" class="qqweibo" target="_blank"><b>■</b> Facebook</a>
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="../../../../img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon" >
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章页 -->
<!-- 文章 -->
<article class="post article">
    <header class="text-center">
        <h3 class="post-title"><span>Linux网络存储</span></h3>
    </header>
    <p class="post-meta text-center">
        Jelon 发表于
        <time datetime="2020-01-16T11:36:23.000Z">2020-01-16</time>
    </p>
    <div class="post-content">
        <p>天南地北双飞客，老翅几回寒暑。<br>君应有语：渺万里层云，千山暮雪，只影向谁去？<br>千秋万古，为留待骚人，狂歌痛饮，来访雁丘处。</p>
<a id="more"></a>

<h1 id="1、FTP服务"><a href="#1、FTP服务" class="headerlink" title="1、FTP服务"></a>1、FTP服务</h1><p>FTP（File Transfer Protocol）文件传输协议，主要功能是在服务器与客户端之间进行文件的传输。FTP协议使用明码传输，为了使用更安全的FTP协议，可以采用vsftpd（Very Secure Ftp Daemon）。</p>
<p><img src="https://i.loli.net/2020/01/16/THwJ6F12Ld95lkP.png" alt="image-20200115190549585.png"></p>
<h2 id="协议摘要"><a href="#协议摘要" class="headerlink" title="协议摘要"></a>协议摘要</h2><h3 id="两种工作模式"><a href="#两种工作模式" class="headerlink" title="两种工作模式"></a>两种工作模式</h3><blockquote>
<ol>
<li>主动模式：FTP服务器主动向客户端发起请求</li>
<li>被动模式：FTP服务器等待客户端发起连接请求（FTP默认工作模式）</li>
</ol>
</blockquote>
<h3 id="三种用户等级"><a href="#三种用户等级" class="headerlink" title="三种用户等级"></a>三种用户等级</h3><ol>
<li>匿名用户。是一种最不安全的认证模式，任何人都可以无需密码验证而直接登录到FTP服务器。匿名用户默认访问目录是：<code>var/ftp</code></li>
<li>本地用户：使用Linux本地的账户密码进行认证，默认访问目录是<code>/home/person</code></li>
<li>虚拟用户：是这三种模式中最安全的一种认证模式，它需要为FTP服务单独建立用户数据库文件，虚拟出用来进行口令验证的账户信息，而这些账户信息在服务器系统中实际上是不存在的，仅供FTP服务程序进行认证使用。这样，即使黑客破解了账户信息也无法登录服务器，从而有效降低了破坏范围和影响。</li>
</ol>
<p>限制用户活动目录（change root，简称chroot）：将使用者的工作范围限定在用户的家目录。</p>
<h3 id="两个指定端口"><a href="#两个指定端口" class="headerlink" title="两个指定端口"></a>两个指定端口</h3><p>​    21端口用来<strong>建立连接</strong>，20端口用于<strong>传输数据</strong>。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>​    FTP使用系统的syslogd来进行数据记录，记录了包括用户曾经下达过的命令与用户传输数据（传输时间，文件大小等）记录，记录文件在<code>/var/log</code>下。</p>
<h3 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h3><p>​    VSftpd服务程序的主配置文件在<code>/etc/vsftpd/vsftpd.conf</code>下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># grep -Ev '^#' /etc/vsftpd/vsftpd.conf</span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">listen=NO</span><br><span class="line">listen_ipv6=YES</span><br><span class="line"></span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">userlist_enable=YES</span><br><span class="line">tcp_wrappers=YES</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>listen=[YES|NO]</td>
<td>是否以独立运行的方式监听服务</td>
</tr>
<tr>
<td>listen_address=IP地址</td>
<td>设置要监听的IP地址</td>
</tr>
<tr>
<td>listen_port=21</td>
<td>设置FTP服务的监听端口</td>
</tr>
<tr>
<td>download_enable＝[YES|NO]</td>
<td>是否允许下载文件</td>
</tr>
<tr>
<td>userlist_enable=[YES|NO]userlist_deny=[YESNO]</td>
<td>设置用户列表为“允许”还是“禁止”操作</td>
</tr>
<tr>
<td>max_clients=0</td>
<td>最大客户端连接数，0为不限制</td>
</tr>
<tr>
<td>max_per_ip=0</td>
<td>同一IP地址的最大连接数，0为不限制</td>
</tr>
<tr>
<td>anonymous_enable=[YES|NO]</td>
<td>是否允许匿名用户访问</td>
</tr>
<tr>
<td>anon_upload_enable=[YES|NO]</td>
<td>是否允许匿名用户上传文件</td>
</tr>
<tr>
<td>anon_umask=022</td>
<td>匿名用户上传文件的umask值</td>
</tr>
<tr>
<td>anon_root=/var/ftp</td>
<td>匿名用户的FTP根目录</td>
</tr>
<tr>
<td>anon_mkdir_write_enable=[YES|NO]</td>
<td>是否允许匿名用户创建目录</td>
</tr>
<tr>
<td>anon_other_write_enable=[YES|NO]</td>
<td>是否开放匿名用户的其他写入权限（包括重命名、删除等操作权限）</td>
</tr>
<tr>
<td>anon_max_rate=0</td>
<td>匿名用户的最大传输速率（字节/秒），0为不限制</td>
</tr>
<tr>
<td>local_enable=[YES|NO]</td>
<td>是否允许本地用户登录FTP</td>
</tr>
<tr>
<td>local_umask=022</td>
<td>本地用户上传文件的umask值</td>
</tr>
<tr>
<td>local_root=/var/ftp</td>
<td>本地用户的FTP根目录</td>
</tr>
<tr>
<td>chroot_local_user=[YES|NO]</td>
<td>是否将用户权限禁锢在FTP目录，以确保安全</td>
</tr>
<tr>
<td>local_max_rate=0</td>
<td>本地用户最大传输速率（字节/秒），0为不限制</td>
</tr>
</tbody></table>
<h3 id="PAM配置"><a href="#PAM配置" class="headerlink" title="PAM配置"></a>PAM配置</h3><p>以下配置是PAM在FTP文件中的配置，写入<code>/etc/vsftpd/vsftpd.conf</code></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>anonymous_enable=NO</td>
<td>禁止匿名开放模式</td>
</tr>
<tr>
<td>local_enable=YES</td>
<td>允许本地用户模式</td>
</tr>
<tr>
<td>guest_enable=YES</td>
<td>开启虚拟用户模式</td>
</tr>
<tr>
<td>guest_username=virtual</td>
<td>指定虚拟用户账户</td>
</tr>
<tr>
<td>pam_service_name=vsftpd.vu</td>
<td>指定 PAM 文件</td>
</tr>
<tr>
<td>allow_writeable_chroot=YES</td>
<td>允许对禁锢的FTP 根目录执行写入操作，而且不拒绝用户的登录请求</td>
</tr>
</tbody></table>
<h3 id="FTP用户禁止登录表"><a href="#FTP用户禁止登录表" class="headerlink" title="FTP用户禁止登录表"></a>FTP用户禁止登录表</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@centos niki]<span class="comment"># cat /etc/vsftpd/user_list</span></span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line">news</span><br><span class="line">uucp</span><br><span class="line">operator</span><br><span class="line">games</span><br><span class="line">nobody</span><br><span class="line"></span><br><span class="line">[root@centos niki]<span class="comment"># cat /etc/vsftpd/ftpusers</span></span><br><span class="line"><span class="comment"># Users that are not allowed to login via ftp</span></span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line">news</span><br><span class="line">uucp</span><br><span class="line">operator</span><br><span class="line">games</span><br><span class="line">nobody</span><br></pre></td></tr></table></figure>

<h3 id="FTP-SElinux"><a href="#FTP-SElinux" class="headerlink" title="FTP-SElinux"></a>FTP-SElinux</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@linuxprobe ~]<span class="comment"># getsebool -a | grep ftp</span></span><br><span class="line">ftp_home_dir --&gt; off</span><br><span class="line">ftpd_anon_write --&gt; off</span><br><span class="line">ftpd_connect_all_unreserved --&gt; off</span><br><span class="line">ftpd_connect_db --&gt; off</span><br><span class="line">ftpd_full_access --&gt; off</span><br><span class="line">ftpd_use_cifs --&gt; off</span><br><span class="line">ftpd_use_fusefs --&gt; off</span><br><span class="line">ftpd_use_nfs --&gt; off</span><br><span class="line">ftpd_use_passive_mode --&gt; off</span><br><span class="line">httpd_can_connect_ftp --&gt; off</span><br><span class="line">httpd_enable_ftp_server --&gt; off</span><br><span class="line">sftpd_anon_write --&gt; off</span><br><span class="line">sftpd_enable_homedirs --&gt; off</span><br><span class="line">sftpd_full_access --&gt; off</span><br><span class="line">sftpd_write_ssh_home --&gt; off</span><br><span class="line">tftp_anon_write --&gt; off</span><br><span class="line">tftp_home_dir --&gt; off</span><br><span class="line">[root@linuxprobe ~]<span class="comment"># setsebool -P ftpd_full_access=on</span></span><br></pre></td></tr></table></figure>









<h2 id="安装FTP服务"><a href="#安装FTP服务" class="headerlink" title="安装FTP服务"></a>安装FTP服务</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install vsftpd</span><br><span class="line"></span><br><span class="line"><span class="comment">#清空Iptables，因为Iptables防火墙管理工具默认禁止FTP传输协议的端口号</span></span><br><span class="line">iptables -F</span><br><span class="line"><span class="comment">#下一步是使用service iptables save保存防火墙规则，但这里没有，我们需要安装iptables-services</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">yum install iptables-services -y</span><br><span class="line">systemctl <span class="built_in">enable</span> iptables</span><br><span class="line">systemctl start iptables</span><br><span class="line">service iptables save</span><br><span class="line"><span class="comment">#安装客户端工具</span></span><br><span class="line">yum -y install ftp</span><br></pre></td></tr></table></figure>



<h2 id="1-匿名登录模式"><a href="#1-匿名登录模式" class="headerlink" title="1. 匿名登录模式"></a>1. 匿名登录模式</h2><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>anonymous_enable=YES</td>
<td>允许匿名访问模式</td>
</tr>
<tr>
<td>anon_umask=022</td>
<td>匿名用户上传文件的umask值</td>
</tr>
<tr>
<td>anon_upload_enable=YES</td>
<td>允许匿名用户上传文件</td>
</tr>
<tr>
<td>anon_mkdir_write_enable=YES</td>
<td>允许匿名用户创建目录</td>
</tr>
<tr>
<td>anon_other_write_enable=YES</td>
<td>允许匿名用户修改目录名称或删除目录</td>
</tr>
</tbody></table>
<p>什么是umask值？</p>
<blockquote>
<pre><code>umask值用于设置用户在创建文件时的默认权限，当我们在系统中创建目录或文件时，目录或文件所具有的默认权限就是由umask值决定的。</code></pre></blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#首先清空文件</span></span><br><span class="line">cat /dev/null &gt; /etc/vsftpd/vsftpd.conf</span><br><span class="line"><span class="comment">#然后写入</span></span><br><span class="line">cat &gt;&gt; /etc/vsftpd/vsftpd.conf &lt;&lt; EOF</span><br><span class="line"><span class="comment">#匿名用户上传文件的umask值</span></span><br><span class="line">anon_umask=022</span><br><span class="line"><span class="comment">#允许匿名用户上传文件</span></span><br><span class="line">anon_upload_enable=YES</span><br><span class="line"><span class="comment">#允许匿名用户创建目录</span></span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line"><span class="comment">#允许匿名用户修改目录名称或者删除目录</span></span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line"><span class="comment">#允许匿名访问</span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#防止干扰</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">setenforce 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启VSftpd服务</span></span><br><span class="line">systemctl restart vsftpd</span><br><span class="line"><span class="comment">#开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br></pre></td></tr></table></figure>


<p><img src="https://i.loli.net/2020/01/16/vmo7U4ni5pchCu8.png" alt="image-20200116102732989.png"></p>
<h2 id="2-本地用户登录"><a href="#2-本地用户登录" class="headerlink" title="2. 本地用户登录"></a>2. 本地用户登录</h2><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>anonymous_enable=NO</td>
<td>禁止匿名访问模式</td>
</tr>
<tr>
<td>local_enable=YES</td>
<td>允许本地用户模式</td>
</tr>
<tr>
<td>write_enable=YES</td>
<td>设置可写权限</td>
</tr>
<tr>
<td>local_umask=022</td>
<td>本地用户模式创建文件的 umask 值</td>
</tr>
<tr>
<td>userlist_enable=YES</td>
<td>启用“禁止用户名单”，名单文件为 ftpusers 和 user_list</td>
</tr>
<tr>
<td>userlist_deny=YES</td>
<td>开启用户作用名单文件功能</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; /etc/vsftpd/vsftpd.conf</span><br><span class="line">cat &gt;&gt; /etc/vsftpd/vsftpd.conf &lt;&lt; EOF</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">pam_service_name=vsftpd <span class="comment">#不加这一句登录就会报530的错</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#防止干扰</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">setenforce 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#本地用户需要使用本地Linux的账号登录，这里创建一个账户并添加用户名和密码</span></span><br><span class="line">useradd niki</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"monian"</span> | passwd --stdin niki</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"This is <span class="variable">$PWD</span>"</span> &gt; /home/niki/tool.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启VSftpd服务</span></span><br><span class="line">systemctl restart vsftpd</span><br><span class="line"><span class="comment">#开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br></pre></td></tr></table></figure>

<p>如果是530登录异常：</p>
<blockquote>
<p><a href="https://blog.csdn.net/wlchn/article/details/50855447" target="_blank" rel="noopener">https://blog.csdn.net/wlchn/article/details/50855447</a></p>
</blockquote>
<p><img src="https://i.loli.net/2020/01/16/UedIJkmQTijoF2N.png" alt="image-20200116110254836.png"></p>
<h2 id="3-虚拟用户登录"><a href="#3-虚拟用户登录" class="headerlink" title="3. 虚拟用户登录"></a>3. 虚拟用户登录</h2><p>虚拟用户登录配置文件关系图：</p>
<ul>
<li>pam_serivice_name：用户认证文件</li>
<li>guest_username：指定虚拟用户账户</li>
<li>user_config_dir：用户配置目录</li>
</ul>
<p><img src="https://i.loli.net/2020/01/16/lmLiP9rdJhBERsA.png" alt="image-20200116130851132.png"></p>
<p>虚拟用户认证即使知道了登录FTP服务器的账号密码，也不会对Linux主机造成破坏，因为虚拟认证的账号密码在Linux服务器内并不存在。正如同这里的<code>dzq --- 123</code> 以及<code>gz --- 456</code> ，在Linux系统中并没有相关的用户。而这些虚拟的用户会统一映射到<code>Virtual</code>这个用户下。</p>
<p>关于FTP服务器使用虚拟用户登录的时候为什么还要再建立一个本地账户的解释：</p>
<blockquote>
<p>由于Linux系统中的每一个文件都有所有者、所属组属性，例如使用虚拟账户“张三”新建了一个文件，但是系统中找不到账户“张三”，就会导致这个文件的权限出现错误。为此，需要再创建一个可以映射到虚拟用户的系统本地用户。简单来说，就是让虚拟用户默认登录到与之有映射关系的这个系统本地用户的家目录中，虚拟用户创建的文件的属性也都归属于这个系统本地用户，从而避免Linux系统无法处理虚拟用户所创建文件的属性权限。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建用户名和密码并Hash，奇数行是用户名，偶数行是密码</span></span><br><span class="line">rm -rf /etc/vsftpd/vuser*</span><br><span class="line">cat &gt;&gt; /etc/vsftpd/vuser.list &lt;&lt; EOF</span><br><span class="line">dzq</span><br><span class="line">123</span><br><span class="line">gz</span><br><span class="line">456</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#将用户信息文件转换为数据库并使用Hash加密</span></span><br><span class="line">db_load -T -t <span class="built_in">hash</span> -f vuser.list vuser.db</span><br><span class="line">chmod 600 vuser.db</span><br><span class="line">rm -f vuser.list</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加用户，指定解释器nologin,使用户无法登录系统</span></span><br><span class="line">useradd -s /sbin/nologin virtual</span><br><span class="line">chmod -Rf 755 /home/virtual</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/pam.d/vsftpd.vu &lt;&lt; EOF</span><br><span class="line">auth       required     pam_userdb.so db=/etc/vsftpd/vuser</span><br><span class="line">account    required     pam_userdb.so db=/etc/vsftpd/vuser</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mkdir /etc/vsftpd/vusers_dir/</span><br><span class="line">touch /etc/vsftpd/vusers_dir/dzq</span><br><span class="line">cat &gt;&gt; /etc/vsftpd/vusers_dir/gz &lt;&lt; EOF</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/vsftpd/vsftpd.conf &lt;&lt; EOF</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">local_enable=YES</span><br><span class="line">guest_enable=YES</span><br><span class="line">guest_username=virtual</span><br><span class="line">allow_writeable_chroot=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">listen=NO</span><br><span class="line">listen_ipv6=YES</span><br><span class="line"><span class="comment">#修改ftp默认配置中的pam认证文件,表示服务器是根据/etc/pam.d/vsftpd.vu进行认证的</span></span><br><span class="line">pam_service_name=vsftpd.vu</span><br><span class="line">userlist_enable=YES</span><br><span class="line">tcp_wrappers=YES</span><br><span class="line"><span class="comment">#该目录下定义了用户的配置，如权限之类</span></span><br><span class="line">user_config_dir=/etc/vsftpd/vusers_dir</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart vsftpd</span><br></pre></td></tr></table></figure>



<p><code>db_load</code>介绍：将用户信息文件转换为数据库并使用Hash加密</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-T</td>
<td>选项-T允许应用程序能够将文本文件转译载入进数据库。由于我们之后是将虚拟用户的信息以文件方式存储在文件里的，为了让Vsftpd这个应用程序能够通过文本来载入用户数据，必须要使用这个选项。如果指定了选项-T，那么一定要追跟子选项-t</td>
</tr>
<tr>
<td>-t</td>
<td>子选项-t，追加在在-T选项后，用来指定转译载入的数据库类型。扩展介绍下，-t可以指定的数据类型有Btree、Hash、Queue和Recon数据库。</td>
</tr>
<tr>
<td>-f</td>
<td>参数后面接包含用户名和密码的文本文件，文件的内容是：奇数行用户名、偶数行密码</td>
</tr>
</tbody></table>
<p>默认登录目录是<code>/home/virtual/</code></p>
<p><img src="https://i.loli.net/2020/01/16/uCkSc3XxmsVzPaJ.png" alt="image-20200116120617812.png"></p>
<h1 id="PAM认证"><a href="#PAM认证" class="headerlink" title="PAM认证"></a>PAM认证</h1><p>原文链接：<a href="https://blog.csdn.net/zhangym199312/article/details/78021998" target="_blank" rel="noopener">https://blog.csdn.net/zhangym199312/article/details/78021998</a></p>
<p>PAM简介</p>
<ol>
<li>Sun公司于1995 年开发的一种与认证相关的通用框架机制</li>
<li>PAM 是关注如何为服务验证用户的API，通过提供一些动态链接库和一套统一的API，将系统提供的服务和该服务的认证方式分，使得系统管理员可以灵活地根据需要给不同的服务配置不同的认证方式而无需更改服务程序，同时，PAM是一种认证框架，自身不做认证</li>
<li>PAM(Pluggable Authentication Modules)即可插拔式认证模块，它是一种高效而且灵活便利的用户级别的认证方式，它也是当前Linux服务器普遍使用的认证方式。当然，在不同版本的Linux统中部署PAM认证是有所不同的。它提供了对所有服务进行认证的中央机制，适用于login，远程登录（telnet,rlogin,fsh,ftp,点对点协议（PPP）），su等应用程序中。系统管理员通过PAM配置文件来制定不同应用程序的不同认证策略；应用程序开发者通过在服务程序中使用PAM API(pam_xxxx( ))来实现对认证方法的调用；而PAM服务模块的开发者则利用PAM SPI来编写模块（主要是引出一些函数pam_sm_xxxx( )供PAM接口库调用），将不同的认证机制加入到系统中；PAM接口库（libpam）则读取配置文件，将应用程序和相应的PAM服务模块联系起来。</li>
</ol>
<p>PAM架构如下图所示：</p>
<p><img src="https://i.loli.net/2020/01/16/8femMGkcR5VPYJw.png" alt="const_pam.png"></p>
<p>认证顺序：</p>
<p>Service（服务）—-&gt;PAM配置文件—–&gt;pam_*.so</p>
<p>首先查看服务，查看服务上是否定义的有pam验证的信息，根据这些验证信息，去读取pam配置文件，之后，pam配置文件里面定义各种规则（我们管理员需要定义的），生效，调用pam_*.so模块。</p>
<p><img src="https://i.loli.net/2020/01/16/i6NFTwgJknRSbuE.png" alt="pam.png"></p>
<hr>
<h1 id="2、Samba服务"><a href="#2、Samba服务" class="headerlink" title="2、Samba服务"></a>2、Samba服务</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>SMB简介：</p>
<p>​    Samba（Server Message Block，服务消息块）是在Linux和Unix系统上实现SMB协议的一个免费软件，提供CIFS(Common Internet File System)协议，由服务器及客户端程序构成，SMB(Server Messages Block,信息服务块)是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。</p>
<p>CIFS简介：</p>
<p>CIFS(Common Internet File System)文件系统也称通用Internet文件系统,它使程序可以访问远程Internet计算机上的文件并要求此计算机的服务。CIFS使用客户/服务器模式。客户程序请求远在服务器上的服务程序为它提供服务，服务器获得请求并返回响应。CIFS是公开的开放的SMB协议版本。SMB协议现在是在局域网上用于服务器文件访问和打印的协议。像SMB协议一样，CIFS在高层运行。可以看做是应用程序协议如文件传输协议和超文本传输协议的一个实现。</p>
<p>CIFS功能：</p>
<ol>
<li>访问服务器本地文件并读写这些文件</li>
<li>与其它用户一起共享一些文件块</li>
<li>在断线时自动恢复与网络的连接</li>
<li>使用统一码文件名</li>
</ol>
<p>CIFS 是 SMB 协议的衍生品，即 CIFS 是 SMB 协议的一种特殊实现，由美国微软公司开发。</p>
<p><img src="https://i.loli.net/2020/01/16/3kGX1PfFbRL6Y97.png" alt="image-20200116154820838.png"></p>
<h2 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Samba功能</span><br><span class="line">  使Linux主机称为window网络中的一份子，与window系统相互分享资源</span><br><span class="line">  让linux主机能使用window共享的文件和打印机</span><br><span class="line">  使Linux主机称为Wins名称服务器，提供NetBIOS名字解析服务器</span><br><span class="line">  提供用户身份验证功能</span><br><span class="line">  支持SSL安全套接层协议</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Samba提供服务</span><br><span class="line">  文件和打印机共享</span><br><span class="line">  用户验证和授权</span><br><span class="line">  名字解析</span><br><span class="line">  浏览（服务通告）</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Samba守护进程</span><br><span class="line">  Smbd： 实现共享和验证授权功能</span><br><span class="line">  Nmbd： 实现名字解析和浏览服务</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Samba的RPM包：</span><br><span class="line">  samba-common: 服务端和客户端所需要的文件</span><br><span class="line">  samba： 服务端软件</span><br><span class="line">  samba&#x3D;winbind： 可选的winbind服务</span><br><span class="line">  samba-client： 客户端软件</span><br><span class="line">  samba-swat： Web配置工具</span><br></pre></td></tr></table></figure>



<p>Samba服务的配置文件在<code>/etc/samba/smb.conf</code>下，其主要的参数和作用如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[global]									 <span class="comment">#全局参数。</span></span><br><span class="line">    workgroup = MYGROUP	 					 <span class="comment">#工作组名称</span></span><br><span class="line">    server string = Samba Server Version %v	 <span class="comment">#服务器介绍信息，参数%v为显示SMB版本号</span></span><br><span class="line">    <span class="built_in">log</span> file = /var/<span class="built_in">log</span>/samba/<span class="built_in">log</span>.%m	 	 <span class="comment">#定义日志文件的存放位置与名称，参数%m为来访的主机名</span></span><br><span class="line">    max <span class="built_in">log</span> size = 50	                	 <span class="comment">#定义日志文件的最大容量为50KB</span></span><br><span class="line"></span><br><span class="line">    security = user							 </span><br><span class="line">    <span class="comment">#安全验证的方式，总共有4种</span></span><br><span class="line">    <span class="comment">#1. share：来访主机无需验证口令；比较方便，但安全性很差</span></span><br><span class="line">    <span class="comment">#2. user：需验证来访主机提供的口令后才可以访问；提升了安全性</span></span><br><span class="line">    <span class="comment">#3. server：使用独立的远程主机验证来访主机提供的口令（集中管理账户）</span></span><br><span class="line">    <span class="comment">#4. domain：使用域控制器进行身份验证</span></span><br><span class="line"></span><br><span class="line">    passdb backend = tdbsam					</span><br><span class="line">    <span class="comment">#定义用户后台的类型，共有3种</span></span><br><span class="line">    <span class="comment">#1. smbpasswd：使用smbpasswd命令为系统用户设置Samba服务程序的密码</span></span><br><span class="line">    <span class="comment">#2. tdbsam：创建数据库文件并使用pdbedit命令建立Samba服务程序的用户</span></span><br><span class="line">    <span class="comment">#3. ldapsam：基于LDAP服务进行账户验证</span></span><br><span class="line">    load printers = yes	</span><br><span class="line"></span><br><span class="line">    load printers = yes						 <span class="comment">#设置在Samba服务启动时是否共享打印机设备</span></span><br><span class="line">    cups options = raw					     <span class="comment">#打印机的选项</span></span><br><span class="line">    </span><br><span class="line">[homes]										 <span class="comment">#共享参数</span></span><br><span class="line">    comment = Home Directories			     <span class="comment">#描述信息</span></span><br><span class="line">    browseable = no							 <span class="comment">#指定共享信息是否在“网上邻居”中可见</span></span><br><span class="line">    writable = yes							 <span class="comment">#定义是否可以执行写入操作，与“read only”相反</span></span><br><span class="line">    </span><br><span class="line">[printers]								 	<span class="comment">#打印机共享参数</span></span><br><span class="line">    comment = All Printers	</span><br><span class="line">    path = /var/spool/samba					 <span class="comment">#共享文件的实际路径(重要)。</span></span><br><span class="line">    browseable = no	</span><br><span class="line">    guest ok = no							 <span class="comment">#是否所有人可见，等同于"public"参数。</span></span><br><span class="line">    writable = no	</span><br><span class="line">    printable = yes	</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">[database]								 				<span class="comment">#共享名称为database</span></span><br><span class="line">comment = Do not arbitrarily modify the database file	<span class="comment">#警告用户不要随意修改数据库</span></span><br><span class="line">path = /home/database									<span class="comment">#共享目录为/home/database</span></span><br><span class="line">public = no												<span class="comment">#关闭“所有人可见”</span></span><br><span class="line">writable = yes											<span class="comment">#允许写入操作</span></span><br></pre></td></tr></table></figure>



<h2 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h2><h3 id="Pdbedit"><a href="#Pdbedit" class="headerlink" title="Pdbedit"></a>Pdbedit</h3><p>Samba服务程序默认使用的是用户口令认证模式（user）。这种认证模式可以确保仅让有密码且受信任的用户访问共享资源，而且验证过程也十分简单。不过，只有建立账户信息数据库之后，才能使用用户口令认证模式。另外，Samba服务程序的数据库要求账户必须在当前系统中已经存在，否则日后创建文件时将导致文件的权限属性混乱不堪，由此引发错误。pdbedit命令用于管理SMB服务程序的账户信息数据库。</p>
<table>
<thead>
<tr>
<th>常用参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>pdbedit -a username</td>
<td>新建Samba账户。</td>
</tr>
<tr>
<td>pdbedit -r username</td>
<td>修改Samba账户。</td>
</tr>
<tr>
<td>pdbedit -x username</td>
<td>删除Samba账户</td>
</tr>
<tr>
<td>pdbedit -L</td>
<td>列出Samba用户列表，读取passdb.tdb数据库文件。</td>
</tr>
</tbody></table>
<p>报错：Failed to add entry for user qwer，是因为没有添加本地账户。</p>
<h3 id="Semanage"><a href="#Semanage" class="headerlink" title="Semanage"></a>Semanage</h3><p>semanage命令 是用来查询与修改SELinux默认目录的安全上下文。</p>
<blockquote>
<p>详情：<a href="https://ipcmen.com/semanage" target="_blank" rel="noopener">https://ipcmen.com/semanage</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>semanage</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>semanage -l</td>
<td>查询</td>
</tr>
<tr>
<td>semanage fcontext</td>
<td>主要用在安全上下文方面</td>
</tr>
<tr>
<td>semanage -a</td>
<td>增加，你可以增加一些目录的默认安全上下文类型设置</td>
</tr>
<tr>
<td>semanage -m</td>
<td>修改</td>
</tr>
<tr>
<td>semanage -d</td>
<td>删除</td>
</tr>
</tbody></table>
<h3 id="SELinux安全上下文"><a href="#SELinux安全上下文" class="headerlink" title="SELinux安全上下文"></a>SELinux安全上下文</h3><blockquote>
<p>详情：<a href="http://c.biancheng.net/view/1151.html" target="_blank" rel="noopener">http://c.biancheng.net/view/1151.html</a></p>
</blockquote>
<p>chcon和restorecon命令，如果一个文件的安全上下文和它默认的不匹配的话，一般情况会导致没有权限访问这个文件，这是Selinux的一种功能。</p>
<p>restorecon：把文件的安全上下文恢复成默认的安全上下文。</p>
<p><code>restorecon [选项】 文件或目录</code></p>
<ul>
<li>-R：递归.当前目录和目录下所有的子文件同时恢复；</li>
<li>-V：把恢复过程显示到屏幕上；</li>
</ul>
<h2 id="Samba配置"><a href="#Samba配置" class="headerlink" title="Samba配置"></a>Samba配置</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install samba</span><br><span class="line"><span class="comment">#添加用户</span></span><br><span class="line">useradd niki</span><br><span class="line"></span><br><span class="line"><span class="comment">#pdbedit是samba的用户管理命令，这里需要手动输入密码</span></span><br><span class="line">pdbedit -a -u niki</span><br><span class="line"><span class="comment">#new password:monian</span></span><br><span class="line"><span class="comment">#retype new password:monian</span></span><br><span class="line"></span><br><span class="line">mkdir /home/database</span><br><span class="line">chown -Rf niki:niki /home/database</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里如果SELINUX关闭的话，下面几行关于安全上下文的命令可以不用敲</span></span><br><span class="line"><span class="comment">#安装semanage</span></span><br><span class="line">yum -y install policycoreutils-python.x86_64</span><br><span class="line"><span class="comment">#增加一条关于samba的安全上下文</span></span><br><span class="line">semanage fcontext -a -t samba_share_t /home/database</span><br><span class="line"></span><br><span class="line"><span class="comment">#将/home/database的安全上下文回复</span></span><br><span class="line">restorecon -Rv /home/database/</span><br><span class="line">restorecon reset /home/database context unconfined_u:object_r:home_root_t:s0-&gt;unconfined_u:object_r:samba_share_t:s0</span><br><span class="line"></span><br><span class="line">&gt;/etc/samba/smb.conf</span><br><span class="line">cat &gt;&gt; /etc/samba/smb.conf &lt;&lt; EOF</span><br><span class="line">[global]</span><br><span class="line">workgroup = MYGROUP</span><br><span class="line">server string = Samba Server Version %v</span><br><span class="line"><span class="built_in">log</span> file = /var/<span class="built_in">log</span>/samba/<span class="built_in">log</span>.%m</span><br><span class="line">max <span class="built_in">log</span> size = 50</span><br><span class="line">security = user</span><br><span class="line">passdb backend = tdbsam</span><br><span class="line">load printers = yes</span><br><span class="line">cups options = raw</span><br><span class="line">[database]</span><br><span class="line">comment = Do not arbitrarily modify the database file</span><br><span class="line">path = /home/database</span><br><span class="line">public = no</span><br><span class="line">writable = yes</span><br><span class="line">EOF </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">systemctl restart smb</span><br><span class="line">systemctl <span class="built_in">enable</span> smb</span><br></pre></td></tr></table></figure>

<h2 id="挂载Samba"><a href="#挂载Samba" class="headerlink" title="挂载Samba"></a>挂载Samba</h2><p><strong>Windows</strong></p>
<p><img src="https://i.loli.net/2020/01/16/dVE7SRKFUiL8n9h.png" alt="image-20200116150510791.png"></p>
<p>需要进行登录，登录用户名为<code>niki</code>，密码为<code>monian</code> </p>
<p><img src="https://i.loli.net/2020/01/16/BK8oXD4wPZzci2S.png" alt="image-20200116150535133.png"></p>
<p><strong>Linux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install cifs-utils</span><br><span class="line">mkdir /database</span><br><span class="line">cat &gt;&gt; /root/auth.smb &lt;&lt; EOF</span><br><span class="line">username=niki</span><br><span class="line">password=monian</span><br><span class="line">domain=MYGROUP</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt;&gt;  /etc/fstab &lt;&lt; EOF</span><br><span class="line">//192.168.10.10/database /database cifs credentials=/root/auth.smb 0 0</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="3、NFS服务"><a href="#3、NFS服务" class="headerlink" title="3、NFS服务"></a>3、NFS服务</h1><h2 id="配置文件参数"><a href="#配置文件参数" class="headerlink" title="配置文件参数"></a>配置文件参数</h2><p>NFS的配置文件在<code>/etc/exports</code>中，其基本格式为：<code>/挂在文件目录  允许访问的IP地址(权限相关)</code></p>
<p>注意NFS客户端地址与权限之间没有空格。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>ro</td>
<td>只读</td>
</tr>
<tr>
<td>rw</td>
<td>读写</td>
</tr>
<tr>
<td>root_squash</td>
<td>当NFS客户端以root管理员访问时，映射为NFS服务器的匿名用户</td>
</tr>
<tr>
<td>no_root_squash</td>
<td>当NFS客户端以root管理员访问时，映射为NFS服务器的root管理员</td>
</tr>
<tr>
<td>all_squash</td>
<td>无论NFS客户端使用什么账户访问，均映射为NFS服务器的匿名用户</td>
</tr>
<tr>
<td>sync</td>
<td>同时将数据写入到内存与硬盘中，保证不丢失数据</td>
</tr>
<tr>
<td>async</td>
<td>优先将数据保存到内存，然后再写入硬盘；这样效率更高，但可能会丢失数据</td>
</tr>
</tbody></table>
<p>​    </p>
<h2 id="NFS相关包"><a href="#NFS相关包" class="headerlink" title="NFS相关包"></a>NFS相关包</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nfs-utils:NFS主要组件，包含rpc、nfsd、和rpc.mountd这两个守护进程</span><br><span class="line">nfsbind：提供rpc端口映射的守护进程</span><br><span class="line">exportfs：在NFS服务器，维护nfs共享资源的命令</span><br><span class="line">showmount：用来查看nfs客户端的资源共享目录</span><br><span class="line">nfsstat：显示nfs状态信息</span><br><span class="line">rpcinfo：显示由rpc</span><br><span class="line">启动服务 systemctl start rpcbind &amp;&amp; systemctl start nfs-server</span><br><span class="line">软件包：nfs-utils</span><br><span class="line">服务类型：由systemd启动的守护进程</span><br><span class="line">配置单元： /usr/lib/systemd/system/nfs.service</span><br><span class="line">守护进程：rpc .nfsd rpc.mountd  </span><br><span class="line">端口号：2049 nfsd 111 rpcbind 20048 mountd</span><br><span class="line">服务端配置：/etc/exports</span><br><span class="line">相关软件包： rpcbind</span><br></pre></td></tr></table></figure>



<h2 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install nfs-utils</span><br><span class="line">mkdir /nfs</span><br><span class="line">chmod -Rf 777 /nfs/</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"This is NFS"</span> &gt; /nfs/nfs.txt</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/exports &lt;&lt; EOF</span><br><span class="line">/nfs *(rw,sync,no_root_squash)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart rpcbind</span><br><span class="line">systemctl restart nfs-server.service</span><br></pre></td></tr></table></figure>



<p>如果windows下连接报网络错误53的话，可能是以下情况：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">NFS服务器有一个”在非安全模式工作（允许更高的端口号）“的选项。Windows NFS客户端经常使用的是大的端口号。你可以在你的共享项设置中开启这个选项</span><br><span class="line"></span><br><span class="line">例如：/share *(insecure,rw)</span><br></pre></td></tr></table></figure>







<h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><p><strong>Windows</strong></p>
<p><code>控制面板 ---- 程序 ---- 程序和功能：</code></p>
<p><img src="https://i.loli.net/2020/01/16/g4MqucSACR2Edhf.png" alt="image-20200116165524286.png"></p>
<p><code>win+r --- cmd --- 挂在</code> </p>
<p><img src="https://i.loli.net/2020/01/16/EC28VrINduUAFBo.png" alt="image-20200116165505217.png"></p>
<p><code>文件管理器</code></p>
<p><img src="https://i.loli.net/2020/01/16/b7J6pfN4okO9IZ8.png" alt="image-20200116165607503.png"></p>
<p><strong>Linux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@linuxprobe ~]<span class="comment"># showmount -e 192.168.10.10</span></span><br><span class="line">Export list <span class="keyword">for</span> 192.168.10.10:</span><br><span class="line">/nfsfile 192.168.10.*</span><br><span class="line"></span><br><span class="line">[root@linuxprobe ~]<span class="comment"># mkdir /nfsfile</span></span><br><span class="line">[root@linuxprobe ~]<span class="comment"># mount -t nfs 192.168.10.10:/nfsfile /nfsfile</span></span><br><span class="line"><span class="comment">#想要长期挂在，可以编辑/etc/fstab文件</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>showmount参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-e</td>
<td>显示NFS服务器的共享列表</td>
</tr>
<tr>
<td>-a</td>
<td>显示本机挂载的文件资源的情况NFS资源的情况</td>
</tr>
</tbody></table>
<p>​    </p>
<h1 id="自动挂载"><a href="#自动挂载" class="headerlink" title="自动挂载"></a>自动挂载</h1><p>​    与mount命令不同，autofs服务程序是一种Linux系统守护进程，当检测到用户试图访问一个尚未挂载的文件系统时，将自动挂载该文件系统。换句话说，我们将挂载信息填入/etc/fstab文件后，系统在每次开机时都自动将其挂载，而autofs服务程序则是在用户需要使用该文件系统时才去动态挂载，从而节约了网络资源和服务器的硬件资源。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install nfs-utils</span><br><span class="line">yum -y install autofs</span><br><span class="line">showmount -e 192.168.19.132</span><br><span class="line">mkdir /mynfs</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置文件格式：【挂载目录】 【子配置文件】</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/mynfs  /etc/nfs.misc"</span> &gt;&gt; /etc/auto.master</span><br><span class="line"></span><br><span class="line"><span class="comment">#子配置文件格式：【挂载目录】 【挂载文件类型及权限】:【设备名称】</span></span><br><span class="line"><span class="comment">#比如：iso  -fstype=iso9660,ro,nosuid,nodev :/dev/cdrom</span></span><br><span class="line"><span class="comment">#权限详情参见挂载时文件权限</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"name1  -fstype=nfs 192.168.19.132:/nfs"</span> &gt;&gt; /etc/nfs.misc</span><br><span class="line">systemctl restart autofs</span><br><span class="line"><span class="built_in">cd</span> /mynfs/name1/</span><br></pre></td></tr></table></figure>



<h1 id="备份百度云"><a href="#备份百度云" class="headerlink" title="备份百度云"></a>备份百度云</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#自动备份百度云文件</span></span><br><span class="line"><span class="comment">#2020/4/16 Python2.7</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 安装依赖 </span></span><br><span class="line"><span class="comment"># pip install requests</span></span><br><span class="line"><span class="comment"># pip install bypy</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># [root@localhost ~]# bypy info</span></span><br><span class="line"><span class="comment"># Please visit:   # 访问下边这个连接，复制授权码</span></span><br><span class="line"><span class="comment"># https://openapi.baidu.com/oauth/2.0/authorize?scope=basic+netdisk&amp;redirect_uri=oob&amp;response_type=code&amp;client_id=q8WE4EpCsau1oS0MplgMKNBn</span></span><br><span class="line"><span class="comment"># And authorize this app</span></span><br><span class="line"><span class="comment"># Paste the Authorization Code here within 10 minutes.</span></span><br><span class="line"><span class="comment"># Press [Enter] when you are done    # 提示在下边粘贴授权码</span></span><br><span class="line"><span class="comment"># a288f3d775fa905a6911692a0808f6a8</span></span><br><span class="line"><span class="comment"># Authorizing, please be patient, it may take upto None seconds...</span></span><br><span class="line"><span class="comment"># Authorizing/refreshing with the OpenShift server ...</span></span><br><span class="line"><span class="comment"># OpenShift server failed, authorizing/refreshing with the Heroku server ...</span></span><br><span class="line"><span class="comment"># Successfully authorized</span></span><br><span class="line"><span class="comment"># Quota: 2.015TB</span></span><br><span class="line"><span class="comment"># Used: 740.493GB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于百度PCS API权限限制，程序只能存取百度云端/apps/bypy目录下面的文件和目录。我们可以通过：</span></span><br><span class="line"><span class="comment"># [root@localhost ~]# bypy list</span></span><br><span class="line"><span class="comment"># /apps/bypy ($t $f $s $m $d):</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 把本地当前目录下的文件同步到百度云盘：</span></span><br><span class="line"><span class="comment"># bypy upload</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 把云盘上的内容同步到本地:</span></span><br><span class="line"><span class="comment"># bypy downdir</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 比较本地当前目录和云盘根目录，看是否一致，来判断是否同步成功：</span></span><br><span class="line"><span class="comment"># bypy compare</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># /BaiDuDS 就是我们备份百度云的本地目录</span></span><br><span class="line"><span class="comment"># 创建一个文件，用于存放上一次测量的Baiduyun备份大小。如果这次测量后大小相同，说明没有上传文件，不需要备份</span></span><br><span class="line">touch /tmp/size</span><br><span class="line">size_now=`du -sh /BaiDuDS | awk -F <span class="string">' '</span> <span class="string">'&#123;print $1&#125;'</span>`</span><br><span class="line">size_before=`cat /tmp/size`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$size_now</span>"</span> = <span class="string">"<span class="variable">$size_before</span>"</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"File Hasn't Changed"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"File Has Changed , Update /tmp/size.."</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$size_now</span>"</span> &gt; /tmp/size</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"BackUp to BaiduDuYun"</span></span><br><span class="line">    <span class="comment"># 同步文件夹到远端</span></span><br><span class="line">    bypy downdir</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>


    </div>
    <p class="post-meta">
        <span class="post-cat">分类：
            <a class="cat-link" href="../../../../categories/Linux/">Linux</a>
        </span>
        <span class="post-tags">
            标签：
            
        </span>
    </p>
</article>
<!-- 分享按钮 -->

  <div class="article-share clearfix text-center">
    <div class="share-area">
      <span class="share-txt">分享到：</span>
      <a href="javascript: window.open('http://service.weibo.com/share/share.php?url=' + encodeURIComponent(location.href) + '&title=' + document.title + '&language=zh_cn');" class="share-icon weibo"></a>
      <a href="javascript: alert('请复制链接到微信并发送');" class="share-icon wechat"></a>
      <a href="javascript: window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=' + encodeURIComponent(location.href) + '&title=' + document.title);" class="share-icon qqzone"></a>
      <a href="javascript: window.open('http://connect.qq.com/widget/shareqq/index.html?url=' + encodeURIComponent(location.href) + '&desc=Jelon个人博客&title=' + document.title + '&callback=' + encodeURIComponent(location.href));" class="share-icon qq"></a>
      <a href="javascript: window.open('http://shuo.douban.com/!service/share?href=' + encodeURIComponent(location.href) + '&name=' + document.title + '&text=' + document.title);" class="share-icon douban"></a>
    </div>
  </div>


<!-- 上一篇/下一篇 -->

<div class="article-nav clearfix">
    
    <span class="prev fl">
        上一篇<br >
        <a href="../../17/Linux%E6%9D%83%E9%99%90/">
            
                Linux权限
            
        </a>
    </span>
    

    
    <span class="next fr">
        下一篇<br >
        <a href="../../../../2019/12/25/Linux%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%82%A8/">
            
                Linux系统存储
            
        </a>
    </span>
    
</div>

<!-- 文章评论 -->

  
<script src="../../../../js/comment.js"></script>

  <div id="comments" class="comment">
    <!--
    <div class="sign-bar">
      GitHub 已登录!
      <span class="sign-link">登出</span>
    </div>
    <section class="box">
      <div class="com-avatar"><img src="/img/jelon.jpg" alt="avatar"></div>
      <div class="com-text">
        <div class="main">
          <textarea class="text-area-edited show" placeholder="欢迎评论！"></textarea>
          <div class="text-area-preview"></div>
        </div>
        <div class="switch">
          <div class="switch-item on">编辑</div>
          <div class="switch-item">预览</div>
        </div>
        <div class="button">提交</div>
      </div>
    </section>
    <section class="tips">注：评论支持 markdown 语法！</section>
    <section class="list-wrap">
      <ul class="list">
        <li>
          <div class="user-avatar">
            <a href="/">
              <img src="/img/jelon.jpg" alt="user-avatar">
            </a>
          </div>
          <div class="user-comment">
            <div class="user-comment-header">
              <span class="post-name">张德龙</span>
              <span class="post-time">2017年12月12日</span>
              <span class="like liked">已赞</span>
              <span class="like-num">2</span>
            </div>
            <div class="user-comment-body">333333</div>
          </div>
        </li>
        <li>
          <div class="user-avatar">
            <a href="/">
              <img src="/img/jelon.jpg" alt="user-avatar">
            </a>
          </div>
          <div class="user-comment">
            <div class="user-comment-header">
              <span class="post-name">刘德华</span>
              <span class="post-time">2017年12月12日</span>
              <span class="like">点赞</span>
              <span class="like-num">2</span>
            </div>
            <div class="user-comment-body">vvvvv</div>
          </div>
        </li>
      </ul>
      <div class="page-nav">
        <a href="javascript: void(0);" class="item">1</a>
        <a href="javascript: void(0);" class="item">2</a>
        <a href="javascript: void(0);" class="item current">3</a>
      </div>
    </section>
    -->
  </div>
  <script>
  JELON.Comment({
    container: 'comments',
    label: 'Linux网络存储' || '2020/01/16/Linux网络存储/',
    owner: 'jangdelong',
    repo: 'blog_comments',
    clientId: 'b08ed25e52c57993e69c',
    clientSecret: '1cb9545488f0380904b87350e7c5a270ae03bab7'
  });
  </script>


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    
    <section class="widget">
        <h3 class="widget-hd"><strong>文章搜索</strong></h3>
        <div class="search-form">
  <form
    id="searchForm"
    method="GET"
    action="https://www.baidu.com/s"
    ectype="application/x-www-form-urlencoded"
    target="_blank"
    autocomplete="false"
    onsubmit="javascript: return false;">
    <input
      id="searchKeyword"
      type="text"
      class="form-control"
      placeholder="输入关键字搜索"
      autocomplete="false"
    />
    <input id="searchKeywordHidden" type="hidden" name="wd" />
    <input id="searchButton" class="btn" type="submit" value="搜索" />
  </form>
</div>
    </section>
    

    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="../../../../categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="../../../../categories/%E7%BC%96%E7%A8%8B/">编程</a>
        <span class="badge">(7)</span>
    </li>
    
    <li>
        <a href="../../../../categories/%E5%AE%B9%E5%99%A8/">容器</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="../../../../categories/Linux/">Linux</a>
        <span class="badge">(7)</span>
    </li>
    
    <li>
        <a href="../../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
        <span class="badge">(2)</span>
    </li>
    
    <li>
        <a href="../../../../categories/%E8%B7%AF%E7%94%B1%E6%8A%80%E6%9C%AF/">路由技术</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="../../../../categories/%E6%95%85%E9%9A%9C/">故障</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="../../../../categories/%E8%BF%90%E7%BB%B4/">运维</a>
        <span class="badge">(1)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="../../../../tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" title="快捷键">快捷键 (6)</a>
  
    <a class="tag-item" href="../../../../tags/%E9%9A%8F%E7%AC%94/" title="随笔">随笔 (1)</a>
  
    <a class="tag-item" href="../../../../tags/%E6%91%98%E5%BD%95/" title="摘录">摘录 (1)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="https://github.com/front-end-pigs/blog" target="_blank" title="Github博客">Github博客</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2020
    

    <a href="../../../../index.html">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->

<script src="../../../../js/main.js?v=1593078002726.js"></script>

</body>
</html>