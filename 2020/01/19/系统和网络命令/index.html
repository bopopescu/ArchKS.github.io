<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>系统和网络命令</title><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=Edge，chrome=1"><meta name="description"><meta name="keywords"><meta name="author" content="ZEN"><link rel="short icon" href="../../../../images/favicon.png"><link rel="icon" href="../../../../images/favicon.png"><!--[if lt IE 9]>
<script src="../../../../js/modernizr.js"></script>
<![endif]-->
<link rel="stylesheet" href="../../../../css/iconfont.css">

<link rel="stylesheet" href="../../../../css/index.css?v=202006180934.css">
<link rel="stylesheet" href="../../../../css/info.css?v=202006180934.css">
<link href="https://cdn.bootcss.com/highlight.js/9.15.9/styles/github.min.css" rel="stylesheet"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="atom.xml" title="zen's blog" type="application/atom+xml">
</head><body><header id="header" class="header-navigation"><nav><div class="logo"><a href="http://ymlog.cn">zen's blog</a></div><h2 id="mnavh"><span class="navicon"></span></h2><ul id="starlist"><li><a href="../../../../index.html">首页</a></li><li><a href="../../../../time.html">时间轴</a></li></ul><div class="searchbox"><div id="search_bar" class="search_bar"><input id="keyboard" placeholder="想搜点什么呢.." type="text" name="keyboard" autocomplete="off" class="input"><p class="search_ico"><span></span></p></div></div></nav></header><article><main><div class="con_warp"><div class="infosbox"><div class="newsview"><h3 class="news_title">系统和网络命令</h3><div class="bloginfo"><ul><li class="author">作者：<a href="/">ZEN</a></li><li class="lmname"><a href="/">Linux</a></li><li class="timer">时间：2020-01-19 21:53:54</li><li class="view"><span id="busuanzi_value_page_pv">99</span><span>次访问</span></li></ul></div><div class="tags"></div><div class="news_con"><h1 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h1><p>本章简单介绍一些Linux系统常用到的命令，包括修改系统相关设置（比如用户名、时间日期等），监视系统活动、Linux系统包管理以及环境变量等。</p>
<h3 id="top：监视进程活动"><a href="#top：监视进程活动" class="headerlink" title="top：监视进程活动"></a>top：监视进程活动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一行</span></span><br><span class="line">top - 18:50:07 up 98 days,  2:34,  1 user,  load average: 0.07, 0.03, 0.05</span><br><span class="line">     【系统时间】     【运行时间】 【登录终端数】  【系统负载】【1m，5m，15m的平均值，数值越小负载越低】</span><br><span class="line"></span><br><span class="line"><span class="comment">#Load Average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二行     </span></span><br><span class="line">Tasks: 108 total,   1 running, 105 sleeping,   0 stopped,   2 zombie</span><br><span class="line">【进程总数】		【运行中的进程数】 【睡眠中的进程数】 【停止的进程数】 【僵尸进程】</span><br><span class="line"></span><br><span class="line"><span class="comment">#第三行</span></span><br><span class="line">%Cpu(s): </span><br><span class="line">1.0 us, 【用户占用CPU百分比】 </span><br><span class="line">1.0 sy, 【系统内核占用CPU百分比】</span><br><span class="line">0.0 ni, 【改变过优先级进程占用CPU百分比】</span><br><span class="line">98.0 id,  【空闲CPU百分比】</span><br><span class="line">0.0 wa, 【IO等待占用CPU的百分比】</span><br><span class="line">0.0 hi, 【硬中断（Hardware IRQ）占用CPU的百分比】</span><br><span class="line">0.0 si, 【软中断（Software Interrupts）占用CPU的百分比】</span><br><span class="line">0.0 st</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#第四行</span></span><br><span class="line">KiB Mem : </span><br><span class="line">1882084 total,  【物理内存总量（2G）】</span><br><span class="line">88084 free, 【内存空闲量】</span><br><span class="line">867740 used, 【内存使用量】</span><br><span class="line">926260 buff/cache 【缓存的内存量】</span><br><span class="line">【物理内存总量】   </span><br><span class="line"></span><br><span class="line"><span class="comment">#第五行</span></span><br><span class="line">KiB Swap:      </span><br><span class="line">0 total,  【交换区总量】</span><br><span class="line">0 free,   【空闲交换区总量】</span><br><span class="line">0 used.  【使用的交换区总量】</span><br></pre></td></tr></table></figure>

<p>对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。</p>
<p>1、 添加top的任务监控</p>
<p><img src="https://i.loli.net/2020/01/19/W1pubwmo4k6c7JK.png" alt="image-20200119192639730.png"></p>
<ul>
<li>PID ： 进程id</li>
<li>USER ： 进程所有者</li>
<li>PR ： 进程优先级</li>
<li>NI ： nice值。负值表示高优先级，正值表示低优先级</li>
<li>VIRT ： 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES</li>
<li>RES ： 常驻内存，进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA</li>
<li>SHR ： 共享内存大小，单位kb</li>
<li>S ： 进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程</li>
<li>%CPU ： 上次更新到现在的CPU时间占用百分比</li>
<li>%MEM ： 进程使用的物理内存百分比</li>
<li>TIME+ ： 进程使用的CPU时间总计，单位1/100秒</li>
<li>COMMAND ： 进程名称（命令名/命令行）</li>
</ul>
<p>默认情况下仅显示比较重要的 PID、USER、PR、NI、VIRT、RES、SHR、S、%CPU、%MEM、TIME+、COMMAND 列。可以通过下面的快捷键来更改显示内容。</p>
<p>通过 f 键可以选择显示的内容。按 f 键之后会显示列的列表，按空格键可以选中或者取消。</p>
<p>在top基本视图中，按键盘数字“1”，可监控每个逻辑CPU的状况：</p>
<p>2、top 运行中的命令</p>
<ul>
<li><p>s – 改变画面更新频率</p>
</li>
<li><p>l – 关闭或开启第一部分第一行 top 信息的表示</p>
</li>
<li><p>t – 关闭或开启第一部分第二行 Tasks 和第三行 Cpus 信息的表示</p>
</li>
<li><p>m – 关闭或开启第一部分第四行 Mem 和 第五行 Swap 信息的表示</p>
</li>
<li><p>N – 以 PID 的大小的顺序排列表示进程列表</p>
</li>
<li><p>P – 以 CPU 占用率大小的顺序排列进程列表</p>
</li>
<li><p>M – 以内存占用率大小的顺序排列进程列表</p>
</li>
<li><p>h – 显示帮助</p>
</li>
<li><p>n – 设置在进程列表所显示进程的数量</p>
</li>
<li><p>q – 退出 top</p>
</li>
<li><p>K：终止一个进程。系统将提示用户输入需要终止的进程PID，以及需要发送给该进程什么样的信号。一般的终止进程可以使用15信号；如果不能正常结束那就使用信号9强制结束该进程。默认值是信号15。在安全模式中此命令被屏蔽。</p>
</li>
<li><p>i：忽略闲置和僵死进程。这是一个开关式命令。</p>
</li>
<li><p>q：退出程序</p>
</li>
<li><p>r：重新安排一个进程的优先级别。系统提示用户输入需要改变的进程PID以及需要设置的进程优先级值。输入一个正值将使优先级降低，反之则可以使该进程拥有更高的优先权。默认值是10。</p>
</li>
<li><p>S：切换到累计模式。</p>
</li>
<li><p>s：改变两次刷新之间的延迟时间。系统将提示用户输入新的时间，单位为s。如果有小数，就换算成m s。输入0值则系统将不断刷新，默认值是5 s。需要注意的是如果设置太小的时间，很可能会引起不断刷新，从而根本来不及看清显示的情况，而且系统负载也会大大增加。</p>
</li>
<li><p>f或者F：从当前显示中添加或者删除项目。</p>
</li>
<li><p>o或者O：改变显示项目的顺序</p>
</li>
<li><p>l：切换显示平均负载和启动时间信息。</p>
</li>
<li><p>m:切换显示内存信息。</p>
</li>
<li><p>t:切换显示进程和CPU状态信息。</p>
</li>
<li><p>c:切换显示命令名称和完整命令行。</p>
</li>
<li><p>M:根据驻留内存大小进行排序。</p>
</li>
<li><p>P:根据CPU使用百分比大小进行排序。</p>
</li>
<li><p>T:根据时间/累计时间进行排序。</p>
</li>
<li><p>W:将当前设置写入~/.toprc文件中。</p>
</li>
</ul>
<p>3、命令行的top参数</p>
<p>使用格式：</p>
<p><code>top [-] [d] [p] [q] [c] [C] [S] [s] [n]</code></p>
<p>参数说明：</p>
<ul>
<li><p>d：指定每两次屏幕信息刷新之间的时间间隔。当然用户可以使用s交互命令来改变之。<code>top d 2</code></p>
</li>
<li><p>p:通过指定监控进程ID来仅仅监控某个进程的状态。<code>top p 1</code></p>
</li>
<li><p>S：指定累计模式。</p>
</li>
<li><p>s：使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险。</p>
</li>
<li><p>i：使top不显示任何闲置或者僵死进程。</p>
</li>
<li><p>c:显示整个命令行而不只是显示命令名。</p>
</li>
</ul>
<h3 id="pidof：查询pid"><a href="#pidof：查询pid" class="headerlink" title="pidof：查询pid"></a>pidof：查询pid</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pidof python3</span><br></pre></td></tr></table></figure>



<h3 id="kill：终止进程"><a href="#kill：终止进程" class="headerlink" title="kill：终止进程"></a>kill：终止进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> 1900</span><br></pre></td></tr></table></figure>



<h3 id="ps：查看进程"><a href="#ps：查看进程" class="headerlink" title="ps：查看进程"></a>ps：查看进程</h3><p>ps工具标识进程的5种状态码:</p>
<ul>
<li>D 不可中断 uninterruptible sleep (usually IO)</li>
<li>R 运行 runnable (on run queue)</li>
<li>S 中断 sleeping</li>
<li>T 停止 traced or stopped</li>
<li>Z 僵死 a defunct (”zombie”) process</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>显示所有进程</td>
</tr>
<tr>
<td>A</td>
<td>显示所有进程</td>
</tr>
<tr>
<td>N</td>
<td>反向选择</td>
</tr>
<tr>
<td>f</td>
<td>显示程序间的关系</td>
</tr>
<tr>
<td>u</td>
<td>指定用户的所有进程</td>
</tr>
<tr>
<td>au</td>
<td>显示较详细的资讯</td>
</tr>
<tr>
<td>aux</td>
<td>显示所有包含其他使用者的行程</td>
</tr>
</tbody></table>
<h3 id="free：查看内存信息"><a href="#free：查看内存信息" class="headerlink" title="free：查看内存信息"></a>free：查看内存信息</h3><table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-h</td>
<td>show human-readable output</td>
</tr>
<tr>
<td>-l</td>
<td>show detialed low and high memory statistics</td>
</tr>
<tr>
<td>-t</td>
<td>show total for RAM+swap</td>
</tr>
<tr>
<td>-s N</td>
<td>repeat print every N seconds</td>
</tr>
<tr>
<td>-c N</td>
<td>repeat print N times,then exit</td>
</tr>
</tbody></table>
<h3 id="uname：查看内核"><a href="#uname：查看内核" class="headerlink" title="uname：查看内核"></a>uname：查看内核</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查看系统内核和版本信息</span><br><span class="line">uname</span><br><span class="line">&gt;&gt;&gt;Linux niki 3.10.0-957.21.2.el7.x86_64 #1 SMP Wed Jun 5 14:26:44 UTC 2019 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br><span class="line"></span><br><span class="line">uname -r </span><br><span class="line">&gt;&gt;&gt;3.10.0-957.21.2.el7.x86_64</span><br><span class="line"></span><br><span class="line">查看当前系统版本的详细信息</span><br><span class="line">cat &#x2F;etc&#x2F;redhat-release</span><br><span class="line">&gt;&gt;&gt;CentOS Linux release 7.6.1810 (Core)</span><br></pre></td></tr></table></figure>





<h3 id="timedatectl：设置时区"><a href="#timedatectl：设置时区" class="headerlink" title="timedatectl：设置时区"></a>timedatectl：设置时区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone Asia&#x2F;Shanghai</span><br></pre></td></tr></table></figure>



<h3 id="hostnamectl：设置主机名"><a href="#hostnamectl：设置主机名" class="headerlink" title="hostnamectl：设置主机名"></a>hostnamectl：设置主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl <span class="built_in">set</span>-hostname niki <span class="comment">#更改主机名</span></span><br></pre></td></tr></table></figure>



<h3 id="date：查看时间"><a href="#date：查看时间" class="headerlink" title="date：查看时间"></a>date：查看时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date -R</span><br><span class="line">date <span class="string">"+%Y-%m-%d %H:%M:%S"</span>  <span class="comment"># +号容易遗忘</span></span><br></pre></td></tr></table></figure>



<h3 id="who：查看当前用户"><a href="#who：查看当前用户" class="headerlink" title="who：查看当前用户"></a>who：查看当前用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前登入主机的用户终端信息</span></span><br><span class="line">who</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">root     pts/0        2019-08-05 09:05 (49.70.158.195)</span><br><span class="line">root     pts/1        2019-08-05 09:17 (49.70.158.195)</span><br></pre></td></tr></table></figure>



<h3 id="type：查看命令格式"><a href="#type：查看命令格式" class="headerlink" title="type：查看命令格式"></a>type：查看命令格式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> <span class="built_in">cd</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">cd</span> is a shell <span class="built_in">builtin</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> python3</span><br><span class="line">&gt;&gt;&gt;python3 is /usr/<span class="built_in">local</span>/bin/python3</span><br></pre></td></tr></table></figure>



<h3 id="tar：压缩或解压"><a href="#tar：压缩或解压" class="headerlink" title="tar：压缩或解压"></a>tar：压缩或解压</h3><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-c</td>
<td>压缩文件 compress</td>
</tr>
<tr>
<td>-x</td>
<td>解压文件</td>
</tr>
<tr>
<td>-z</td>
<td>用 Gzip 压缩或解压</td>
</tr>
<tr>
<td>-j</td>
<td>用 bzip2 压缩或解压</td>
</tr>
<tr>
<td>-v</td>
<td>显示压缩或解压的过程</td>
</tr>
<tr>
<td>-f</td>
<td>目标文件名</td>
</tr>
<tr>
<td>-p</td>
<td>保留原始的权限与属性</td>
</tr>
<tr>
<td>-P</td>
<td>使用绝对路径来压缩</td>
</tr>
<tr>
<td>-C</td>
<td>指定解压到的目录</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#压缩和解压GZip文件</span></span><br><span class="line"><span class="comment">#将图片全部压缩</span></span><br><span class="line">tar -czf test.tar.gz *.jpg</span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">tar -xzf test.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#压缩和解压br2文件</span></span><br><span class="line"><span class="comment">#压缩</span></span><br><span class="line">tar -jc test.tar.br2 *.jpg</span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">tar -xf test.tar.br2</span><br></pre></td></tr></table></figure>



<h3 id="Screen：记录面板"><a href="#Screen：记录面板" class="headerlink" title="Screen：记录面板"></a>Screen：记录面板</h3><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-S</td>
<td>创建会话窗口；</td>
</tr>
<tr>
<td>-d</td>
<td>将指定会话进行离线处理；</td>
</tr>
<tr>
<td>-r</td>
<td>恢复指定会话；</td>
</tr>
<tr>
<td>-x</td>
<td>一次性恢复所有的会话；</td>
</tr>
<tr>
<td>-ls</td>
<td>显示当前已有的会话；</td>
</tr>
<tr>
<td>-wipe</td>
<td>把目前无法使用的会话删除</td>
</tr>
</tbody></table>
<p>直接用screen跟命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># screen ping baidu.com</span></span><br><span class="line">[root@localhost ~]<span class="comment"># screen -r</span></span><br><span class="line"></span><br><span class="line">64 bytes from 220.181.38.148 (220.181.38.148): icmp_seq=8 ttl=128 time=39.0 ms</span><br><span class="line">64 bytes from 220.181.38.148 (220.181.38.148): icmp_seq=9 ttl=128 time=40.1 ms</span><br><span class="line">64 bytes from 220.181.38.148 (220.181.38.148): icmp_seq=10 ttl=128 time=37.9 ms</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>建立/恢复指定的会话</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建</span></span><br><span class="line">[root@localhost ~]<span class="comment"># screen -S DDD</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ping baidu.com </span></span><br><span class="line">PING baidu.com (39.156.69.79) 56(84) bytes of data.</span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=1 ttl=128 time=34.5 ms</span><br><span class="line">---------------</span><br><span class="line"><span class="comment">#恢复</span></span><br><span class="line">[root@localhost ~]<span class="comment"># screen -r  </span></span><br><span class="line">64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=30 ttl=128 time=31.2 ms</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@localhost ~]<span class="comment"># screen -ls</span></span><br><span class="line">There is a screen on:</span><br><span class="line">        21207.DDD       (Attached)</span><br><span class="line">1 Socket <span class="keyword">in</span> /var/run/screen/S-root.</span><br><span class="line"></span><br><span class="line"><span class="comment">#退出</span></span><br><span class="line">[root@localhost ~]<span class="comment"># exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#亦或者：</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rm /var/run/screen/S-root/21024.DZq </span></span><br><span class="line">rm: remove socket ‘/var/run/screen/S-root/21024.DZq’? y</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@localhost ~]<span class="comment"># screen -ls</span></span><br><span class="line">No Sockets found <span class="keyword">in</span> /var/run/screen/S-root.</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/01/19/IW65XRyK9maVqQ1.png" alt="image-20200119203937119.png"></p>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看系统中的环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/home</span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin:/home/</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Linux 作为一个多用户多任务的操作系统，能够为每个用户提供独立的、合适的工作运行</span><br><span class="line">环境，因此，一个相同的变量会因为用户身份的不同而具有不同的值。例如，我们使用下述命</span><br><span class="line">令来查看 HOME 变量在不同用户身份下都有哪些值</span><br><span class="line"></span><br><span class="line">[root@node ~]<span class="comment"># useradd NIKIDZQ</span></span><br><span class="line">[root@node ~]<span class="comment"># su - NIKIDZQ</span></span><br><span class="line">[NIKIDZQ@node ~]$ <span class="built_in">echo</span> <span class="string">"<span class="variable">$HOME</span>"</span></span><br><span class="line">/home/NIKIDZQ</span><br><span class="line">[root@node ~]<span class="comment"># echo "$HOME"</span></span><br><span class="line">/root</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">其实变量是由固定的变量名与用户或系统设置的变量值两部分组成的，我们完全可以自</span><br><span class="line">行创建变量，来满足工作需求。例如设置一个名称为 WORKDIR 的变量，方便用户更轻松地</span><br><span class="line">进入一个层次较深的目录：</span><br><span class="line">[root@linuxprobe ~]<span class="comment"># mkdir /home/workdir</span></span><br><span class="line">[root@linuxprobe ~]<span class="comment"># WORKDIR=/home/workdir</span></span><br><span class="line">[root@linuxprobe ~]<span class="comment"># cd $WORKDIR</span></span><br><span class="line">[root@linuxprobe workdir]<span class="comment"># pwd</span></span><br><span class="line">/home/workdir</span><br><span class="line">但是，这样的变量不具有全局性，作用范围也有限，默认情况下不能被其他用户使用。</span><br><span class="line">如果工作需要，可以使用 <span class="built_in">export</span> 命令将其提升为全局变量，这样其他用户也就可以使用它了：</span><br><span class="line">[root@linuxprobe workdir]<span class="comment"># su linuxprobe</span></span><br><span class="line">Last login: Fri Mar 20 20:52:10 CST 2017 on pts/0</span><br><span class="line">[linuxprobe@linuxprobe ~]$ <span class="built_in">cd</span> <span class="variable">$WORKDIR</span></span><br><span class="line">[linuxprobe@linuxprobe ~]$ <span class="built_in">echo</span> <span class="variable">$WORKDIR</span></span><br><span class="line">[linuxprobe@linuxprobe ~]$ <span class="built_in">exit</span></span><br><span class="line">[root@linuxprobe ~]<span class="comment"># export WORKDIR</span></span><br><span class="line">[root@linuxprobe ~]<span class="comment"># su linuxprobe</span></span><br><span class="line">Last login: Fri Mar 20 21:52:10 CST 2017 on pts/0</span><br><span class="line">[linuxprobe@linuxprobe ~]$ <span class="built_in">cd</span> <span class="variable">$WORKDIR</span></span><br><span class="line">[linuxprobe@linuxprobe workdir]$ <span class="built_in">pwd</span></span><br><span class="line">/home/workdir</span><br></pre></td></tr></table></figure>







<h3 id="升级Linux内核"><a href="#升级Linux内核" class="headerlink" title="升级Linux内核"></a>升级Linux内核</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">yum -y update</span><br><span class="line"><span class="comment">#导入ELRepo仓库的公共密钥</span></span><br><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line"><span class="comment">#安装ELRepo仓库的yum源</span></span><br><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br><span class="line"><span class="comment">#查看可用的系统内核包</span></span><br><span class="line">yum --disablerepo=<span class="string">"*"</span> --enablerepo=<span class="string">"elrepo-kernel"</span> list available</span><br><span class="line"><span class="comment">#安装最新版本内核</span></span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-ml</span><br><span class="line"><span class="comment">#查看系统可用内核</span></span><br><span class="line">sudo awk -F\<span class="string">' '</span><span class="variable">$1</span>==<span class="string">"menuentry "</span> &#123;<span class="built_in">print</span> i++ <span class="string">" : "</span> <span class="variable">$2</span>&#125;<span class="string">' /etc/grub2.cfg</span></span><br><span class="line"><span class="string"># 0 : CentOS Linux (5.4.13-1.el7.elrepo.x86_64) 7 (Core)</span></span><br><span class="line"><span class="string"># 1 : CentOS Linux (3.10.0-1062.9.1.el7.x86_64) 7 (Core)</span></span><br><span class="line"><span class="string"># 2 : CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span></span><br><span class="line"><span class="string"># 3 : CentOS Linux (0-rescue-6822b99242254225a3baef824f5f3165) 7 (Core)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#设置新的内核为grub2的默认版本，0是上面查询的可用内核</span></span><br><span class="line"><span class="string">grub2-set-default 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#设置 GRUB_DEFAULT=0，通过上面查询显示的编号为 0 的内核作为默认内核：</span></span><br><span class="line"><span class="string">vim /etc/default/grub</span></span><br><span class="line"><span class="string"># GRUB_TIMEOUT=5</span></span><br><span class="line"><span class="string"># GRUB_DISTRIBUTOR="$(sed '</span>s, release .*$,,g<span class="string">' /etc/system-release)"</span></span><br><span class="line"><span class="string"># GRUB_DEFAULT=0</span></span><br><span class="line"><span class="string"># GRUB_DISABLE_SUBMENU=true</span></span><br><span class="line"><span class="string"># GRUB_TERMINAL_OUTPUT="console"</span></span><br><span class="line"><span class="string"># GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet"</span></span><br><span class="line"><span class="string"># GRUB_DISABLE_RECOVERY="true"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 生成 grub 配置文件并重启</span></span><br><span class="line"><span class="string">grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br><span class="line"><span class="string">reboot</span></span><br><span class="line"><span class="string">#查看系统中全部的内核：</span></span><br><span class="line"><span class="string">rpm -qa | grep kernel</span></span><br><span class="line"><span class="string">#删除旧版内核</span></span><br><span class="line"><span class="string">yum remove kernel-3.10.0-957.el7.x86_64\</span></span><br><span class="line"><span class="string">kernel-tools-3.10.0-957.el7.x86_64 \</span></span><br><span class="line"><span class="string">kernel-3.10.0-1062.9.1.el7.x86_64 \</span></span><br><span class="line"><span class="string">kernel-tools-libs-3.10.0-957.el7.x86_64</span></span><br></pre></td></tr></table></figure>





<h3 id="rpm包管理"><a href="#rpm包管理" class="headerlink" title="rpm包管理"></a>rpm包管理</h3><ul>
<li>l 列出包的所有文件和目录</li>
<li>q 查询</li>
<li>a 查询所有包</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">常用的使用方法：</span><br><span class="line">rpm -ivh package ---&gt; yum install package</span><br><span class="line">rpm -Uvh package ---&gt; yum update package</span><br><span class="line">rpm -evh package ---&gt; yum remove package</span><br><span class="line">rpm -qa</span><br><span class="line">rpm -ql</span><br></pre></td></tr></table></figure>





<h3 id="yum包管理"><a href="#yum包管理" class="headerlink" title="yum包管理"></a>yum包管理</h3><p>yum配置文件：<br> <code>/etc/yum.conf</code>：为所有仓库提供的公共配置文件<br>  <code>/etc/yum.repos.d/*.repo</code> ： 为仓库提供指定的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">公共配置：</span><br><span class="line">[base] <span class="comment">#仓库ID</span></span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base - mirrors.aliyun.com <span class="comment">#仓库名称</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.aliyuncs.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/ <span class="comment">#源站点URL</span></span><br><span class="line">gpgcheck=1 <span class="comment">#gpg秘钥管理，0是验证，1是不验证</span></span><br><span class="line">gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7 <span class="comment">#指定gpg秘钥文件地址</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#released updates</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">显示仓库列表 -----&gt; yum repslist</span><br><span class="line">显示程序包   -----&gt; yum list </span><br><span class="line">升级程序包   -----&gt; yum update [package1] [package2]</span><br><span class="line">安装程序包   -----&gt; yum install package</span><br><span class="line">降级程序包   -----&gt; yum downgrade [package1] [package2]</span><br><span class="line">可用升级包   -----&gt; yum check-update</span><br><span class="line">卸载程序包   -----&gt; yum remove [package] | find / -name mysql | mariadb</span><br><span class="line">清除缓存     -----&gt; yum clean all</span><br><span class="line">构建本地缓存 -----&gt; yum makecache</span><br><span class="line">查看程序包信息 ----&gt; yum info [package]</span><br></pre></td></tr></table></figure>



<h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><p>系统任务调度的配置文件：<code>/etc/crontab</code></p>
<p>用户的计划任务文件（以发起计划任务用户的身份划分）：<code>/var/spool/cron</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /etc/crontab </span></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># For details see man 4 crontabs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">前四行是用来配置crond任务运行的环境变量</span><br><span class="line">第一行SHELL变量指定了系统要使用哪个shell，这里是bash</span><br><span class="line">第二行PATH变量指定了系统执行命令的路径</span><br><span class="line">第三行MAILTO变量指定了crond的任务执行信息将通过电子邮件发送给root用户</span><br><span class="line">如果MAILTO变量的值为空，则表示不发送任务执行信息给用户</span><br><span class="line">第四行的HOME变量指定了在执行命令或者脚本时使用的主目录。</span><br><span class="line"></span><br><span class="line">星号（*）：代表所有可能的值，如month字段为星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。</span><br><span class="line">逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”</span><br><span class="line">中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”</span><br><span class="line">正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。</span><br><span class="line">小 结：</span><br><span class="line">    数字的表示最好用2为阿拉伯数字显示</span><br><span class="line">    周和日最好不要同时用</span><br><span class="line">    定时任务要加注解</span><br><span class="line">    可以定向到日志文件或者空文件</span><br><span class="line">    定时任务一定是绝对路径，且目录必须存在才能出结果</span><br><span class="line">    crontab 服务一定要开启运行</span><br></pre></td></tr></table></figure>





<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-u 定义用户</span><br><span class="line">-e 编辑任务</span><br><span class="line">-l 显示用户的计划任务</span><br><span class="line">-r 删除用户计划任务</span><br><span class="line">-i 交互式</span><br><span class="line">-n &lt;host&gt; 设置某个机器加护任务</span><br><span class="line">-c 获取某台机器的计划任务</span><br><span class="line"></span><br><span class="line">Note：如果在编辑计划任务的时候使用到%，需要进行转义</span><br><span class="line">/var/<span class="built_in">log</span>/cron</span><br></pre></td></tr></table></figure>



<p>每月每天每小时的第 0 分钟执行一次 /bin/ls</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 * * * * /bin/ls</span><br></pre></td></tr></table></figure>

<p>在 12 月内, 每天的早上 6 点到 12 点，每隔 3 个小时 0 分钟执行一次 /usr/bin/backup</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 6-12/3 * 12 * /usr/bin/backup</span><br></pre></td></tr></table></figure>

<p>周一到周五每天下午 5:00 寄一封信给 <a href="mailto:alex@domain.name">alex@domain.name</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 17 * * 1-5 mail -s <span class="string">"hi"</span> alex@domain.name &lt; /tmp/maildata</span><br></pre></td></tr></table></figure>

<p>每月每天的午夜 0 点 20 分, 2 点 20 分, 4 点 20 分….执行 echo “haha”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20 0-23/2 * * * <span class="built_in">echo</span> <span class="string">"haha"</span></span><br></pre></td></tr></table></figure>

<p>下面再看看几个具体的例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0 */2 * * * /sbin/service httpd restart  意思是每两个小时重启一次apache </span><br><span class="line"></span><br><span class="line">50 7 * * * /sbin/service sshd start  意思是每天7：50开启ssh服务 </span><br><span class="line"></span><br><span class="line">50 22 * * * /sbin/service sshd stop  意思是每天22：50关闭ssh服务 </span><br><span class="line"></span><br><span class="line">0 0 1,15 * * fsck /home  每月1号和15号检查/home 磁盘 </span><br><span class="line"></span><br><span class="line">1 * * * * /home/bruce/backup  每小时的第一分执行 /home/bruce/backup这个文件 </span><br><span class="line"></span><br><span class="line">00 03 * * 1-5 find /home <span class="string">"*.xxx"</span> -mtime +4 -<span class="built_in">exec</span> rm &#123;&#125; \;  每周一至周五3点钟，在目录/home中，查找文件名为*.xxx的文件，并删除4天前的文件。</span><br><span class="line"></span><br><span class="line">30 6 */10 * * ls  意思是每月的1、11、21、31日是的6：30执行一次ls命令</span><br></pre></td></tr></table></figure>



<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><p>本章介绍Linux网路相关命令，主要的有ssh、scp其余的比较杂，但又有些会用到，所以放在了一起。</p>
<h3 id="ping：发送ICMP报文"><a href="#ping：发送ICMP报文" class="headerlink" title="ping：发送ICMP报文"></a>ping：发送ICMP报文</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># ping -c 3 www.baidu.com</span></span><br><span class="line">PING www.a.shifen.com (183.232.231.174) 56(84) bytes of data.</span><br><span class="line">64 bytes from 183.232.231.174 (183.232.231.174): icmp_seq=1 ttl=128 time=36.4 ms</span><br><span class="line">64 bytes from 183.232.231.174 (183.232.231.174): icmp_seq=2 ttl=128 time=35.2 ms</span><br><span class="line">64 bytes from 183.232.231.174 (183.232.231.174): icmp_seq=3 ttl=128 time=35.0 ms</span><br><span class="line"></span><br><span class="line">--- www.a.shifen.com ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2004ms</span><br><span class="line">rtt min/avg/max/mdev = 35.028/35.566/36.448/0.664 ms</span><br></pre></td></tr></table></figure>

<p>首先，ping程序会向域名服务器(DNS)发送请求，解析域名<code>www.baidu.com</code>的IP地址。DNS返回域名的一个别名<code>www.a.shifen.com</code> 以及对应的IP地址<code>61.135.169.121</code>。之后ping程序开始向这个地址发送请求报文，每1s发送一个，ping收到TCMP回显应答并将结果显示在终端上，包括ICMP序列号(<code>icmp_seq</code>)，生存时间(ttl)和数据包往返时间(time)。最后，给出汇总信息，包括报文总收发情况，总时间，往返时间最小值、平均值、最大值、平均偏差(越大说明网络越不稳定)。</p>
<h3 id="host：DNS查询"><a href="#host：DNS查询" class="headerlink" title="host：DNS查询"></a>host：DNS查询</h3><p>host这个程序是 bind-utils包里面的，首先<code>yum -y install bind-utils</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># host ymlog.cn</span></span><br><span class="line">ymlog.cn has address 47.94.18.223</span><br></pre></td></tr></table></figure>

<p>host命令通过配置文件/etc/resolv.conf中指定的DNS服务器查询name的IP地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># cat /etc/resolv.conf</span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">search localdomain</span><br><span class="line">nameserver 192.168.19.2</span><br></pre></td></tr></table></figure>



<h3 id="dig：DNS查询"><a href="#dig：DNS查询" class="headerlink" title="dig：DNS查询"></a>dig：DNS查询</h3><p>dig和host命令的语法一致，但提供了更详细的信息和更多的选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dig www.baidu.com</span><br><span class="line"><span class="comment">#只查询域名的A记录并以短格式显示：</span></span><br><span class="line">dig www.baidu.com A +short </span><br><span class="line"><span class="comment">#用@server的方式指定DNS服务器：</span></span><br><span class="line">dig +noall +answer www.baidu.com A @8.8.8.8</span><br></pre></td></tr></table></figure>



<h3 id="traceroute-tracepath：-路由跟踪"><a href="#traceroute-tracepath：-路由跟踪" class="headerlink" title="traceroute,tracepath： 路由跟踪"></a>traceroute,tracepath： 路由跟踪</h3><h3 id="arp：显示系统的arp缓存"><a href="#arp：显示系统的arp缓存" class="headerlink" title="arp：显示系统的arp缓存"></a>arp：显示系统的arp缓存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># arp -a</span></span><br><span class="line">promote.cache-dns.local (192.168.19.2) at 00:50:56:e6:9f:39 [ether] on ens32</span><br><span class="line">promote.cache-dns.local (192.168.19.1) at 00:50:56:c0:00:08 [ether] on ens32</span><br><span class="line">promote.cache-dns.local (192.168.19.254) at 00:50:56:e1:59:8b [ether] on ens32</span><br></pre></td></tr></table></figure>





<h3 id="arping：给邻居主机发送ARP请求"><a href="#arping：给邻居主机发送ARP请求" class="headerlink" title="arping：给邻居主机发送ARP请求"></a>arping：给邻居主机发送ARP请求</h3><p>如发现某地址不稳定，可以使用arping测试该地址是否为MAC地址冲突：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># arping 192.168.19.2 -I ens32</span></span><br><span class="line">ARPING 192.168.19.2 from 192.168.19.132 ens32</span><br><span class="line">Unicast reply from 192.168.19.2 [00:50:56:E6:9F:39]  0.678ms</span><br><span class="line">Unicast reply from 192.168.19.2 [00:50:56:E6:9F:39]  0.811ms</span><br><span class="line">Unicast reply from 192.168.19.2 [00:50:56:E6:9F:39]  1.158ms</span><br></pre></td></tr></table></figure>



<h3 id="route：显示或更改路由表"><a href="#route：显示或更改路由表" class="headerlink" title="route：显示或更改路由表"></a>route：显示或更改路由表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># route</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         promote.cache<span class="_">-d</span> 0.0.0.0         UG    100    0        0 ens32</span><br><span class="line">192.168.19.0    0.0.0.0         255.255.255.0   U     100    0        0 ens32</span><br></pre></td></tr></table></figure>

<p>其中Destination表示目的网段或目标主机;Gateway表示网关地址;Genmask表示目的网段的掩码;Flags表示路由标志：U表示路由是启用(up)的、G表示网关;Metric表示目标距离，通常用跳数表示;Ref表示路由的引用数;Use表示路由查找计数;Iface表示此条路由的出口。</p>
<ul>
<li>选项-n表示用数字形式显示目的网段</li>
<li>选项add和del表示添加或删除一条路由。</li>
<li>选项-net和netmask表示指定目的网段及掩码。</li>
<li>选项gw表示指定网关。</li>
<li>选项dev IF表示指定出口网卡</li>
</ul>
<p>如增加一条到192.56.76.x的路由，使它的出口为ens32：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add -net 192.168.20.0 netmask 255.255.255.0 dev ens32</span><br></pre></td></tr></table></figure>

<p>如增加一条默认路由，指明它的网关为10.0.1.1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add default gw 10.0.1.1</span><br></pre></td></tr></table></figure>

<p>如增加一条到172.20.70.0的路由，网关为10.0.1.2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add -net 172.20.70.0/24 gw 10.0.1.2</span><br></pre></td></tr></table></figure>

<p>如删除默认路由</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route del default</span><br></pre></td></tr></table></figure>





<h3 id="ssh：远程登录"><a href="#ssh：远程登录" class="headerlink" title="ssh：远程登录"></a>ssh：远程登录</h3><p><img src="https://i.loli.net/2020/01/19/h4KYD12dZlzQrFT.png" alt="image-20200119214107874.png"></p>
<p>SSH（Secure Shell）是一种能够以安全的方式提供远程登录的协议，也是目前远程管理Linux 系统的首选方式。在此之前，一般使用 FTP 或 Telnet 来进行远程登录。但是因为它们以明文的形式在网络中传输账户密码和数据信息，因此很不安全，很容易受到黑客发起的中间人攻击，这轻则篡改传输的数据信息，重则直接抓取服务器的账户密码。</p>
<p>想要使用 SSH 协议来远程管理 Linux 系统，则需要部署配置 sshd 服务程序。SSHD服务：</p>
<ul>
<li>基于口令的验证—用账户和密码来验证登录；</li>
<li>基于密钥的验证—需要在本地生成密钥对，然后把密钥对中的公钥上传至服务器，并与服务器中的公钥进行比较；该方式相较来说更安全。</li>
</ul>
<p>当命令ssh后直接跟主机IP时表示使用默认用户root登录，如果是首次登录，需要确认添加该主机的认证key，当输入yes后，即会在本机/root/.ssh/known_hosts中增加一条该主机的记录，下一次登录时就不用再次确认了。然后需要输入用户密码，通过验证之后，我们就获得了目的主机的一个shell，我们就可以在这个shell中执行命令了。</p>
<p><strong>sshd的配置文件</strong></p>
<p><code>/etc/ssh/sshd_config</code></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Port 22</td>
<td>默认的sshd服务端口</td>
</tr>
<tr>
<td>ListenAdress 0.0.0.0</td>
<td>设定sshd服务监听的IP地址</td>
</tr>
<tr>
<td>Protocol   2</td>
<td>SSH协议版本号</td>
</tr>
<tr>
<td>HostKey /etc/ssh/ssh_host_key</td>
<td>SSH协议版本为1时，DES私钥存放的位置</td>
</tr>
<tr>
<td>HostKey /etc/ssh/ssh_host_rsa_key</td>
<td>SSH协议版本为2时，RSA私钥存放的位置</td>
</tr>
<tr>
<td>HostKey /etc/ssh/ssh_host_dsa_key</td>
<td>SSH协议版本为2时，DSA私钥存放的位置</td>
</tr>
<tr>
<td>PermitRootLogin yes</td>
<td>设定是否允许root管理员直接登录</td>
</tr>
<tr>
<td>StrictModes yes</td>
<td>当远程用户的私钥改变时，拒绝连接</td>
</tr>
<tr>
<td>MaxAuthTries 6</td>
<td>最大密码尝试次数</td>
</tr>
<tr>
<td>PasswordAuthentication yes</td>
<td>是否允许密码验证</td>
</tr>
<tr>
<td>PermitEmptyPasswords no</td>
<td>是否允许空密码登录</td>
</tr>
</tbody></table>
<p>A远程登录B</p>
<p>1、A端生成公钥和私钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># ssh-keygen -t rsa</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): <span class="comment">#回车</span></span><br><span class="line">Created directory <span class="string">'/root/.ssh'</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): <span class="comment">#回车</span></span><br><span class="line">Enter same passphrase again: <span class="comment">#回车</span></span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa. <span class="comment">#私钥</span></span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub. <span class="comment">#公钥</span></span><br><span class="line">--------------------------------------------</span><br></pre></td></tr></table></figure>

<p>其中命令ssh-keygen用来生成公钥私钥，选项-t指明密钥类型。之后使用命令ssh-copy-id将公钥发送至目标主机，这里需要输入目标主机用户密码。然后就可以免密码登录了：</p>
<p>2、将公钥复制给B端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># ssh-copy-id 192.168.19.50</span></span><br><span class="line">/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class="string">"/root/.ssh/id_rsa.pub"</span></span><br><span class="line">-----------------</span><br><span class="line">root@192.168.19.50<span class="string">'s password: #这里需要输入一次B的密码</span></span><br><span class="line"><span class="string">-----------------</span></span><br></pre></td></tr></table></figure>



<p>3、远程登陆B</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># ssh -p22 192.168.19.50</span></span><br></pre></td></tr></table></figure>

<p>选项-p为登录指定端口</p>
<p>端口设置在服务端配置文件/etc/ssh/sshd_config中，默认端口号为22，如更改需将#Port 22去掉注释并将22更改为需要的端口，然后重启sshd服务service sshd restart或systemctl restart sshd。</p>
<p>将本地文件的root文件备份至远程主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar zc /root | ssh 192.168.19.50 <span class="string">"tar xz"</span></span><br><span class="line">ssh user@host <span class="string">"tar cz /home/temp"</span> | tar xz  <span class="comment">#远程temp目录备份到本地</span></span><br></pre></td></tr></table></figure>



<h3 id="scp：远程传输命令"><a href="#scp：远程传输命令" class="headerlink" title="scp：远程传输命令"></a>scp：远程传输命令</h3><ul>
<li>-1： 强制scp命令使用协议ssh1</li>
<li>-2： 强制scp命令使用协议ssh2</li>
<li>-4： 强制scp命令只使用IPv4寻址</li>
<li>-6： 强制scp命令只使用IPv6寻址</li>
<li>-B： 使用批处理模式（传输过程中不询问传输口令或短语）</li>
<li>-C： 允许压缩。（将-C标志传递给ssh，从而打开压缩功能）</li>
<li>-p：保留原文件的修改时间，访问时间和访问权限。</li>
<li>-q： 不显示传输进度条。</li>
<li>-r： 递归复制整个目录。</li>
<li>-v：详细方式显示输出。scp和ssh(1)会显示出整个过程的调试信息。这些信息用于调试连接，验证和配置问题。</li>
<li>-c cipher： 以cipher将数据传输进行加密，这个选项将直接传递给ssh。</li>
<li>-F ssh_config： 指定一个替代的ssh配置文件，此参数直接传递给ssh。</li>
<li>-i identity_file： 从指定文件中读取传输时使用的密钥文件，此参数直接传递给ssh。</li>
<li>-l limit： 限定用户所能使用的带宽，以Kbit/s为单位。</li>
<li>-o ssh_option： 如果习惯于使用ssh_config(5)中的参数传递方式，</li>
<li>-P port：注意是大写的P, port是指定数据传输用到的端口号</li>
<li>-S program： 指定加密传输时所使用的程序。此程序必须能够理解ssh(1)的选项。</li>
</ul>
<p><strong>实例</strong></p>
<p><strong>1、从本地复制到远程</strong></p>
<p>命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scp local_file remote_username@remote_ip:remote_folder </span><br><span class="line">或者 </span><br><span class="line">scp local_file remote_username@remote_ip:remote_file </span><br><span class="line">或者 </span><br><span class="line">scp local_file remote_ip:remote_folder </span><br><span class="line">或者 </span><br><span class="line">scp local_file remote_ip:remote_file</span><br></pre></td></tr></table></figure>



<ul>
<li>第1,2个指定了用户名，命令执行后需要再输入密码，第1个仅指定了远程的目录，文件名字不变，第2个指定了文件名；</li>
<li>第3,4个没有指定用户名，命令执行后需要输入用户名和密码，第3个仅指定了远程的目录，文件名字不变，第4个指定了文件名；</li>
</ul>
<p>应用实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp &#x2F;home&#x2F;space&#x2F;music&#x2F;1.mp3 root@www.runoob.com:&#x2F;home&#x2F;root&#x2F;others&#x2F;music </span><br><span class="line">scp &#x2F;home&#x2F;space&#x2F;music&#x2F;1.mp3 root@www.runoob.com:&#x2F;home&#x2F;root&#x2F;others&#x2F;music&#x2F;001.mp3 </span><br><span class="line">scp &#x2F;home&#x2F;space&#x2F;music&#x2F;1.mp3 www.runoob.com:&#x2F;home&#x2F;root&#x2F;others&#x2F;music </span><br><span class="line">scp &#x2F;home&#x2F;space&#x2F;music&#x2F;1.mp3 www.runoob.com:&#x2F;home&#x2F;root&#x2F;others&#x2F;music&#x2F;001.mp3</span><br></pre></td></tr></table></figure>

<p>复制目录命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp -r local_folder remote_username@remote_ip:remote_folder </span><br><span class="line">或者 </span><br><span class="line">scp -r local_folder remote_ip:remote_folder</span><br></pre></td></tr></table></figure>

<ul>
<li>第1个指定了用户名，命令执行后需要再输入密码；</li>
<li>第2个没有指定用户名，命令执行后需要输入用户名和密码；</li>
</ul>
<p>应用实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r &#x2F;home&#x2F;space&#x2F;music&#x2F; root@www.runoob.com:&#x2F;home&#x2F;root&#x2F;others&#x2F; </span><br><span class="line">scp -r &#x2F;home&#x2F;space&#x2F;music&#x2F; www.runoob.com:&#x2F;home&#x2F;root&#x2F;others&#x2F;</span><br></pre></td></tr></table></figure>

<p>上面命令将本地 music 目录复制到远程 others 目录下。</p>
<p><strong>2、从远程复制到本地</strong></p>
<p>从远程复制到本地，只要将从本地复制到远程的命令的后2个参数调换顺序即可，如下实例</p>
<p>应用实例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp root@www.runoob.com:/home/root/others/music /home/space/music/1.mp3 </span><br><span class="line">scp -r www.runoob.com:/home/root/others/ /home/space/music/</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong></p>
<p>1.如果远程服务器防火墙有为scp命令设置了指定的端口，我们需要使用 -P 参数来设置命令的端口号，命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#scp 命令使用端口号 4588</span></span><br><span class="line">scp -P 4588 remote@www.runoob.com:/usr/<span class="built_in">local</span>/sin.sh /home/administrator</span><br></pre></td></tr></table></figure>

<p>2.使用scp命令要确保使用的用户具有可读取远程服务器相应文件的权限，否则scp命令是无法起作用的。</p>
</div></div><div class="nextinfo"><p>上一篇：<a href="../../../02/12/RIP%20&amp;%20EIGRP%20&amp;%20ISIS/">RIP & EIGRP & ISIS</a></p><p>下一篇：<a href="../../17/Linux%E6%9D%83%E9%99%90/">Linux权限</a></p></div><div class="news_pl"><div id="comment_container"></div>
<link rel="stylesheet" href="../../../../https:/imsun.github.io/gitment/style/default.css">

<script src="../../../../https:/imsun.github.io/gitment/dist/gitment.browser.js"></script>

<script src="../../../../js/md5.min.js"></script>
<script>var gitment = new Gitment({
    id: md5("2020/01/19/系统和网络命令/"), // 可选。默认为 location.href
    owner: 'ArchKS',
    repo: 'https://github.com/ArchKS/ArchKS.github.io',
    oauth: {
        client_id: '18a9a2412333d2ad8676',
        client_secret: 'e433800c05981a0c741785ef6a7883eb8b0cb48a',
    },
})
gitment.render('comment_container')</script></div></div></div></main><aside class="r_box"><div class="card box"><h2>我的名片</h2><div class="box_con"><p>邮箱：2212585023@qq.com</p>
</div></div><div class="category box"><h2>文章分类</h2><div class="box_con"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Linux/">Linux</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E5%AE%B9%E5%99%A8/">容器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%85%E9%9A%9C/">故障</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%BC%96%E7%A8%8B/">编程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E8%B7%AF%E7%94%B1%E6%8A%80%E6%9C%AF/">路由技术</a><span class="category-list-count">3</span></li></ul></div></div></aside></article><footer><section class="footer_bottom"><div class="footer_container"><p class="copyright">Design by
<a href='http://ymlog.cn' target='_blank'>ZEN</a>
苏ICP备19049121号-1
</p><ul class="social_network"></ul></div></section></footer><div class="cd-top"><i class="iconfont icon-top"></i></div>
<script src="../../../../js/jquery.min.js"></script>
<script src="../../../../js/scrollreveal.js"></script>
<script src="../../../../js/hc-sticky.js"></script>
<script src="/js/canvas-nest.js" type="text/javascript" color="47,135,193" opacity="0.7" zIndex="-2" count="199"></script><script src="https://cdn.bootcss.com/highlight.js/9.15.9/highlight.min.js"></script><script src="https://cdn.bootcss.com/highlight.js/9.15.9/languages/java.min.js"></script><script src="https://cdn.bootcss.com/highlight.js/9.15.9/languages/javascript.min.js"></script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="../../../../js/common.js?v=202006180934.js"></script>
<script src="../../../../js/index.js?v=202006180934.js"></script>
</body></html>